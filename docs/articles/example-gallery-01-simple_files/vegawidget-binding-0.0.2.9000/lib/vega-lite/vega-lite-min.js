!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.vl={})}(this,function(e){"use strict";function t(e,t,n){return e.fields=t||[],e.fname=n,e}function l(e){throw Error(e)}function o(e){var t,n,r,i=[],a=null,o=0,u=e.length,c="";function s(){i.push(c+e.substring(t,n)),c="",t=n+1}for(e+="",t=n=0;n<u;++n)if("\\"===(r=e[n]))c+=e.substring(t,n),t=++n;else if(r===a)s(),a=null,o=-1;else{if(a)continue;t===o&&'"'===r?(t=n+1,a=r):t===o&&"'"===r?(t=n+1,a=r):"."!==r||o?"["===r?(t<n&&s(),o=t=n+1):"]"===r&&(o||l("Access path missing open bracket: "+e),0<o&&s(),o=0,t=n+1):t<n?s():t=n+1}return o&&l("Access path missing closing bracket: "+e),a&&l("Access path missing closing quote: "+e),t<n&&(n++,s()),i}var v=Array.isArray;function S(e){return e===Object(e)}function y(e){return"string"==typeof e}function k(e){return v(e)?"["+e.map(k)+"]":S(e)||y(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}var n,r,i,a,u=[];i=o(n="id"),a="return _["+i.map(k).join("][")+"];",t(Function("_",a),[n=1===i.length?i[0]:n],r||n),t(function(e){return e},u,"identity"),t(function(){return 0},u,"zero"),t(function(){return 1},u,"one"),t(function(){return!0},u,"true"),t(function(){return!1},u,"false");function c(e,t,n){var r=[t].concat([].slice.call(n));console[e].apply(console,r)}var s=0,f=1,d=2,p=3,h=4;function m(e){return"boolean"==typeof e}function x(e){return"number"==typeof e}function g(e){for(var t={},n=0,r=e.length;n<r;++n)t[e[n]]=!0;return t}var b,E,w,N,O={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},_=function(e){throw{name:"SyntaxError",message:e,at:b,text:w}},T=function(e){return e&&e!==E&&_("Expected '"+e+"' instead of '"+E+"'"),E=w.charAt(b),b+=1,E},C=function(){var e,t="";for("-"===E&&T(t="-");"0"<=E&&E<="9";)t+=E,T();if("."===E)for(t+=".";T()&&"0"<=E&&E<="9";)t+=E;if("e"===E||"E"===E)for(t+=E,T(),"-"!==E&&"+"!==E||(t+=E,T());"0"<=E&&E<="9";)t+=E,T();if(e=+t,isFinite(e))return e;_("Bad number")},A=function(){var e,t,n,r="";if('"'===E)for(;T();){if('"'===E)return T(),r;if("\\"===E)if(T(),"u"===E){for(t=n=0;t<4&&(e=parseInt(T(),16),isFinite(e));t+=1)n=16*n+e;r+=String.fromCharCode(n)}else{if("string"!=typeof O[E])break;r+=O[E]}else r+=E}_("Bad string")},D=function(){for(;E&&E<=" ";)T()};N=function(){switch(D(),E){case"{":return function(){var e,t={};if("{"===E){if(T("{"),D(),"}"===E)return T("}"),t;for(;E;){if(e=A(),D(),T(":"),Object.hasOwnProperty.call(t,e)&&_('Duplicate key "'+e+'"'),t[e]=N(),D(),"}"===E)return T("}"),t;T(","),D()}}_("Bad object")}();case"[":return function(){var e=[];if("["===E){if(T("["),D(),"]"===E)return T("]"),e;for(;E;){if(e.push(N()),D(),"]"===E)return T("]"),e;T(","),D()}}_("Bad array")}();case'"':return A();case"-":return C();default:return"0"<=E&&E<="9"?C():function(){switch(E){case"t":return T("t"),T("r"),T("u"),T("e"),!0;case"f":return T("f"),T("a"),T("l"),T("s"),T("e"),!1;case"n":return T("n"),T("u"),T("l"),T("l"),null}_("Unexpected '"+E+"'")}()}};var z,I,R,L=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,F={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function j(e){return L.lastIndex=0,L.test(e)?'"'+e.replace(L,function(e){var t=F[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}var U="undefined"!=typeof JSON?JSON:{parse:function(e,o){var t;return w=e,b=0,E=" ",t=N(),D(),E&&_("Syntax error"),"function"==typeof o?function e(t,n){var r,i,a=t[n];if(a&&"object"==typeof a)for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(void 0!==(i=e(a,r))?a[r]=i:delete a[r]);return o.call(t,n,a)}({"":t},""):t},stringify:function(e,t,n){var r;if(I=z="","number"==typeof n)for(r=0;r<n;r+=1)I+=" ";else"string"==typeof n&&(I=n);if((R=t)&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return function e(t,n){var r,i,a,o,u,c=z,s=n[t];switch(s&&"object"==typeof s&&"function"==typeof s.toJSON&&(s=s.toJSON(t)),"function"==typeof R&&(s=R.call(n,t,s)),typeof s){case"string":return j(s);case"number":return isFinite(s)?String(s):"null";case"boolean":case"null":return String(s);case"object":if(!s)return"null";if(z+=I,u=[],"[object Array]"===Object.prototype.toString.apply(s)){for(o=s.length,r=0;r<o;r+=1)u[r]=e(r,s)||"null";return a=0===u.length?"[]":z?"[\n"+z+u.join(",\n"+z)+"\n"+c+"]":"["+u.join(",")+"]",z=c,a}if(R&&"object"==typeof R)for(o=R.length,r=0;r<o;r+=1)"string"==typeof(i=R[r])&&(a=e(i,s))&&u.push(j(i)+(z?": ":":")+a);else for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(a=e(i,s))&&u.push(j(i)+(z?": ":":")+a);return a=0===u.length?"{}":z?"{\n"+z+u.join(",\n"+z)+"\n"+c+"}":"{"+u.join(",")+"}",z=c,a}}("",{"":e})}},M=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var p=t.space||"";"number"==typeof p&&(p=Array(p+1).join(" "));var a,h="boolean"==typeof t.cycles&&t.cycles,m=t.replacer||function(e,t){return t},g=t.cmp&&(a=t.cmp,function(i){return function(e,t){var n={key:e,value:i[e]},r={key:t,value:i[t]};return a(n,r)}}),v=[];return function e(t,n,r,i){var a=p?"\n"+new Array(i+1).join(p):"",o=p?": ":":";if(r&&r.toJSON&&"function"==typeof r.toJSON&&(r=r.toJSON()),void 0!==(r=m.call(t,n,r))){if("object"!=typeof r||null===r)return U.stringify(r);if(P(r)){for(var u=[],c=0;c<r.length;c++){var s=e(r,c,r[c],i+1)||U.stringify(null);u.push(a+p+s)}return"["+u.join(",")+a+"]"}if(-1!==v.indexOf(r)){if(h)return U.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}v.push(r);var l=H(r).sort(g&&g(r));for(u=[],c=0;c<l.length;c++){var f=e(r,n=l[c],r[n],i+1);if(f){var d=U.stringify(n)+o+f;u.push(a+p+d)}}return v.splice(v.indexOf(r),1),"{"+u.join(",")+a+"}"}}({"":e},"",e,0)},P=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},H=Object.keys||function(e){var t=Object.prototype.hasOwnProperty||function(){return!0},n=[];for(var r in e)t.call(e,r)&&n.push(r);return n};function q(e){return!!e.or}function W(e){return!!e.and}function G(e){return!!e.not}var B=M;var Y=B;function V(e){if(x(e))return e;var t=y(e)?e:B(e);if(t.length<100)return t;for(var n=0,r=0;r<t.length;r++){n=(n<<5)-n+t.charCodeAt(r),n&=n}return n}function X(e,t){return-1<e.indexOf(t)}function Q(e,t){return e.filter(function(e){return!X(t,e)})}function K(e,t){for(var n=0,r=0;r<e.length;r++)if(t(e[r],r,n++))return!0;return!1}function J(e,t){for(var n=0,r=0;r<e.length;r++)if(!t(e[r],r,n++))return!1;return!0}function Z(e){return[].concat.apply([],e)}function $(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0,i=t;r<i.length;r++){e=ee(e,i[r])}return e}function ee(e,t){if("object"!=typeof t||null===t)return e;for(var n in t)t.hasOwnProperty(n)&&void 0!==t[n]&&("object"!=typeof t[n]||v(t[n])||null===t[n]?e[n]=t[n]:"object"!=typeof e[n]||null===e[n]?e[n]=$(v(t[n].constructor)?[]:{},t[n]):$(e[n],t[n]));return e}function te(e,t){for(var n,r=[],i={},a=0,o=e;a<o.length;a++){var u=o[a];(n=t(u))in i||(i[n]=1,r.push(u))}return r}function ne(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t[n]&&e[n]&&t[n]!==e[n])return!0;return!1}function re(e,t){for(var n in e)if(n in t)return!0;return!1}var ie=Object.keys;function ae(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t}function oe(e){return ie(e)}function ue(e){return JSON.parse(JSON.stringify(e))}function ce(e){return!0===e||!1===e}function se(e){var t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function le(e,t){return G(e)?"!("+le(e.not,t)+")":W(e)?"("+e.and.map(function(e){return le(e,t)}).join(") && (")+")":q(e)?"("+e.or.map(function(e){return le(e,t)}).join(") || (")+")":t(e)}function fe(e,t){if(0===t.length)return!0;var n=t.shift();return fe(e[n],t)&&delete e[n],0===Object.keys(e).length}function de(e){return e.charAt(0).toUpperCase()+e.substr(1)}function pe(e,t){void 0===t&&(t="datum");for(var n=o(e),r=[],i=1;i<=n.length;i++){var a="["+n.slice(0,i).map(k).join("][")+"]";r.push(""+t+a)}return r.join(" && ")}function he(e,t){return void 0===t&&(t="datum"),t+"["+k(o(e).join("."))+"]"}function me(e){return""+o(e).map(function(e){return e.replace(".","\\.")}).join("\\.")}function ge(e){return""+o(e).join(".")}function ve(e){return o(e).length}var ye=Object.freeze({pick:function(e,t){for(var n={},r=0,i=t;r<i.length;r++){var a=i[r];e.hasOwnProperty(a)&&(n[a]=e[a])}return n},omit:function(e,t){for(var n=ue(e),r=0,i=t;r<i.length;r++)delete n[i[r]];return n},stringify:Y,hash:V,contains:X,without:Q,union:function(e,t){return e.concat(Q(t,e))},some:K,every:J,flatten:Z,mergeDeep:$,unique:te,differ:ne,hasIntersection:re,isNumeric:function(e){return!isNaN(e)},differArray:function(e,t){if(e.length!==t.length)return!0;e.sort(),t.sort();for(var n=0;n<e.length;n++)if(t[n]!==e[n])return!0;return!1},keys:ie,vals:ae,flagKeys:oe,duplicate:ue,isBoolean:ce,varName:se,logicalExpr:le,deleteNestedProperty:fe,titlecase:de,accessPathWithDatum:pe,flatAccessWithDatum:he,replacePathInField:me,removePathFromField:ge,accessPathDepth:ve}),be={argmax:1,argmin:1,average:1,count:1,distinct:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},xe=oe(be);function Se(e){return!!be[e]}var Ee=["count","valid","missing","distinct"];function we(e){return e&&X(Ee,e)}var Ne=["count","sum","distinct","valid","missing"],ke=["mean","average","median","q1","q3","min","max"],Oe=g(ke),_e=Object.freeze({AGGREGATE_OPS:xe,isAggregateOp:Se,COUNTING_OPS:Ee,isCountingAggregateOp:we,SUM_OPS:Ne,SHARED_DOMAIN_OPS:ke,SHARED_DOMAIN_OP_INDEX:Oe}),Te=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};function Ce(e,t){function n(){this.constructor=e}Te(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var Ae=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};function De(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]])}return n}var ze=["domain","grid","labels","ticks","title"],Ie={grid:"grid",gridScale:"grid",domain:"main",labels:"main",labelFlush:"main",labelOverlap:"main",minExtent:"main",maxExtent:"main",offset:"main",ticks:"main",title:"main",values:"both",scale:"both",zindex:"both"},Re={orient:1,domain:1,format:1,grid:1,labelBound:1,labelFlush:1,labelPadding:1,labels:1,labelOverlap:1,maxExtent:1,minExtent:1,offset:1,position:1,tickCount:1,ticks:1,tickSize:1,title:1,titlePadding:1,values:1,zindex:1},Le=Ae({},Re,{encoding:1,labelAngle:1,titleMaxLength:1});function Fe(e){return!!Le[e]}var je,Ue,Me=oe(Ae({scale:1},Re,{gridScale:1,encode:1})),Pe=oe(Le),He=Object.freeze({AXIS_PARTS:ze,AXIS_PROPERTY_TYPE:Ie,isAxisProperty:Fe,VG_AXIS_PROPERTIES:Me,AXIS_PROPERTIES:Pe});(Ue=je||(je={})).ROW="row",Ue.COLUMN="column",Ue.X="x",Ue.Y="y",Ue.X2="x2",Ue.Y2="y2",Ue.LATITUDE="latitude",Ue.LONGITUDE="longitude",Ue.LATITUDE2="latitude2",Ue.LONGITUDE2="longitude2",Ue.COLOR="color",Ue.FILL="fill",Ue.STROKE="stroke",Ue.SHAPE="shape",Ue.SIZE="size",Ue.OPACITY="opacity",Ue.TEXT="text",Ue.ORDER="order",Ue.DETAIL="detail",Ue.KEY="key",Ue.TOOLTIP="tooltip",Ue.HREF="href";var qe=je.X,We=je.Y,Ge=je.X2,Be=je.Y2,Ye=je.LATITUDE,Ve=je.LATITUDE2,Xe=je.LONGITUDE,Qe=je.LONGITUDE2,Ke=je.ROW,Je=je.COLUMN,Ze=je.SHAPE,$e=je.SIZE,et=je.COLOR,tt=je.FILL,nt=je.STROKE,rt=je.TEXT,it=je.DETAIL,at=je.KEY,ot=je.ORDER,ut=je.OPACITY,ct=je.TOOLTIP,st=je.HREF,lt={longitude:1,longitude2:1,latitude:1,latitude2:1},ft=oe(lt),dt=Ae({x:1,y:1,x2:1,y2:1},lt,{color:1,fill:1,stroke:1,opacity:1,size:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1});function pt(e){return"color"===e||"fill"===e||"stroke"===e}var ht=Ae({},dt,{row:1,column:1}),mt=oe(ht),gt=(ht.order,ht.detail,oe(De(ht,["order","detail"])));function vt(e){return!!ht[e]}var yt=oe(dt),bt=(dt.x,dt.y,dt.x2,dt.y2,dt.latitude,dt.longitude,dt.latitude2,dt.longitude2,De(dt,["x","y","x2","y2","latitude","longitude","latitude2","longitude2"])),xt=oe(bt),St={x:1,y:1},Et=oe(St),wt=De(bt,["text","tooltip","href","detail","key","order"]),Nt=oe(wt),kt=Ae({},St,wt),Ot=oe(kt);function _t(e){return!!kt[e]}function Tt(e,t){return t in Ct(e)}function Ct(e){switch(e){case et:case tt:case nt:case it:case at:case ct:case st:case ot:case ut:case Ke:case Je:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,rect:!0,line:!0,trail:!0,area:!0,text:!0,geoshape:!0};case qe:case We:case Ye:case Xe:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,rect:!0,line:!0,trail:!0,area:!0,text:!0};case Ge:case Be:case Ve:case Qe:return{rule:!0,bar:!0,rect:!0,area:!0};case $e:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,text:!0,line:!0,trail:!0};case Ze:return{point:!0,geoshape:!0};case rt:return{text:!0}}}function At(e){switch(e){case qe:case We:case $e:case ut:case Ge:case Be:return"continuous";case Ke:case Je:case Ze:case rt:case ct:case st:return"discrete";case et:case tt:case nt:return"flexible";case Ye:case Xe:case Ve:case Qe:case it:case at:case ot:return}throw new Error("rangeType not implemented for "+e)}var Dt=Object.freeze({get Channel(){return je},X:qe,Y:We,X2:Ge,Y2:Be,LATITUDE:Ye,LATITUDE2:Ve,LONGITUDE:Xe,LONGITUDE2:Qe,ROW:Ke,COLUMN:Je,SHAPE:Ze,SIZE:$e,COLOR:et,FILL:tt,STROKE:nt,TEXT:rt,DETAIL:it,KEY:at,ORDER:ot,OPACITY:ut,TOOLTIP:ct,HREF:st,GEOPOSITION_CHANNEL_INDEX:lt,GEOPOSITION_CHANNELS:ft,isColorChannel:pt,CHANNELS:mt,SINGLE_DEF_CHANNELS:gt,isChannel:vt,UNIT_CHANNELS:yt,NONPOSITION_CHANNELS:xt,POSITION_SCALE_CHANNELS:Et,NONPOSITION_SCALE_CHANNELS:Nt,SCALE_CHANNELS:Ot,isScaleChannel:_t,supportMark:Tt,getSupportedMark:Ct,rangeType:At});function zt(t){return m(t)?"bin":"bin"+ie(t).map(function(e){return se("_"+e+"_"+t[e])}).join("")}function It(e){return e&&!m(e)}function Rt(e){switch(e){case Ke:case Je:case $e:case et:case tt:case nt:case ut:case Ze:return 6;default:return 10}}var Lt,Ft,jt=Object.freeze({binToString:zt,isBinParams:It,autoMaxBins:Rt});(Ft=Lt||(Lt={})).AREA="area",Ft.BAR="bar",Ft.LINE="line",Ft.POINT="point",Ft.RECT="rect",Ft.RULE="rule",Ft.TEXT="text",Ft.TICK="tick",Ft.TRAIL="trail",Ft.CIRCLE="circle",Ft.SQUARE="square",Ft.GEOSHAPE="geoshape";var Ut=Lt.AREA,Mt=Lt.BAR,Pt=Lt.LINE,Ht=Lt.POINT,qt=Lt.TEXT,Wt=Lt.TICK,Gt=Lt.TRAIL,Bt=Lt.RECT,Yt=Lt.RULE,Vt=Lt.GEOSHAPE,Xt=Lt.CIRCLE,Qt=Lt.SQUARE,Kt={area:1,bar:1,line:1,point:1,text:1,tick:1,trail:1,rect:1,geoshape:1,rule:1,circle:1,square:1};function Jt(e){return X(["line","area","trail"],e)}var Zt=oe(Kt);function $t(e){return e.type}var en=g(Zt);function tn(e){return($t(e)?e.type:e)in en}var nn,rn,an,on=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity"],un=["fill","fillOpacity"],cn=[].concat(on,un),sn=["filled","color"],ln={area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],text:["shortTimeLabels"],tick:["bandSize","thickness"]},fn={color:"#4c78a8"},dn={binSpacing:1,continuousBandSize:5},pn={thickness:1},hn=Object.freeze({get Mark(){return Lt},AREA:Ut,BAR:Mt,LINE:Pt,POINT:Ht,TEXT:qt,TICK:Wt,TRAIL:Gt,RECT:Bt,RULE:Yt,GEOSHAPE:Vt,CIRCLE:Xt,SQUARE:Qt,isMark:function(e){return!!Kt[e]},isPathMark:Jt,PRIMITIVE_MARKS:Zt,isMarkDef:$t,isPrimitiveMark:tn,STROKE_CONFIG:on,FILL_CONFIG:un,FILL_STROKE_CONFIG:cn,VL_ONLY_MARK_CONFIG_PROPERTIES:sn,VL_ONLY_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX:ln,defaultMarkConfig:fn,defaultBarConfig:dn,defaultTickConfig:pn}),mn=(nn=d||s,{level:function(e){return arguments.length?(nn=+e,this):nn},error:function(){return f<=nn&&c("error","ERROR",arguments),this},warn:function(){return d<=nn&&c("warn","WARN",arguments),this},info:function(){return p<=nn&&c("log","INFO",arguments),this},debug:function(){return h<=nn&&c("log","DEBUG",arguments),this}}),gn=mn;function vn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];gn.warn.apply(gn,arguments)}(an=rn||(rn={})).INVALID_SPEC="Invalid spec",an.FIT_NON_SINGLE='Autosize "fit" only works for single views and layered views.',an.CANNOT_FIX_RANGE_STEP_WITH_FIT='Cannot use a fixed value of "rangeStep" when "autosize" is "fit".',an.cannotProjectOnChannelWithoutField=function(e){return'Cannot project a selection on encoding channel "'+e+'", which has no field.'},an.nearestNotSupportForContinuous=function(e){return'The "nearest" transform is not supported for '+e+" marks."},an.selectionNotFound=function(e){return'Cannot find a selection named "'+e+'"'},an.SCALE_BINDINGS_CONTINUOUS="Scale bindings are currently only supported for scales with unbinned, continuous domains.",an.noSuchRepeatedValue=function(e){return'Unknown repeated value "'+e+'".'},an.CONCAT_CANNOT_SHARE_AXIS="Axes cannot be shared in concatenated views.",an.REPEAT_CANNOT_SHARE_AXIS="Axes cannot be shared in repeated views.",an.cannotSetTitleAnchor=function(e){return'Cannot set title "anchor" for a '+e+" spec"},an.unrecognizedParse=function(e){return'Unrecognized parse "'+e+'".'},an.differentParse=function(e,t,n){return'An ancestor parsed field "'+e+'" as '+n+" but a child wants to parse the field as "+t+"."},an.invalidTransformIgnored=function(e){return"Ignoring an invalid transform: "+Y(e)+"."},an.NO_FIELDS_NEEDS_AS='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.',an.encodingOverridden=function(e){return"Layer's shared "+e.join(",")+" channel "+(1===e.length?"is":"are")+" overriden"},an.projectionOverridden=function(e){var t=e.parentProjection,n=e.projection;return"Layer's shared projection "+Y(t)+" is overridden by a child projection "+Y(n)+"."},an.primitiveChannelDef=function(e,t,n){return"Channel "+e+" is a "+t+". Converted to {value: "+Y(n)+"}."},an.invalidFieldType=function(e){return'Invalid field type "'+e+'"'},an.nonZeroScaleUsedWithLengthMark=function(e,t,n){return"A "+(n.scaleType?n.scaleType+" scale":n.zeroFalse?"scale with zero=false":"scale with custom domain that excludes zero")+" is used with "+e+" mark. This can be misleading as the "+("x"===t?"width":"height")+" of the "+e+" can be arbitrary based on the scale domain. You may want to use point mark instead."},an.invalidFieldTypeForCountAggregate=function(e,t){return'Invalid field type "'+e+'" for aggregate: "'+t+'", using "quantitative" instead.'},an.invalidAggregate=function(e){return'Invalid aggregation operator "'+e+'"'},an.emptyOrInvalidFieldType=function(e,t,n){return'Invalid field type "'+e+'" for channel "'+t+'", using "'+n+'" instead.'},an.droppingColor=function(e,t){var n=t.fill,r=t.stroke;return"Dropping color "+e+" as the plot also has "+(n&&r?"fill and stroke":n?"fill":"stroke")},an.emptyFieldDef=function(e,t){return"Dropping "+Y(e)+' from channel "'+t+'" since it does not contain data field or value.'},an.latLongDeprecated=function(e,t,n){return e+"-encoding with type "+t+" is deprecated. Replacing with "+n+"-encoding."},an.LINE_WITH_VARYING_SIZE="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.",an.incompatibleChannel=function(e,t,n){return e+' dropped as it is incompatible with "'+t+'"'+(n?" when "+n:"")+"."},an.invalidEncodingChannel=function(e){return e+"-encoding is dropped as "+e+" is not a valid encoding channel."},an.facetChannelShouldBeDiscrete=function(e){return e+" encoding should be discrete (ordinal / nominal / binned)."},an.discreteChannelCannotEncode=function(e,t){return'Using discrete channel "'+e+'" to encode "'+t+'" field can be misleading as it does not encode '+("ordinal"===t?"order":"magnitude")+"."},an.BAR_WITH_POINT_SCALE_AND_RANGESTEP_NULL="Bar mark should not be used with point scale when rangeStep is null. Please use band scale instead.",an.lineWithRange=function(e,t){return"Line mark is for continuous lines and thus cannot be used with "+(e&&t?"x2 and y2":e?"x2":"y2")+". We will use the rule mark (line segments) instead."},an.unclearOrientContinuous=function(e){return'Cannot clearly determine orientation for "'+e+'" since both x and y channel encode continuous fields. In this case, we use vertical by default'},an.unclearOrientDiscreteOrEmpty=function(e){return'Cannot clearly determine orientation for "'+e+'" since both x and y channel encode discrete or empty fields.'},an.orientOverridden=function(e,t){return'Specified orient "'+e+'" overridden with "'+t+'"'},an.CANNOT_UNION_CUSTOM_DOMAIN_WITH_FIELD_DOMAIN="custom domain scale cannot be unioned with default field-based domain",an.cannotUseScalePropertyWithNonColor=function(e){return'Cannot use the scale property "'+e+'" with non-color channel.'},an.unaggregateDomainHasNoEffectForRawField=function(e){return"Using unaggregated domain with raw field has no effect ("+Y(e)+")."},an.unaggregateDomainWithNonSharedDomainOp=function(e){return'Unaggregated domain not applicable for "'+e+'" since it produces values outside the origin domain of the source data.'},an.unaggregatedDomainWithLogScale=function(e){return"Unaggregated domain is currently unsupported for log scale ("+Y(e)+")."},an.cannotUseSizeFieldWithBandSize=function(e){return"Using size field when "+e+"-channel has a band scale is not supported."},an.cannotApplySizeToNonOrientedMark=function(e){return'Cannot apply size to non-oriented mark "'+e+'".'},an.rangeStepDropped=function(e){return'rangeStep for "'+e+'" is dropped as top-level '+("x"===e?"width":"height")+" is provided."},an.scaleTypeNotWorkWithChannel=function(e,t,n){return'Channel "'+e+'" does not work with "'+t+'" scale. We are using "'+n+'" scale instead.'},an.scaleTypeNotWorkWithFieldDef=function(e,t){return'FieldDef does not work with "'+e+'" scale. We are using "'+t+'" scale instead.'},an.scalePropertyNotWorkWithScaleType=function(e,t,n){return n+"-scale's \""+t+'" is dropped as it does not work with '+e+" scale."},an.scaleTypeNotWorkWithMark=function(e,t){return'Scale type "'+t+'" does not work with mark "'+e+'".'},an.mergeConflictingProperty=function(e,t,n,r){return"Conflicting "+t+' property "'+e+'" ('+Y(n)+" and "+Y(r)+").  Using "+Y(n)+"."},an.independentScaleMeansIndependentGuide=function(e){return'Setting the scale to be independent for "'+e+'" means we also have to set the guide (axis or legend) to be independent.'},an.domainSortDropped=function(e){return"Dropping sort property "+Y(e)+" as unioned domains only support boolean or op 'count'."},an.UNABLE_TO_MERGE_DOMAINS="Unable to merge domains",an.MORE_THAN_ONE_SORT="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",an.INVALID_CHANNEL_FOR_AXIS="Invalid channel for axis.",an.cannotStackRangedMark=function(e){return'Cannot stack "'+e+'" if there is already "'+e+'2"'},an.cannotStackNonLinearScale=function(e){return"Cannot stack non-linear scale ("+e+")"},an.stackNonSummativeAggregate=function(e){return'Stacking is applied even though the aggregate function is non-summative ("'+e+'")'},an.invalidTimeUnit=function(e,t){return"Invalid "+e+": "+Y(t)},an.dayReplacedWithDate=function(e){return'Time unit "'+e+'" is not supported. We are replacing it with '+e.replace("day","date")+"."},an.droppedDay=function(e){return"Dropping day from datetime "+Y(e)+" as day cannot be combined with other units."};var yn=2006;function bn(e){return!!(e&&(e.year||e.quarter||e.month||e.date||e.day||e.hours||e.minutes||e.seconds||e.milliseconds))}var xn=["january","february","march","april","may","june","july","august","september","october","november","december"],Sn=xn.map(function(e){return e.substr(0,3)}),En=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],wn=En.map(function(e){return e.substr(0,3)});function Nn(e,t){void 0===t&&(t=!1);var n=[];if(t&&void 0!==e.day&&1<ie(e).length&&(vn(rn.droppedDay(e)),delete(e=ue(e)).day),void 0!==e.year?n.push(e.year):void 0!==e.day?n.push(yn):n.push(0),void 0!==e.month){var r=t?function(e){if(x(e))return e-1+"";var t=e.toLowerCase(),n=xn.indexOf(t);if(-1!==n)return n+"";var r=t.substr(0,3),i=Sn.indexOf(r);if(-1!==i)return i+"";throw new Error(rn.invalidTimeUnit("month",e))}(e.month):e.month;n.push(r)}else if(void 0!==e.quarter){var i=t?function(e){if(x(e))return 4<e&&vn(rn.invalidTimeUnit("quarter",e)),e-1+"";throw new Error(rn.invalidTimeUnit("quarter",e))}(e.quarter):e.quarter;n.push(i+"*3")}else n.push(0);if(void 0!==e.date)n.push(e.date);else if(void 0!==e.day){var a=t?function(e){if(x(e))return e%7+"";var t=e.toLowerCase(),n=En.indexOf(t);if(-1!==n)return n+"";var r=t.substr(0,3),i=wn.indexOf(r);if(-1!==i)return i+"";throw new Error(rn.invalidTimeUnit("day",e))}(e.day):e.day;n.push(a+"+1")}else n.push(1);for(var o=0,u=["hours","minutes","seconds","milliseconds"];o<u.length;o++){var c=u[o];void 0!==e[c]?n.push(e[c]):n.push(0)}return e.utc?"utc("+n.join(", ")+")":"datetime("+n.join(", ")+")"}var kn,On,_n=Object.freeze({isDateTime:bn,MONTHS:xn,SHORT_MONTHS:Sn,DAYS:En,SHORT_DAYS:wn,dateTimeExpr:Nn});(On=kn||(kn={})).YEAR="year",On.MONTH="month",On.DAY="day",On.DATE="date",On.HOURS="hours",On.MINUTES="minutes",On.SECONDS="seconds",On.MILLISECONDS="milliseconds",On.YEARMONTH="yearmonth",On.YEARMONTHDATE="yearmonthdate",On.YEARMONTHDATEHOURS="yearmonthdatehours",On.YEARMONTHDATEHOURSMINUTES="yearmonthdatehoursminutes",On.YEARMONTHDATEHOURSMINUTESSECONDS="yearmonthdatehoursminutesseconds",On.MONTHDATE="monthdate",On.HOURSMINUTES="hoursminutes",On.HOURSMINUTESSECONDS="hoursminutesseconds",On.MINUTESSECONDS="minutesseconds",On.SECONDSMILLISECONDS="secondsmilliseconds",On.QUARTER="quarter",On.YEARQUARTER="yearquarter",On.QUARTERMONTH="quartermonth",On.YEARQUARTERMONTH="yearquartermonth",On.UTCYEAR="utcyear",On.UTCMONTH="utcmonth",On.UTCDAY="utcday",On.UTCDATE="utcdate",On.UTCHOURS="utchours",On.UTCMINUTES="utcminutes",On.UTCSECONDS="utcseconds",On.UTCMILLISECONDS="utcmilliseconds",On.UTCYEARMONTH="utcyearmonth",On.UTCYEARMONTHDATE="utcyearmonthdate",On.UTCYEARMONTHDATEHOURS="utcyearmonthdatehours",On.UTCYEARMONTHDATEHOURSMINUTES="utcyearmonthdatehoursminutes",On.UTCYEARMONTHDATEHOURSMINUTESSECONDS="utcyearmonthdatehoursminutesseconds",On.UTCMONTHDATE="utcmonthdate",On.UTCHOURSMINUTES="utchoursminutes",On.UTCHOURSMINUTESSECONDS="utchoursminutesseconds",On.UTCMINUTESSECONDS="utcminutesseconds",On.UTCSECONDSMILLISECONDS="utcsecondsmilliseconds",On.UTCQUARTER="utcquarter",On.UTCYEARQUARTER="utcyearquarter",On.UTCQUARTERMONTH="utcquartermonth",On.UTCYEARQUARTERMONTH="utcyearquartermonth";var Tn={year:1,quarter:1,month:1,day:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},Cn=oe(Tn);function An(e){return!!Tn[e]}var Dn={utcyear:1,utcquarter:1,utcmonth:1,utcday:1,utcdate:1,utchours:1,utcminutes:1,utcseconds:1,utcmilliseconds:1};function zn(e){return!!Dn[e]}var In={utcyearquarter:1,utcyearquartermonth:1,utcyearmonth:1,utcyearmonthdate:1,utcyearmonthdatehours:1,utcyearmonthdatehoursminutes:1,utcyearmonthdatehoursminutesseconds:1,utcquartermonth:1,utcmonthdate:1,utchoursminutes:1,utchoursminutesseconds:1,utcminutesseconds:1,utcsecondsmilliseconds:1},Rn=Ae({},Dn,In);function Ln(e){return!!Rn[e]}function Fn(e){return e.substr(3)}var jn=Ae({},Tn,Dn,{yearquarter:1,yearquartermonth:1,yearmonth:1,yearmonthdate:1,yearmonthdatehours:1,yearmonthdatehoursminutes:1,yearmonthdatehoursminutesseconds:1,quartermonth:1,monthdate:1,hoursminutes:1,hoursminutesseconds:1,minutesseconds:1,secondsmilliseconds:1},In),Un=oe(jn);var Mn={year:"setFullYear",month:"setMonth",date:"setDate",hours:"setHours",minutes:"setMinutes",seconds:"setSeconds",milliseconds:"setMilliseconds",quarter:null,day:null};function Pn(e,t){var n=Mn[e];return{setDateMethod:t?"setUTC"+n.substr(3):n,getDateMethod:"get"+(t?"UTC":"")+n.substr(3)}}function Hn(n){return Cn.reduce(function(e,t){return qn(n,t)?e.concat(t):e},[])}function qn(e,t){var n=e.indexOf(t);return-1<n&&(t!==kn.SECONDS||0===n||"i"!==e.charAt(n-1))}function Wn(r,e){var i=pe(e),a=Ln(r)?"utc":"";return Nn(Cn.reduce(function(e,t){var n;return qn(r,t)&&(e[t]=(n=t)===kn.QUARTER?"("+a+"quarter("+i+")-1)":""+a+n+"("+i+")"),e},{}))}function Gn(e,t,n,r){if(e){var i=[],a="",o=qn(e,kn.YEAR);qn(e,kn.QUARTER)&&(a="'Q' + quarter("+t+")"),qn(e,kn.MONTH)&&i.push(!1!==n?"%b":"%B"),qn(e,kn.DAY)?i.push(n?"%a":"%A"):qn(e,kn.DATE)&&i.push("%d"+(o?",":"")),o&&i.push(n?"%y":"%Y");var u=[];qn(e,kn.HOURS)&&u.push("%H"),qn(e,kn.MINUTES)&&u.push("%M"),qn(e,kn.SECONDS)&&u.push("%S"),qn(e,kn.MILLISECONDS)&&u.push("%L");var c=[];return 0<i.length&&c.push(i.join(" ")),0<u.length&&c.push(u.join(":")),0<c.length&&(a&&(a+=" + ' ' + "),a+=r?"utcFormat("+t+", '"+c.join(" ")+"')":"timeFormat("+t+", '"+c.join(" ")+"')"),a||void 0}}function Bn(e){return"day"!==e&&0<=e.indexOf("day")?(vn(rn.dayReplacedWithDate(e)),e.replace("day","date")):e}var Yn,Vn,Xn=Object.freeze({get TimeUnit(){return kn},TIMEUNIT_PARTS:Cn,isLocalSingleTimeUnit:An,isUtcSingleTimeUnit:zn,isUTCTimeUnit:Ln,getLocalTimeUnit:Fn,TIMEUNITS:Un,isTimeUnit:function(e){return!!jn[e]},convert:function(e,t){for(var n=Ln(e),r=n?new Date(Date.UTC(0,0,1,0,0,0,0)):new Date(0,0,1,0,0,0,0),i=0,a=Cn;i<a.length;i++){var o=a[i];if(qn(e,o))switch(o){case kn.DAY:throw new Error("Cannot convert to TimeUnits containing 'day'");case kn.QUARTER:var u=Pn("month",n),c=u.getDateMethod;r[u.setDateMethod](3*Math.floor(t[c]()/3));break;default:var s=Pn(o,n),l=s.getDateMethod;r[s.setDateMethod](t[l]())}}return r},getTimeUnitParts:Hn,containsTimeUnit:qn,fieldExpr:Wn,formatExpression:Gn,normalizeTimeUnit:Bn});(Vn=Yn||(Yn={})).QUANTITATIVE="quantitative",Vn.ORDINAL="ordinal",Vn.TEMPORAL="temporal",Vn.NOMINAL="nominal",Vn.LATITUDE="latitude",Vn.LONGITUDE="longitude",Vn.GEOJSON="geojson";var Qn={quantitative:1,ordinal:1,temporal:1,nominal:1,latitude:1,longitude:1,geojson:1};var Kn=Yn.QUANTITATIVE,Jn=Yn.ORDINAL,Zn=Yn.TEMPORAL,$n=Yn.NOMINAL,er=Yn.GEOJSON;function tr(e){if(e)switch(e=e.toLowerCase()){case"q":case Kn:return"quantitative";case"t":case Zn:return"temporal";case"o":case Jn:return"ordinal";case"n":case $n:return"nominal";case Yn.LATITUDE:return"latitude";case Yn.LONGITUDE:return"longitude";case er:return"geojson"}}var nr=Object.freeze({get Type(){return Yn},isType:function(e){return!!Qn[e]},QUANTITATIVE:Kn,ORDINAL:Jn,TEMPORAL:Zn,NOMINAL:$n,GEOJSON:er,getFullName:tr});function rr(e){return e.selection}function ir(e){return e&&!y(e)&&"repeat"in e}function ar(e){var t=e.field,n=e.timeUnit,r=e.bin,i=e.aggregate;return Ae({},n?{timeUnit:n}:{},r?{bin:r}:{},i?{aggregate:i}:{},{field:t})}function or(e){return!!e&&!!e.condition}function ur(e){return!!e&&!!e.condition&&!v(e.condition)&&sr(e.condition)}function cr(e){return!!e&&!!e.condition&&(v(e.condition)||fr(e.condition))}function sr(e){return!(!e||!e.field&&"count"!==e.aggregate)}function lr(e){return sr(e)&&y(e.field)}function fr(e){return e&&"value"in e&&void 0!==e.value}function dr(e){return!(!e||!e.scale&&!e.sort)}function pr(e,t){void 0===t&&(t={});var n=e.field,r=t.prefix,i=t.suffix;if(gr(e))n="count_*";else{var a=void 0;t.nofn||(e.bin?(a=zt(e.bin),i=t.binSuffix||""):e.aggregate?a=String(t.aggregate||e.aggregate):e.timeUnit&&(a=String(e.timeUnit))),a&&(n=a+"_"+n)}return i&&(n=n+"_"+i),r&&(n=r+"_"+n),t.expr?he(n,t.expr):me(n)}function hr(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return!!e.bin;case"latitude":case"longitude":case"temporal":return!1}throw new Error(rn.invalidFieldType(e.type))}function mr(e){return!hr(e)}function gr(e){return"count"===e.aggregate}function vr(e,t){var n=e.field,r=e.bin,i=e.timeUnit,a=e.aggregate;return"count"===a?t.countTitle:r?n+" (binned)":i?n+" ("+Hn(i).join("-")+")":a?de(a)+" of "+n:n}function yr(e,t){var n=e.aggregate||e.timeUnit||e.bin&&"bin";return n?n.toUpperCase()+"("+e.field+")":e.field}var br=function(e,t){switch(t.fieldTitle){case"plain":return e.field;case"functional":return yr(e);default:return vr(e,t)}},xr=br;function Sr(e){xr=e}function Er(){Sr(br)}function wr(e,t){return xr(e,t)}function Nr(e,t){if(e.timeUnit)return"temporal";if(e.bin)return"quantitative";switch(At(t)){case"continuous":return"quantitative";case"discrete":case"flexible":return"nominal";default:return"quantitative"}}function kr(e){return sr(e)?e:ur(e)?e.condition:void 0}function Or(e,t){if(y(e)||x(e)||m(e)){var n=y(e)?"string":x(e)?"number":"boolean";return vn(rn.primitiveChannelDef(t,n,e)),{value:e}}return sr(e)?_r(e,t):ur(e)?Ae({},e,{condition:_r(e.condition,t)}):e}function _r(e,t){if(e.aggregate&&!Se(e.aggregate)){e.aggregate;var n=De(e,["aggregate"]);vn(rn.invalidAggregate(e.aggregate)),e=n}if(e.timeUnit&&(e=Ae({},e,{timeUnit:Bn(e.timeUnit)})),e.bin&&(e=Ae({},e,{bin:Tr(e.bin,t)})),e.type){var r=tr(e.type);e.type!==r&&(e=Ae({},e,{type:r})),"quantitative"!==e.type&&we(e.aggregate)&&(vn(rn.invalidFieldTypeForCountAggregate(e.type,e.aggregate)),e=Ae({},e,{type:"quantitative"}))}else{var i=Nr(e,t);vn(rn.emptyOrInvalidFieldType(e.type,t,i)),e=Ae({},e,{type:i})}var a=Ar(e,t),o=a.compatible,u=a.warning;return o||vn(u),e}function Tr(e,t){return m(e)?{maxbins:Rt(t)}:e.maxbins||e.step?e:Ae({},e,{maxbins:Rt(t)})}var Cr={compatible:!0};function Ar(e,t){switch(t){case"row":case"column":return mr(e)&&!e.timeUnit?{compatible:!1,warning:rn.facetChannelShouldBeDiscrete(t)}:Cr;case"x":case"y":case"color":case"fill":case"stroke":case"text":case"detail":case"key":case"tooltip":case"href":return Cr;case"longitude":case"longitude2":case"latitude":case"latitude2":return e.type!==Kn?{compatible:!1,warning:"Channel "+t+" should not be used with "+e.type+" field."}:Cr;case"opacity":case"size":case"x2":case"y2":return hr(e)&&!e.bin?{compatible:!1,warning:"Channel "+t+" should not be used with discrete field."}:Cr;case"shape":return"nominal"!==e.type&&"geojson"!==e.type?{compatible:!1,warning:"Shape channel should be used with nominal data or geojson only"}:Cr;case"order":return"nominal"===e.type?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:Cr}throw new Error("channelCompatability not implemented for channel "+t)}function Dr(e){return"quantitative"===e.type||!!e.bin}function zr(e){return"temporal"===e.type||!!e.timeUnit}var Ir=Object.freeze({isConditionalSelection:rr,isRepeatRef:ir,toFieldDefBase:ar,isConditionalDef:or,hasConditionalFieldDef:ur,hasConditionalValueDef:cr,isFieldDef:sr,isStringFieldDef:lr,isValueDef:fr,isScaleFieldDef:dr,vgField:pr,isDiscrete:hr,isContinuous:mr,isCount:gr,verbalTitleFormatter:vr,functionalTitleFormatter:yr,defaultTitleFormatter:br,setTitleFormatter:Sr,resetTitleFormatter:Er,title:wr,defaultType:Nr,getFieldDef:kr,normalize:Or,normalizeFieldDef:_r,normalizeBin:Tr,channelCompatibility:Ar,isNumberFieldDef:Dr,isTimeFieldDef:zr});function Rr(e,t){var n=e&&e[t];return!!n&&(v(n)?K(n,function(e){return!!e.field}):sr(n)||ur(n))}function Lr(r){return K(mt,function(e){if(Rr(r,e)){var t=r[e];if(v(t))return K(t,function(e){return!!e.aggregate});var n=kr(t);return n&&!!n.aggregate}return!1})}function Fr(c,s){return ie(c).reduce(function(e,n){if(!vt(n))return vn(rn.invalidEncodingChannel(n)),e;if(!Tt(n,s))return vn(rn.incompatibleChannel(n,s)),e;if("size"===n&&"line"===s&&((i=kr(c[n]))&&i.aggregate))return vn(rn.LINE_WITH_VARYING_SIZE),e;if("color"===n&&("fill"in c||"stroke"in c))return vn(rn.droppingColor("encoding",{fill:"fill"in c,stroke:"stroke"in c})),e;var t,r=c[n];if("detail"===n||"order"===n&&!v(r)&&!fr(r)||"tooltip"===n&&v(r))r&&(e[n]=(v(r)?r:[r]).reduce(function(e,t){return sr(t)?e.push(_r(t,n)):vn(rn.emptyFieldDef(t,n)),e},[]));else{var i;if((i=kr(c[n]))&&X([Yn.LATITUDE,Yn.LONGITUDE],i.type)){var a=n,o=(e[a],De(e,["symbol"==typeof a?a:a+""])),u="x"===n?"longitude":"y"===n?"latitude":"x2"===n?"longitude2":"y2"===n?"latitude2":void 0;return vn(rn.latLongDeprecated(n,i.type,u)),Ae({},o,((t={})[u]=Ae({},Or(i,n),{type:"quantitative"}),t))}if(!sr(r)&&!fr(r)&&!or(r))return vn(rn.emptyFieldDef(r,n)),e;e[n]=Or(r,n)}return e},{})}function jr(e){return e&&(!!e.x&&!!e.x2||!!e.y&&!!e.y2)}function Ur(n){var r=[];return mt.forEach(function(e){if(Rr(n,e)){var t=n[e];(v(t)?t:[t]).forEach(function(e){sr(e)?r.push(e):ur(e)&&r.push(e.condition)})}}),r}function Mr(e,n,r){if(e)for(var t=function(t){v(e[t])?e[t].forEach(function(e){n.call(r,e,t)}):n.call(r,e[t],t)},i=0,a=ie(e);i<a.length;i++){t(a[i])}}function Pr(r,i,e,a){return r?ie(r).reduce(function(e,n){var t=r[n];return v(t)?t.reduce(function(e,t){return i.call(a,e,t,n)},e):i.call(a,e,t,n)},e):e}var Hr=Object.freeze({channelHasField:Rr,isAggregate:Lr,normalizeEncoding:Fr,isRanged:jr,fieldDefs:Ur,forEach:Mr,reduce:Pr});function qr(e,t){var n,r=e[t];return void 0!==r?((n={})[t]={value:r},n):{}}var Wr="box-plot";function Gr(e){return!!e.type}var Br=["x","y","color","detail","opacity","size"];var Yr={};function Vr(e,t){Yr[e]=t}var Xr=["boxWhisker","box","boxMid"],Qr=Ae({},{box:["size","color","extent"],boxWhisker:["color"],boxMid:["color"]});function Kr(e,t){var n=$t(e.mark)?e.mark.type:e.mark,r=Yr[n];if(r)return r(e,t);throw new Error('Invalid mark type "'+n+'"')}Vr(Wr,function(e,t){var n,r=(e=Ae({},n=e,{encoding:Pr(n.encoding,function(e,t,n){return-1<Br.indexOf(n)?e[n]=t:vn(rn.incompatibleChannel(n,Wr)),e},{})})).mark,i=(e.encoding,e.selection),a=(e.projection,De(e,["mark","encoding","selection","projection"])),o=void 0;x(t.box.extent)&&(o=t.box.extent),Gr(r)&&r.extent&&"min-max"===r.extent&&(o=void 0);var u,c,s,l,f=function(e,t,n){var r=function(e,t){e.mark;var n,r,i=e.encoding;if(e.projection,De(e,["mark","encoding","projection"]),"vertical"===t?(r="y",n=i.y):(r="x",n=i.x),n&&n.aggregate){var a=n.aggregate,o=De(n,["aggregate"]);a!==Wr&&vn("Continuous axis should not have customized aggregation function "+a),n=o}return{continuousAxisChannelDef:n,continuousAxis:r}}(e,t),i=r.continuousAxisChannelDef,o=r.continuousAxis,u=e.encoding,a=void 0===n,c=[{op:"q1",field:i.field,as:"lower_box_"+i.field},{op:"q3",field:i.field,as:"upper_box_"+i.field},{op:"median",field:i.field,as:"mid_box_"+i.field}],s=[];c.push({op:"min",field:i.field,as:(a?"lower_whisker_":"min_")+i.field}),c.push({op:"max",field:i.field,as:(a?"upper_whisker_":"max_")+i.field}),a||(s=[{calculate:"datum.upper_box_"+i.field+" - datum.lower_box_"+i.field,as:"iqr_"+i.field},{calculate:"min(datum.upper_box_"+i.field+" + datum.iqr_"+i.field+" * "+n+", datum.max_"+i.field+")",as:"upper_whisker_"+i.field},{calculate:"max(datum.lower_box_"+i.field+" - datum.iqr_"+i.field+" * "+n+", datum.min_"+i.field+")",as:"lower_whisker_"+i.field}]);var l=[],f=[],d=[],p={};return Mr(u,function(e,t){if(t!==o)if(sr(e)){if(e.aggregate&&e.aggregate!==Wr)c.push({op:e.aggregate,field:e.field,as:pr(e)});else if(void 0===e.aggregate){var n=pr(e),r=e.bin;if(r){var i=e.field;f.push({bin:r,field:i,as:n})}else if(e.timeUnit){var a=e.timeUnit;i=e.field,d.push({timeUnit:a,field:i,as:n})}l.push(n)}p[t]={field:pr(e),type:e.type}}else p[t]=u[t]}),{transform:[].concat(f,d,[{aggregate:c,groupby:l}],s),continuousAxisChannelDef:i,continuousAxis:o,encodingWithoutContinuousAxis:p}}(e,function(e){var t=e.mark,n=e.encoding;if(e.projection,De(e,["mark","encoding","projection"]),sr(n.x)&&mr(n.x)){if(sr(n.y)&&mr(n.y)){if(void 0===n.x.aggregate&&n.y.aggregate===Wr)return"vertical";if(void 0===n.y.aggregate&&n.x.aggregate===Wr)return"horizontal";if(n.x.aggregate===Wr&&n.y.aggregate===Wr)throw new Error("Both x and y cannot have aggregate");return Gr(t)&&t.orient?t.orient:"vertical"}return"horizontal"}if(sr(n.y)&&mr(n.y))return"vertical";throw new Error("Need a valid continuous axis for boxplots")}(e),o),d=f.transform,p=f.continuousAxisChannelDef,h=f.continuousAxis,m=f.encodingWithoutContinuousAxis,g=m.size,v=De(m,["color","size"]),y=g?{size:g}:qr(t.box,"size"),b={};return p.scale&&(b.scale=p.scale),p.axis&&(b.axis=p.axis),Ae({},a,{transform:d,layer:[{mark:{type:"rule",style:"boxWhisker"},encoding:Ae((u={},u[h]=Ae({field:"lower_whisker_"+p.field,type:p.type},b),u[h+"2"]={field:"lower_box_"+p.field,type:p.type},u),v,qr(t.boxWhisker,"color"))},{mark:{type:"rule",style:"boxWhisker"},encoding:Ae((c={},c[h]={field:"upper_box_"+p.field,type:p.type},c[h+"2"]={field:"upper_whisker_"+p.field,type:p.type},c),v,qr(t.boxWhisker,"color"))},Ae({},i?{selection:i}:{},{mark:{type:"bar",style:"box"},encoding:Ae((s={},s[h]={field:"lower_box_"+p.field,type:p.type},s[h+"2"]={field:"upper_box_"+p.field,type:p.type},s),m,m.color?{}:qr(t.box,"color"),y)}),{mark:{type:"tick",style:"boxMid"},encoding:Ae((l={},l[h]={field:"mid_box_"+p.field,type:p.type},l),v,qr(t.boxMid,"color"),y)}]})}),Vr("error-bar",function(e){e.mark,e.selection,e.projection;var t=e.encoding,n=De(e,["mark","selection","projection","encoding"]),r=(t.size,De(t,["size"])),i=(t.x2,t.y2,De(t,["x2","y2"])),a=De(i,["x","y"]);if(!t.x2&&!t.y2)throw new Error("Neither x2 or y2 provided");return Ae({},n,{layer:[{mark:"rule",encoding:r},{mark:"tick",encoding:i},{mark:"tick",encoding:t.x2?Ae({x:t.x2,y:t.y},a):Ae({x:t.x,y:t.y2},a)}]})});var Jr,Zr,$r=Object.freeze({add:Vr,remove:function(e){delete Yr[e]},COMPOSITE_MARK_STYLES:Xr,VL_ONLY_COMPOSITE_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX:Qr,normalize:Kr}),ei=["shortTimeLabels"],ti={},ni={entryPadding:1,format:1,offset:1,orient:1,padding:1,tickCount:1,title:1,type:1,values:1,zindex:1},ri=Ae({},ni,{opacity:1,shape:1,stroke:1,fill:1,size:1,encode:1}),ii=oe(ni),ai=oe(ri),oi=Object.freeze({defaultLegendConfig:ti,LEGEND_PROPERTIES:ii,VG_LEGEND_PROPERTIES:ai});(Zr=Jr||(Jr={})).LINEAR="linear",Zr.BIN_LINEAR="bin-linear",Zr.LOG="log",Zr.POW="pow",Zr.SQRT="sqrt",Zr.TIME="time",Zr.UTC="utc",Zr.SEQUENTIAL="sequential",Zr.QUANTILE="quantile",Zr.QUANTIZE="quantize",Zr.THRESHOLD="threshold",Zr.ORDINAL="ordinal",Zr.BIN_ORDINAL="bin-ordinal",Zr.POINT="point",Zr.BAND="band";var ui={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric","bin-linear":"bin-linear",time:"time",utc:"time",sequential:"sequential",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position"},ci=ie(ui);function si(e,t){var n=ui[e],r=ui[t];return n===r||"ordinal-position"===n&&"time"===r||"ordinal-position"===r&&"time"===n}var li={linear:0,log:1,pow:1,sqrt:1,time:0,utc:0,point:10,band:11,"bin-linear":0,sequential:0,ordinal:0,"bin-ordinal":0};function fi(e){return li[e]}var di=["linear","bin-linear","log","pow","sqrt","time","utc"],pi=g(di),hi=di.concat(["sequential"]),mi=g(hi),gi=["ordinal","bin-ordinal","point","band"],vi=g(gi),yi=g(["bin-linear","bin-ordinal"]);function bi(e){return e in vi}function xi(e){return e in yi}function Si(e){return e in mi}function Ei(e){return e in pi}var wi={textXRangeStep:90,rangeStep:21,pointPadding:.5,bandPaddingInner:.1,facetSpacing:16,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4};function Ni(e){return e&&!!e.name}function ki(e){return e&&e.selection}var Oi={type:1,domain:1,range:1,rangeStep:1,scheme:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},_i=oe(Oi),Ti=oe(De(Oi,["type","domain","range","rangeStep","scheme"]));function Ci(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":return X(["sequential","ordinal","bin-ordinal","quantile","quantize"],e);case"interpolate":return X(["linear","bin-linear","pow","log","sqrt","utc","time"],e);case"round":return Ei(e)||"band"===e||"point"===e;case"padding":return Ei(e)||X(["point","band"],e);case"paddingOuter":case"rangeStep":return X(["point","band"],e);case"paddingInner":return"band"===e;case"clamp":return Ei(e)||"sequential"===e;case"nice":return Ei(e)||"sequential"===e||"quantize"===e;case"exponent":return"pow"===e;case"base":return"log"===e;case"zero":return Si(e)&&!X(["log","time","utc","bin-linear","threshold","quantile"],e)}throw new Error("Invalid scale property "+t+".")}function Ai(e,t){switch(t){case"interpolate":case"scheme":return pt(e)?void 0:rn.cannotUseScalePropertyWithNonColor(e);case"type":case"domain":case"range":case"base":case"exponent":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeStep":case"reverse":case"round":case"clamp":case"zero":return}throw new Error('Invalid scale property "'+t+'".')}function Di(e,t){switch(e){case je.X:case je.Y:case je.SIZE:case je.OPACITY:return Ei(t)||X(["band","point"],t);case je.COLOR:case je.FILL:case je.STROKE:return"band"!==t;case je.SHAPE:return"ordinal"===t}return!1}var zi=Object.freeze({get ScaleType(){return Jr},SCALE_TYPES:ci,scaleCompatible:si,scaleTypePrecedence:fi,CONTINUOUS_TO_CONTINUOUS_SCALES:di,CONTINUOUS_DOMAIN_SCALES:hi,DISCRETE_DOMAIN_SCALES:gi,TIME_SCALE_TYPES:["time","utc"],hasDiscreteDomain:bi,isBinScale:xi,hasContinuousDomain:Si,isContinuousToContinuous:Ei,defaultScaleConfig:wi,isExtendedScheme:Ni,isSelectionDomain:ki,SCALE_PROPERTIES:_i,NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTIES:Ti,scaleTypeSupportProperty:Ci,channelScalePropertyIncompatability:Ai,channelSupportScaleType:Di}),Ii="_vgsid_";function Ri(e){var t=e.anchor,n=e.offset,r=e.orient,i=e.color,a=De(e,["anchor","offset","orient","color"]);return{mark:Ae({},a,i?{fill:i}:{}),nonMark:Ae({},t?{anchor:t}:{},n?{offset:n}:{},r?{orient:r}:{})}}var Li={width:200,height:200},Fi={padding:5,timeFormat:"%b %d, %Y",countTitle:"Number of Records",invalidValues:"filter",view:Li,mark:fn,area:{},bar:dn,circle:{},geoshape:{},line:{},point:{},rect:{},rule:{color:"black"},square:{},text:{color:"black"},tick:pn,trail:{},box:{size:14,extent:1.5},boxWhisker:{},boxMid:{color:"white"},scale:wi,projection:{},axis:{},axisX:{},axisY:{minExtent:30},axisLeft:{},axisRight:{},axisTop:{},axisBottom:{},axisBand:{},legend:ti,selection:{single:{on:"click",fields:[Ii],resolve:"global",empty:"all"},multi:{on:"click",fields:[Ii],toggle:"event.shiftKey",resolve:"global",empty:"all"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global"}},style:{},title:{}};function ji(e){return $(ue(Fi),e)}var Ui=["view"].concat(Zt,Xr),Mi=["padding","numberFormat","timeFormat","countTitle","stack","scale","selection","invalidValues","overlay"],Pi=Ae({view:["width","height"]},ln,Qr);function Hi(e){e=ue(e);for(var t=0,n=Mi;t<n.length;t++){delete e[a=n[t]]}if(e.axis)for(var r=0,i=ei;r<i.length;r++){var a=i[r];delete e.axis[a]}if(e.legend)for(var o=0,u=ei;o<u.length;o++){a=u[o];delete e.legend[a]}if(e.mark)for(var c=0,s=sn;c<s.length;c++){a=s[c];delete e.mark[a]}for(var l=0,f=Ui;l<f.length;l++){for(var d=f[l],p=0,h=sn;p<h.length;p++){a=h[p];delete e[d][a]}var m=Pi[d];if(m)for(var g=0,v=m;g<v.length;g++){a=v[g];delete e[d][a]}qi(e,d)}for(var a in qi(e,"title","group-title"),e)S(e[a])&&0===ie(e[a]).length&&delete e[a];return 0<ie(e).length?e:void 0}function qi(e,t,n){var r="title"===t?Ri(e.title).mark:e[t];"view"===t&&(n="cell");var i=Ae({},r,e.style[t]);0<ie(i).length&&(e.style[n||t]=i),delete e[t]}var Wi=Object.freeze({defaultViewConfig:Li,defaultConfig:Fi,initConfig:ji,stripAndRedirectConfig:Hi}),Gi={zero:1,center:1,normalize:1};function Bi(e){return!!Gi[e]}var Yi=[Mt,Ut,Yt,Ht,Xt,Qt,Pt,qt,Wt],Vi=[Mt,Ut];function Xi(e,t,n){var r=$t(e)?e.type:e;if(!X(Yi,r))return null;var i=function(e){var t=e.x,n=e.y;if(sr(t)&&sr(n))if("quantitative"===t.type&&"quantitative"===n.type){if(t.stack)return"x";if(n.stack)return"y";if(!!t.aggregate!=!!n.aggregate)return t.aggregate?"x":"y"}else{if("quantitative"===t.type)return"x";if("quantitative"===n.type)return"y"}else{if(sr(t)&&"quantitative"===t.type)return"x";if(sr(n)&&"quantitative"===n.type)return"y"}}(t);if(!i)return null;var a=t[i],o=lr(a)?pr(a,{}):void 0,u="x"===i?"y":"x",c=t[u],s=lr(c)?pr(c,{}):void 0,l=xt.reduce(function(r,i){if(Rr(t,i)){var e=t[i];(v(e)?e:[e]).forEach(function(e){var t=kr(e);if(!t.aggregate){var n=lr(t)?pr(t,{}):void 0;(!n||n!==s&&n!==o)&&r.push({channel:i,fieldDef:t})}})}return r},[]);if(0===l.length)return null;var f=void 0;return(f=void 0!==a.stack?a.stack:X(Vi,r)&&void 0===n?"zero":n)&&Bi(f)?(a.scale&&a.scale.type&&a.scale.type!==Jr.LINEAR&&vn(rn.cannotStackNonLinearScale(a.scale.type)),Rr(t,i===qe?Ge:Be)?(vn(rn.cannotStackRangedMark(i)),null):(a.aggregate&&!X(Ne,a.aggregate)&&vn(rn.stackNonSummativeAggregate(a.aggregate)),{groupbyChannel:c?u:void 0,fieldChannel:i,impute:Jt(r),stackBy:l,offset:f})):null}var Qi=Object.freeze({isStackOffset:Bi,STACKABLE_MARKS:Yi,STACK_BY_DEFAULT_MARKS:Vi,stack:Xi});function Ki(e){return void 0!==e.facet}function Ji(e){return!!e.mark}function Zi(e){return void 0!==e.layer}function $i(e){return void 0!==e.repeat}function ea(e){return ta(e)||na(e)}function ta(e){return void 0!==e.vconcat}function na(e){return void 0!==e.hconcat}function ra(e,t){if(Ki(e))return r=t,i=(n=e).spec,a=De(n,["spec"]),Ae({},a,{spec:ra(i,r)});var n,r,i,a,o,u,c,s,l,f,d,p,h,m,g,v,y,b,x,S,E,w,N,k,O,_,T,C;if(Zi(e))return function t(e,n,r,i){var a=e.layer,o=e.encoding,u=e.projection,c=De(e,["layer","encoding","projection"]);var s=ia({parentEncoding:r,encoding:o});var l=aa({parentProjection:i,projection:u});return Ae({},c,{layer:a.map(function(e){return Zi(e)?t(e,n,s,l):oa(e,n,s,l)})})}(e,t);if($i(e))return u=t,c=(o=e).spec,s=De(o,["spec"]),Ae({},s,{spec:ra(c,u)});if(ta(e))return f=t,d=(l=e).vconcat,p=De(l,["vconcat"]),Ae({},p,{vconcat:d.map(function(e){return ra(e,f)})});if(na(e))return m=t,g=(h=e).hconcat,v=De(h,["hconcat"]),Ae({},v,{hconcat:g.map(function(e){return ra(e,m)})});if(Ji(e)){var A=Rr(e.encoding,Ke),D=Rr(e.encoding,Je);return A||D?(b=t,x=(y=e).encoding,S=x.row,E=x.column,w=De(x,["row","column"]),N=y.mark,k=y.width,O=y.projection,_=y.height,T=y.selection,y.encoding,C=De(y,["mark","width","projection","height","selection","encoding"]),Ae({},C,{facet:Ae({},S?{row:S}:{},E?{column:E}:{}),spec:oa(Ae({},O?{projection:O}:{},{mark:N},k?{width:k}:{},_?{height:_}:{},{encoding:w},T?{selection:T}:{}),b)})):oa(e,t)}throw new Error(rn.INVALID_SPEC)}function ia(e){var t=e.parentEncoding,n=e.encoding;if(t&&n){var r=ie(t).reduce(function(e,t){return n[t]&&e.push(t),e},[]);0<r.length&&vn(rn.encodingOverridden(r))}var i=Ae({},t||{},n||{});return 0<ie(i).length?i:void 0}function aa(e){var t=e.parentProjection,n=e.projection;return t&&n&&vn(rn.projectionOverridden({parentProjection:t,projection:n})),n||t}function oa(e,t,n,r){var i=e.encoding,a=e.projection,o=$t(e.mark)?e.mark.type:e.mark;if(n||r){var u=aa({parentProjection:r,projection:a}),c=ia({parentEncoding:n,encoding:i});return oa(Ae({},e,u?{projection:u}:{},c?{encoding:c}:{}),t)}return tn(e.mark)?jr(i)?function(e){var t=Rr(e.encoding,qe),n=Rr(e.encoding,We),r=Rr(e.encoding,Ge),i=Rr(e.encoding,Be);if(r&&!t||i&&!n){var a=ue(e);return r&&!t&&(a.encoding.x=a.encoding.x2,delete a.encoding.x2),i&&!n&&(a.encoding.y=a.encoding.y2,delete a.encoding.y2),a}return e}(e):"line"===o&&(i.x2||i.y2)?(vn(rn.lineWithRange(!!i.x2,!!i.y2)),oa(Ae({mark:"rule"},e),t,n,r)):Jt(o)?function(e,t){void 0===t&&(t={});var n=e.selection,r=e.projection,i=e.encoding,a=e.mark,o=De(e,["selection","projection","encoding","mark"]),u=$t(a)?a:{type:a},c=(d=u,p=t[u.type],h=i,"transparent"===d.point?{opacity:0}:d.point?S(d.point)?d.point:{}:void 0!==d.point?null:p.point||h.shape?S(p.point)?p.point:{}:null),s="area"===u.type&&(l=u,f=t[u.type],l.line?!0===l.line?{}:l.line:void 0!==l.line?null:f.line?!0===f.line?{}:f.line:null);var l,f;var d,p,h;if(!c&&!s)return Ae({},e,{mark:ua(u)});var m,g=[{mark:ua(Ae({},u,"area"===u.type?{opacity:.7}:{})),encoding:i}],v=Xi(u,i,t?t.stack:void 0),y=i;if(v){var b=v.fieldChannel,x=v.offset;y=Ae({},i,((m={})[b]=Ae({},i[b],x?{stack:x}:{}),m))}s&&g.push(Ae({},r?{projection:r}:{},{mark:Ae({type:"line"},s)},n?{selection:n}:{},{encoding:y}));c&&g.push(Ae({},r?{projection:r}:{},{mark:Ae({type:"point",opacity:1,filled:!0},c)},n?{selection:n}:{},{encoding:y}));return Ae({},o,{layer:g})}(e,t):e:Kr(e,t)}function ua(e){e.point,e.line;var t=De(e,["point","line"]);return 1<ie(t).length?t:t.type}function ca(t,e){return e.forEach(function(n){var e=V(["field","type","value","timeUnit","bin","aggregate"].reduce(function(e,t){return void 0!==n[t]&&(e[t]=n[t]),e},{}));t[e]=t[e]||n}),t}var sa=Object.freeze({isFacetSpec:Ki,isUnitSpec:Ji,isLayerSpec:Zi,isRepeatSpec:$i,isConcatSpec:ea,isVConcatSpec:ta,isHConcatSpec:na,normalize:ra,fieldDefs:function(e){return ae(function t(e,n){return void 0===n&&(n={}),Zi(e)?e.layer.forEach(function(e){Ji(e)?ca(n,Ur(e.encoding)):t(e,n)}):Ki(e)?(ca(n,Ur(e.facet)),t(e.spec,n)):$i(e)?t(e.spec,n):ea(e)?(ta(e)?e.vconcat:e.hconcat).forEach(function(e){return t(e,n)}):ca(n,Ur(e.encoding)),n}(e))},isStacked:function(e,t){return t=t||e.config,!!tn(e.mark)&&null!==Xi(e.mark,e.encoding,t?t.stack:void 0)}});function la(e){return y(e)?{type:e}:e||{}}var fa=["background","padding","datasets"];function da(n){return fa.reduce(function(e,t){return n&&void 0!==n[t]&&(e[t]=n[t]),e},{})}function pa(e){return!!e.url}function ha(e){return!!e.values}function ma(e){return!!e.name}var ga="main",va="raw",ya=Object.freeze({isUrlData:pa,isInlineData:ha,isNamedData:ma,MAIN:ga,RAW:va});function ba(e,t,n){return xa=t||Ea,Sa=n||za,Ra(e.trim()).map(La)}var xa,Sa,Ea="view",wa="[",Na="]",ka="{",Oa="}",_a=":",Ta=",",Ca="@",Aa=">",Da=/[[\]{}]/,za={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};function Ia(e,t,n,r,i){for(var a,o=0,u=e.length;t<u;++t){if(a=e[t],!o&&a===n)return t;i&&0<=i.indexOf(a)?--o:r&&0<=r.indexOf(a)&&++o}return t}function Ra(e){for(var t=[],n=0,r=e.length,i=0;i<r;)i=Ia(e,i,Ta,wa+ka,Na+Oa),t.push(e.substring(n,i).trim()),n=++i;if(0===t.length)throw"Empty event selector: "+e;return t}function La(e){return"["===e[0]?function(e){var t,n,r=e.length,i=1;if((i=Ia(e,i,Na,wa,Na))===r)throw"Empty between selector: "+e;if(2!==(t=Ra(e.substring(1,i))).length)throw"Between selector must have two elements: "+e;if((e=e.slice(i+1).trim())[0]!==Aa)throw"Expected '>' after between selector: "+e;{if(t=t.map(La),(n=La(e.slice(1).trim())).between)return{between:t,stream:n};n.between=t}return n}(e):function(t){var e,n,r={source:xa},i=[],a=[0,0],o=0,u=0,c=t.length,s=0;if(t[c-1]===Oa){if(!(0<=(s=t.lastIndexOf(ka))))throw"Unmatched right brace: "+t;try{a=function(n){var e=n.split(Ta);if(!n.length||2<e.length)throw n;return e.map(function(e){var t=+e;if(t!=t)throw n;return t})}(t.substring(s+1,c-1))}catch(e){throw"Invalid throttle specification: "+t}t=t.slice(0,s).trim(),c=t.length,s=0}if(!c)throw t;t[0]===Ca&&(o=++s);(e=Ia(t,s,_a))<c&&(i.push(t.substring(u,e).trim()),u=s=++e);if((s=Ia(t,s,wa))===c)i.push(t.substring(u,c).trim());else if(i.push(t.substring(u,s).trim()),n=[],(u=++s)===c)throw"Unmatched left bracket: "+t;for(;s<c;){if((s=Ia(t,s,Na))===c)throw"Unmatched left bracket: "+t;if(n.push(t.substring(u,s).trim()),s<c-1&&t[++s]!==wa)throw"Expected left bracket: "+t;u=++s}if(!(c=i.length)||Da.test(i[c-1]))throw"Invalid event selector: "+t;1<c?(r.type=i[1],o?r.markname=i[0].slice(1):(l=i[0],Sa.hasOwnProperty(l)?r.marktype=i[0]:r.source=i[0])):r.type=i[0];var l;"!"===r.type.slice(-1)&&(r.consume=!0,r.type=r.type.slice(0,-1));null!=n&&(r.filter=n);a[0]&&(r.throttle=a[0]);a[1]&&(r.debounce=a[1]);return r}(e)}function Fa(e){return void 0!==e.filter}function ja(e){return void 0!==e.lookup}function Ua(e){return void 0!==e.window}function Ma(e){return void 0!==e.calculate}function Pa(e){return!!e.bin}function Ha(e){return void 0!==e.timeUnit}function qa(e){return void 0!==e.aggregate}function Wa(e){return e.map(function(e){return Fa(e)?{filter:function t(e,n){return G(e)?{not:t(e.not,n)}:W(e)?{and:e.and.map(function(e){return t(e,n)})}:q(e)?{or:e.or.map(function(e){return t(e,n)})}:n(e)}(e.filter,jc)}:e})}var Ga=Object.freeze({isFilter:Fa,isLookup:ja,isWindow:Ua,isCalculate:Ma,isBin:Pa,isTimeUnit:Ha,isAggregate:qa,normalizeTransform:Wa});function Ba(e){return!!e.signal}function Ya(e){return!!e.step}function Va(e){return!v(e)&&("field"in e&&"data"in e)}var Xa=oe({opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,limit:1,dx:1,dy:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,cursor:1,href:1});function Qa(e,n,t,r){void 0===r&&(r={header:!1});var i=e.combine(),a=i.orient,o=i.scale,u=i.title,c=i.zindex,s=De(i,["orient","scale","title","zindex"]);if(ie(s).forEach(function(e){var t=Ie[e];t&&t!==n&&"both"!==t&&delete s[e]}),"grid"===n){if(!s.grid)return;if(s.encode){var l=s.encode.grid;s.encode=Ae({},l?{grid:l}:{}),0===ie(s.encode).length&&delete s.encode}return Ae({scale:o,orient:a},s,{domain:!1,labels:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:void 0!==c?c:0})}if(r.header||!e.mainExtracted){if(s.encode){for(var f=0,d=ze;f<d.length;f++){var p=d[f];e.hasAxisPart(p)||delete s.encode[p]}0===ie(s.encode).length&&delete s.encode}var h,m,g=(m=t,v(h=u)?h.map(function(e){return wr(e,m)}).join(", "):h);return Ae({scale:o,orient:a},g?{title:g}:{},s,{zindex:void 0!==c?c:1})}}function Ka(e){return[].concat(e.type,e.style||[])}function Ja(e,t,n){var r=n.mark[e],i=n[t.type];void 0!==i[e]&&(r=i[e]);for(var a=0,o=Ka(t);a<o.length;a++){var u=o[a],c=n.style[u],s=e;c&&void 0!==c[s]&&(r=c[s])}return r}function Za(e,t,n,r){var i=eo(e,t,r);if(e.bin)return{signal:ro(pr(e,{expr:n}),pr(e,{expr:n,binSuffix:"end"}),i,r)};if("quantitative"===e.type)return{signal:""+to(pr(e,{expr:n,binSuffix:"range"}),i)};if(zr(e)){var a=dr(e)&&e.scale&&e.scale.type===Jr.UTC;return{signal:io(pr(e,{expr:n}),e.timeUnit,t,r.text.shortTimeLabels,r.timeFormat,a)}}return{signal:"''+"+pr(e,{expr:n})}}function $a(e,t){return void 0!==e?e:t}function eo(e,t,n){if(e.type===Kn)return t||n.numberFormat}function to(e,t){return"format("+e+', "'+(t||"")+'")'}function no(e,t,n){return to(e,t||n.numberFormat)}function ro(e,t,n,r){return e+" === null || isNaN("+e+') ? "null" : '+no(e,n,r)+' + " - " + '+no(t,n,r)}function io(e,t,n,r,i,a){if(!t||n){var o=n||i;return a?"utcFormat("+e+", '"+o+"')":"timeFormat("+e+", '"+o+"')"}return Gn(t,e,r,a)}function ao(e,n){return(v(e)?e:[e]).reduce(function(e,t){return e.field.push(pr(t,n)),e.order.push(t.sort||"ascending"),e},{field:[],order:[]})}function oo(e,t){var i=e.slice();return t.forEach(function(e){for(var t=0,n=i;t<n.length;t++){var r=n[t];if(Y(r)===Y(e))return}i.push(e)}),i}function uo(e,t){if(v(e.value)&&v(t.value))return{explicit:e.explicit,value:oo(e.value,t.value)};if(!v(e.value)&&!v(t.value))return{explicit:e.explicit,value:e.value===t.value?e.value:e.value+", "+t.value};throw new Error("It should never reach here")}function co(e,t){return e.bin?_t(t)&&X(["ordinal","nominal"],e.type):(console.warn("Only use this method with binned field defs"),!1)}var so=["row","column"],lo=["header","footer"];function fo(e,t){for(var n=e.component.layoutHeaders[t],r=[],i=0,a=lo;i<a.length;i++){var o=a[i];if(n[o])for(var u=0,c=n[o];u<c.length;u++){var s=c[u];r.push(po(e,t,o,n,s))}}return r}function po(e,t,n,r,i){if(i){var a=null,o=r.facetFieldDef;if(o&&i.labels){var u=o.header,c=void 0===u?{}:u,s=c.format,l=c.labelAngle,f=Ae({},void 0!==l?{angle:{value:l}}:{},(90+(g=((g=l)%360+360)%360))%180==0?{}:g<90||270<g?{align:{value:"right"}}:135<=g&&g<225?{align:{value:"left"}}:{},45<=(m=((m=l)%360+360)%360)&&m<=135?{baseline:{value:"top"}}:{});a=Ae({text:Za(o,s,"parent",e.config),offset:10,orient:"row"===t?"left":"top",style:"guide-label"},0<ie(f).length?{encode:{update:f}}:{})}var d=i.axes,p=d&&0<d.length;if(a||p){var h="row"===t?"height":"width";return Ae({name:e.getName(t+"_"+n),type:"group",role:t+"-"+n},r.facetFieldDef?{from:{data:e.getName(t+"_domain")},sort:{field:pr(o,{expr:"datum"}),order:o.sort||"ascending"}}:{},a?{title:a}:{},i.sizeSignal?{encode:{update:(v={},v[h]=i.sizeSignal,v)}}:{},p?{axes:d}:{})}}var m,g,v;return null}function ho(e){return[].concat(mo(e,"width"),mo(e,"height"))}function mo(e,t){var n="width"===t?"x":"y",r=e.component.layoutSize.get(t);if(!r||"merged"===r)return[];var i=e.getSizeSignalRef(t).signal;if("range-step"===r){var a=e.getScaleComponent(n);if(a){var o=a.get("type"),u=a.get("range");if(bi(o)&&Ya(u)){var c=e.scaleName(n);if(Gu(e.parent))if("independent"===e.parent.component.resolve.scale[n])return[go(c,u)];return[go(c,u),{name:i,update:vo(c,a,"domain('"+c+"').length")}]}}throw new Error("layout size is range step although there is no rangeStep.")}return[{name:i,value:r}]}function go(e,t){return{name:e+"_step",value:t.step}}function vo(e,t,n){var r=t.get("type"),i=t.get("padding"),a=t.get("paddingOuter");a=void 0!==a?a:i;var o=t.get("paddingInner");return"bandspace("+n+", "+(o="band"===r?void 0!==o?o:i:1)+", "+a+") * "+e+"_step"}function yo(e,t){var n=e.scale[t],r=X(Et,t)?"axis":"legend";return"independent"===n?("shared"===e[r][t]&&vn(rn.independentScaleMeansIndependentGuide(t)),"independent"):e[r][t]||"shared"}var bo=function(){function e(e,t){void 0===e&&(e={}),void 0===t&&(t={}),this.explicit=e,this.implicit=t}return e.prototype.clone=function(){return new e(ue(this.explicit),ue(this.implicit))},e.prototype.combine=function(){return Ae({},this.explicit,this.implicit)},e.prototype.get=function(e){return void 0!==this.explicit[e]?this.explicit[e]:this.implicit[e]},e.prototype.getWithExplicit=function(e){return void 0!==this.explicit[e]?{explicit:!0,value:this.explicit[e]}:void 0!==this.implicit[e]?{explicit:!1,value:this.implicit[e]}:{explicit:!1,value:void 0}},e.prototype.setWithExplicit=function(e,t){void 0!==t.value&&this.set(e,t.value,t.explicit)},e.prototype.set=function(e,t,n){return delete this[n?"implicit":"explicit"][e],this[n?"explicit":"implicit"][e]=t,this},e.prototype.copyKeyFromSplit=function(e,t){void 0!==t.explicit[e]?this.set(e,t.explicit[e],!0):void 0!==t.implicit[e]&&this.set(e,t.implicit[e],!1)},e.prototype.copyKeyFromObject=function(e,t){void 0!==t[e]&&this.set(e,t[e],!0)},e}();function xo(e){return{explicit:!0,value:e}}function So(e){return{explicit:!1,value:e}}function Eo(a){return function(e,t,n,r){var i=a(e.value,t.value);return 0<i?e:i<0?t:wo(e,t,n,r)}}function wo(e,t,n,r){return e.explicit&&t.explicit&&vn(rn.mergeConflictingProperty(n,r,e.value,t.value)),e}function No(e,t,n,r,i){return void 0===i&&(i=wo),void 0===e||void 0===e.value?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:Y(e.value)===Y(t.value)?e:i(e,t,n,r)}var ko=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ce(t,e),t}(bo);function Oo(e,t,n,r){return _o(e,t,{binSuffix:"start"===n?void 0:"end"},r?{offset:r}:{})}function _o(e,t,n,r){var i=Ae({},t?{scale:t}:{},{field:pr(e,n)});return r?Ae({},i,r):i}function To(e,t){return void 0===t&&(t=!0),{scale:e,band:t}}function Co(e,t,n,r,i,a){if(t){if(sr(t)){if(t.bin)return X([qe,We],e)&&t.type===Kn?i&&i.impute?_o(t,n,{binSuffix:"mid"}):{signal:'(scale("'+(c=n)+'", '+pr(u=t,{expr:"datum"})+') + scale("'+c+'", '+pr(u,{binSuffix:"end",expr:"datum"})+"))/2"}:_o(t,n,co(t,e)?{binSuffix:"range"}:{});if(r){var o=r.get("type");if(bi(o))return"band"===o?_o(t,n,{binSuffix:"range"},{band:.5}):_o(t,n,{binSuffix:"range"})}return _o(t,n,{})}if(fr(t))return{value:t.value}}var u,c;return a}function Ao(e,t){if(e){if(sr(e))return Za(e,e.format,"datum",t);if(fr(e))return{value:e.value}}}function Do(e){return Ae({},e,{mult:.5})}function zo(e,t,n,r,i){if(y(e)){if(n){var a=r.get("type");if(X([Jr.LOG,Jr.TIME,Jr.UTC],a))"bar"!==i&&"area"!==i||vn(rn.nonZeroScaleUsedWithLengthMark(i,t,{scaleType:a}));else{if(function(e){if(!1!==e.get("zero"))return!0;var t=e.domains;return!!v(t)&&K(t,function(e){return v(e)&&2===e.length&&e[0]<=0&&0<=e[1]})}(r))return{scale:n,value:0};"bar"!==i&&"area"!==i||vn(rn.nonZeroScaleUsedWithLengthMark(i,t,{zeroFalse:!1===r.explicit.zero}))}}return"zeroOrMin"===e?"x"===t?{value:0}:{field:{group:"height"}}:"x"===t?{field:{group:"width"}}:{value:0}}return e}function Io(e,t){void 0===t&&(t={valueOnly:!1});var n,r,i=e.markDef,a=e.encoding,o=e.config,u=i.filled,c=i.type,s={fill:Ja("fill",i,o),stroke:Ja("stroke",i,o),color:Ja("color",i,o)},l=X(["bar","point","circle","square","geoshape"],c)?"transparent":void 0,f={fill:i.fill||s.fill||l,stroke:i.stroke||s.stroke},d=u?"fill":"stroke",p=Ae({},f.fill?{fill:{value:f.fill}}:{},f.stroke?{stroke:{value:f.stroke}}:{});return a.fill||a.stroke?(i.color&&vn(rn.droppingColor("property",{fill:"fill"in a,stroke:"stroke"in a})),Ae({},jo("fill",e,{defaultValue:f.fill||l}),jo("stroke",e,{defaultValue:f.stroke}))):a.color?Ae({},p,jo("color",e,{vgChannel:d,defaultValue:i[d]||i.color||s[d]||s.color||(u?l:void 0)})):i.fill||i.stroke?(i.color&&vn(rn.droppingColor("property",{fill:"fill"in i,stroke:"stroke"in i})),p):i.color?Ae({},p,((n={})[d]={value:i.color},n)):s.fill||s.stroke?p:s.color?Ae({},l?{fill:{value:"transparent"}}:{},((r={})[d]={value:s.color},r)):{}}function Ro(e,t){return Ae({},(n=e.markDef,r=t,Xa.reduce(function(e,t){return void 0!==n[t]&&"ignore"!==r[t]&&(e[t]={value:n[t]}),e},{})),Io(e),jo("opacity",e),function(r){var e="tooltip",t=r.encoding[e];{if(v(t)){var n=t.map(function(e){var t=void 0!==e.title?e.title:pr(e,{binSuffix:"range"}),n=Ao(e,r.config).signal;return'"'+t+'": '+n});return{tooltip:{signal:"{"+n.join(", ")+"}"}}}return Po(r,e,t)}}(e),Mo(e,"href"));var n,r}function Lo(e){return e+" !== null && !isNaN("+e+")"}function Fo(n){if("filter"===n.config.invalidValues){var e=["x","y"].map(function(e){var t=n.getScaleComponent(e);if(t&&Si(t.get("type")))return n.vgField(e,{expr:"datum"})}).filter(function(e){return!!e}).map(Lo);if(0<e.length)return{defined:{signal:e.join(" && ")}}}return{}}function jo(t,n,e){void 0===e&&(e={});var r=e.defaultValue,i=e.vgChannel,a=e.defaultRef||(void 0!==r?{value:r}:void 0),o=n.encoding[t];return Uo(n,o,i||t,function(e){return Co(t,e,n.scaleName(t),n.getScaleComponent(t),null,a)})}function Uo(r,e,t,i){var n,a,o=e&&e.condition,u=i(e);if(o){var c=(v(o)?o:[o]).map(function(e){var t=i(e),n=rr(e)?wc(r,e.selection):Lc(r,e.test);return Ae({test:n},t)});return(n={})[t]=c.concat(void 0!==u?[u]:[]),n}return void 0!==u?((a={})[t]=u,a):{}}function Mo(e,t){return void 0===t&&(t="text"),Po(e,t,e.encoding[t])}function Po(t,e,n){return Uo(t,n,e,function(e){return Ao(e,t.config)})}function Ho(e,t,n){var r,i,a,o=n.scaleName(t),u="x"===t?"width":"height";if(n.encoding.size||void 0!==n.markDef.size)if(n.markDef.orient){var c=((r={})[t+"c"]=_o(e,o,{},{band:.5}),r);if(kr(n.encoding.size))vn(rn.cannotUseSizeFieldWithBandSize(t));else{if(fr(n.encoding.size))return Ae({},c,jo("size",n,{vgChannel:u}));if(void 0!==n.markDef.size)return Ae({},c,((i={})[u]={value:n.markDef.size},i))}}else vn(rn.cannotApplySizeToNonOrientedMark(n.markDef.type));return(a={})[t]=_o(e,o,{binSuffix:"range"}),a[u]=To(o),a}function qo(e,t,n,r){var i="x"===e?"width":"height";return Ae({},Go(e,t,n,"x"===e?"xc":"yc"),jo("size",t,{defaultRef:r,vgChannel:i}))}function Wo(e,t,n,r,i){return"x"===t?{x2:Oo(e,n,"start",i?0:r),x:Oo(e,n,"end",i?r:0)}:{y2:Oo(e,n,"start",i?r:0),y:Oo(e,n,"end",i?0:r)}}function Go(e,t,n,r){var i,a,o,u,c,s,l,f=t.encoding,d=t.mark,p=t.stack,h=f[e],m=t.scaleName(e),g=t.getScaleComponent(e),v=h||!f.latitude&&!f.longitude?(a=f[i=e],c=p,s=zo(n,e,o=m,u=g,d),sr(a)&&c&&i===c.fieldChannel?_o(a,o,{suffix:"end"}):Co(i,a,o,u,c,s)):{field:t.getName(e)};return(l={})[r||e]=v,l}function Bo(e,t,n){var r,i,a,o,u,c,s,l,f=e.encoding,d=e.mark,p=e.markDef,h=e.stack,m="x2"===(n=n||("horizontal"===p.orient?"x2":"y2"))?"x":"y",g=f[m],v=e.scaleName(m),y=e.getScaleComponent(m),b=g||!f.latitude&&!f.longitude?(i=g,a=f[r=n],c=h,s=zo(t,m,o=v,u=y,d),sr(i)&&c&&r.charAt(0)===c.fieldChannel.charAt(0)?_o(i,o,{suffix:"start"}):Co(r,a,o,u,c,s)):{field:e.getName(n)};return(l={})[n]=b,l}function Yo(e){return Xo(e,function(e,t){return Math.max(e,t.value)})}function Vo(e){return Xo(e,function(e,t){return void 0!==e?e:t.value})}function Xo(e,t){return cr(e)?(v(e.condition)?e.condition:[e.condition]).reduce(t,e.value):fr(e)?e.value:void 0}var Qo=Object.freeze({symbols:function(e,t,n,r,i){if("gradient"!==i){var a=Ae({},function(e,t,n){for(var r=0,i=n;r<i.length;r++){var a=i[r],o=Ja(a,t.markDef,t.config);void 0!==o&&(e[a]={value:o})}return e}({},n,cn),Io(n));switch(n.mark){case Mt:case Wt:case qt:a.shape={value:"square"};break;case Xt:case Qt:a.shape={value:n.mark}}var o=n.markDef,u=n.encoding,c=o.filled;if(a.fill)if("fill"===r||c&&r===et)delete a.fill;else if(a.fill.field)delete a.fill;else if(v(a.fill)){var s=Vo(u.fill||u.color)||o.fill||c&&o.color;s&&(a.fill={value:s})}if(a.stroke)if("stroke"===r||!c&&r===et)delete a.stroke;else if(a.stroke.field)delete a.stroke;else if(v(a.stroke)){var l=Vo(u.stroke||u.color)||o.stroke||!c&&o.color;l&&(a.stroke={value:l})}if(a.fill&&"transparent"!==a.fill.value&&!a.stroke&&(a.stroke={value:"transparent"}),r!==Ze){var f=Vo(u.shape)||o.shape;f&&(a.shape={value:f})}if(r!==ut){var d=Yo(u.opacity)||o.opacity;d&&(a.opacity={value:d})}return a=Ae({},a,t),0<ie(a).length?a:void 0}},gradient:function(e,t,n,r,i){var a={};if("gradient"===i){var o=Yo(n.encoding.opacity)||n.markDef.opacity;o&&(a.opacity={value:o})}return a=Ae({},a,t),0<ie(a).length?a:void 0},labels:function(e,t,n,r,i){var a=n.legend(r),o=n.config,u={};if(zr(e)){var c=n.getScaleComponent(r).get("type")===Jr.UTC;t=Ae({text:{signal:io("datum.value",e.timeUnit,a.format,o.legend.shortTimeLabels,o.timeFormat,c)}},t)}return u=Ae({},u,t),0<ie(u).length?u:void 0}});function Ko(e){var r,i;Wu(e)?e.component.legends=(i=(r=e).encoding,[et,tt,nt,$e,Ze,ut].reduce(function(e,t){var n=i[t];return!r.legend(t)||!r.getScaleComponent(t)||sr(n)&&t===Ze&&n.type===er||(e[t]=function(r,i){var a=r.fieldDef(i),o=r.legend(i),u=new ko({},function(e,t){switch(t){case et:var n=e.scaleName(et);return e.markDef.filled?{fill:n}:{stroke:n};case tt:case nt:case $e:case Ze:case ut:return(r={})[t]=e.scaleName(t),r}var r}(r,i));ii.forEach(function(e){var t=function(e,t,n,r){var i,a=r.fieldDef(n);switch(e){case"format":return eo(a,t.format,r.config);case"title":var o=void 0!==a.title?a.title:t.title||(void 0===t.title?void 0:null);return $a(o,wr(a,r.config))||void 0;case"values":return(i=t.values)&&bn(i[0])?i.map(function(e){return{signal:Nn(e,!0)}}):i;case"type":return $a(t.type,function(e,t,n){if(pt(t)&&("quantitative"===e&&!xi(n)||"temporal"===e&&X(["time","utc"],n)))return"gradient"}(a.type,n,r.getScaleComponent(n).get("type")))}return t[e]}(e,o,i,r);if(void 0!==t){var n="values"===e?!!o.values:t===o[e];(n||void 0===r.config.legend[e])&&u.set(e,t,n)}});var c=o.encoding||{},e=["labels","legend","title","symbols","gradient"].reduce(function(e,t){var n=Qo[t]?Qo[t](a,c[t],r,i,u.get("type")):c[t];return void 0!==n&&0<ie(n).length&&(e[t]={update:n}),e},{});return 0<ie(e).length&&u.set("encode",e,!!o.encoding),u}(r,t)),e},{})):e.component.legends=function(i){for(var e=i.component,n=e.legends,a=e.resolve,t=function(t){Ko(t),ie(t.component.legends).forEach(function(e){a.legend[e]=yo(i.component.resolve,e),"shared"===a.legend[e]&&(n[e]=Jo(n[e],t.component.legends[e]),n[e]||(a.legend[e]="independent",delete n[e]))})},r=0,o=i.children;r<o.length;r++){var u=o[r];t(u)}return ie(n).forEach(function(e){for(var t=0,n=i.children;t<n.length;t++){var r=n[t];r.component.legends[e]&&"shared"===a.legend[e]&&delete r.component.legends[e]}}),n}(e)}function Jo(t,r){if(!t)return r.clone();var e=t.getWithExplicit("orient"),n=r.getWithExplicit("orient");if(!e.explicit||!n.explicit||e.value===n.value){for(var i=!1,a=function(n){var e=No(t.getWithExplicit(n),r.getWithExplicit(n),n,"legend",function(e,t){switch(n){case"title":return uo(e,t);case"type":return i=!0,So("symbol")}return wo(e,t,n,"legend")});t.setWithExplicit(n,e)},o=0,u=ai;o<u.length;o++){a(u[o])}return i&&(((t.implicit||{}).encode||{}).gradient&&fe(t.implicit,["encode","gradient"]),((t.explicit||{}).encode||{}).gradient&&fe(t.explicit,["encode","gradient"])),t}}function Zo(e){for(var t=e.component.legends,n={},r=0,i=ie(t);r<i.length;r++){var a=i[r],o=e.getScaleComponent(a),u=Y(o.domains);if(n[u])for(var c=0,s=n[u];c<s.length;c++){Jo(s[c],t[a])||n[u].push(t[a])}else n[u]=[t[a].clone()]}return Z(ae(n)).map(function(e){return e.combine()})}function $o(e){return Vu(e)||Yu(e)||Bu(e)?(t=e).children.reduce(function(e,t){return e.concat(t.assembleProjections())},eu(t)):eu(e);var t}function eu(r){var e=r.component.projection;if(!e||e.merged)return[];var t=e.combine(),n=t.name,i=De(t,["name"]),a={signal:"["+e.size.map(function(e){return e.signal}).join(", ")+"]"},o=e.data.reduce(function(e,t){var n=Ba(t)?t.signal:"data('"+r.lookupDataSource(t)+"')";return X(e,n)||e.push(n),e},[]);if(o.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Ae({name:n,size:a,fit:{signal:1<o.length?"["+o.join(", ")+"]":o[0]}},i)]}var tu=["type","clipAngle","clipExtent","center","rotate","precision","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"],nu=function(a){function e(e,t,n,r){var i=a.call(this,Ae({},t),{name:e})||this;return i.specifiedProjection=t,i.size=n,i.data=r,i.merged=!1,i}return Ce(e,a),e}(bo);function ru(e){Wu(e)?e.component.projection=function(t){var e=t.specifiedProjection,n=t.markDef,r=t.config,i=t.encoding,a=n&&n.type===Vt,o=i&&ft.some(function(e){return sr(i[e])});if(a||o){var u=[];return[[Xe,Ye],[Qe,Ve]].forEach(function(e){(t.channelHasField(e[0])||t.channelHasField(e[1]))&&u.push({signal:t.getName("geojson_"+u.length)})}),t.channelHasField(Ze)&&t.fieldDef(Ze).type===er&&u.push({signal:t.getName("geojson_"+u.length)}),0===u.length&&u.push(t.requestDataName(ga)),new nu(t.projectionName(!0),Ae({},r.projection||{},e||{}),[t.getSizeSignalRef("width"),t.getSizeSignalRef("height")],u)}return}(e):e.component.projection=function(e){if(0===e.children.length)return;var r,t=J(e.children,function(e){ru(e);var t=e.component.projection;if(t){if(r){var n=function(t,n){var e=J(tu,function(e){return!t.explicit.hasOwnProperty(e)&&!n.explicit.hasOwnProperty(e)||!(!t.explicit.hasOwnProperty(e)||!n.explicit.hasOwnProperty(e)||Y(t.get(e))!==Y(n.get(e)))});if(Y(t.size)===Y(n.size)){if(e)return t;if(Y(t.explicit)===Y({}))return n;if(Y(n.explicit)===Y({}))return t}return null}(r,t);return n&&(r=n),!!n}return r=t,!0}return!0});if(r&&t){var n=e.projectionName(!0),i=new nu(n,r.specifiedProjection,r.size,ue(r.data));return e.children.forEach(function(e){e.component.projection&&(i.data=i.data.concat(e.component.projection.data),e.renameProjection(e.component.projection.get("name"),n),e.component.projection.merged=!0)}),i}return}(e)}function iu(e){return!(!e||"count"!==e.op&&!e.field||!e.op)}function au(e){return!!e&&v(e)&&e.every(function(e){return y(e)})}var ou=Object.freeze({isSortField:iu,isSortArray:au}),uu=function(){function e(e,t){this.debugName=t,this._children=[],this._parent=null,e&&(this.parent=e)}return e.prototype.clone=function(){throw new Error("Cannot clone node")},e.prototype.producedFields=function(){return{}},e.prototype.dependentFields=function(){return{}},Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},set:function(e){(this._parent=e).addChild(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),e.prototype.numChildren=function(){return this._children.length},e.prototype.addChild=function(e){this._children.push(e)},e.prototype.removeChild=function(e){this._children.splice(this._children.indexOf(e),1)},e.prototype.remove=function(){for(var e=0,t=this._children;e<t.length;e++){t[e].parent=this._parent}this._parent.removeChild(this)},e.prototype.insertAsParentOf=function(e){var t=e.parent;t.removeChild(this),this.parent=t,e.parent=this},e.prototype.swapWithParent=function(){for(var e=this._parent,t=e.parent,n=0,r=this._children;n<r.length;n++){r[n].parent=e}this._children=[],e.removeChild(this),e.parent.removeChild(e),this.parent=t,e.parent=this},e}(),cu=function(a){function e(e,t,n,r){var i=a.call(this,e,t)||this;return i.type=n,i.refCounts=r,i._source=i._name=t,!i.refCounts||i._name in i.refCounts||(i.refCounts[i._name]=0),i}return Ce(e,a),e.prototype.clone=function(){var e=new this.constructor;return e.debugName="clone_"+this.debugName,e._source=this._source,e._name="clone_"+this._name,e.type=this.type,e.refCounts=this.refCounts,e.refCounts[e._name]=0,e},e.prototype.getSource=function(){return this.refCounts[this._name]++,this._source},e.prototype.isRequired=function(){return!!this.refCounts[this._name]},e.prototype.setSource=function(e){this._source=e},e}(uu),su=function(r){function a(e,t){var n=r.call(this,e)||this;return n.transform=t,n}return Ce(a,r),a.prototype.clone=function(){return new a(null,ue(this.transform))},a.parseAllForSortIndex=function(r,i){return i.forEachFieldDef(function(e,t){if(dr(e)&&au(e.sort)){var n={calculate:a.calculateExpressionFromSortField(e.field,e.sort),as:lu(i,t)};r=new a(r,n)}}),r},a.calculateExpressionFromSortField=function(e,t){var n,r="";for(n=0;n<t.length;n++)r+="datum."+e+" === '"+t[n]+"' ? "+n+" : ";return r+=n},a.prototype.producedFields=function(){var e={};return e[this.transform.as]=!0,e},a.prototype.assemble=function(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}},a}(uu);function lu(e,t){return t+"_"+pr(e.fieldDef(t))+"_sort_index"}var fu=function(i){function s(e,t,n){var r=i.call(this,e)||this;return r.dimensions=t,r.measures=n,r}return Ce(s,i),s.prototype.clone=function(){return new s(null,Ae({},this.dimensions),ue(this.measures))},s.makeFromEncoding=function(e,a){var t=!1;a.forEachFieldDef(function(e){e.aggregate&&(t=!0)});var o={},u={};return t?(a.forEachFieldDef(function(e,t){var n,r,i;e.aggregate?"count"===e.aggregate?(o["*"]=o["*"]||{},o["*"].count=pr(e,{aggregate:"count"})):(o[e.field]=o[e.field]||{},o[e.field][e.aggregate]=pr(e),_t(t)&&"unaggregated"===a.scaleDomain(t)&&(o[e.field].min=pr(e,{aggregate:"min"}),o[e.field].max=pr(e,{aggregate:"max"}))):(n=u,r=t,(i=e).bin?(n[pr(i,{})]=!0,n[pr(i,{binSuffix:"end"})]=!0,co(i,r)&&(n[pr(i,{binSuffix:"range"})]=!0)):n[pr(i)]=!0)}),ie(u).length+ie(o).length===0?null:new s(e,u,o)):null},s.makeFromTransform=function(e,t){for(var n={},r={},i=0,a=t.aggregate;i<a.length;i++){(c=a[i]).op&&("count"===c.op?(r["*"]=r["*"]||{},r["*"].count=c.as||pr(c)):(r[c.field]=r[c.field]||{},r[c.field][c.op]=c.as||pr(c)))}for(var o=0,u=t.groupby||[];o<u.length;o++){var c;n[c=u[o]]=!0}return ie(n).length+ie(r).length===0?null:new s(e,n,r)},s.prototype.merge=function(e){ne(this.dimensions,e.dimensions)?function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];gn.debug.apply(gn,arguments)}("different dimensions, cannot merge"):(!function(e,t){for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];for(var i in r)r.hasOwnProperty(i)&&(n in e?e[n][i]=r[i]:e[n]={op:r[i]})}}(this.measures,e.measures),e.remove())},s.prototype.addDimensions=function(e){var t=this;e.forEach(function(e){return t.dimensions[e]=!0})},s.prototype.dependentFields=function(){var t={};return ie(this.dimensions).forEach(function(e){return t[e]=!0}),ie(this.measures).forEach(function(e){return t[e]=!0}),t},s.prototype.producedFields=function(){var e=this,n={};return ie(this.measures).forEach(function(t){ie(e.measures[t]).forEach(function(e){n[e+"_"+t]=!0})}),n},s.prototype.assemble=function(){for(var e=[],t=[],n=[],r=0,i=ie(this.measures);r<i.length;r++)for(var a=i[r],o=0,u=ie(this.measures[a]);o<u.length;o++){var c=u[o];n.push(this.measures[a][c]),e.push(c),t.push(a)}return{type:"aggregate",groupby:ie(this.dimensions),ops:e,fields:t,as:n}},s}(uu),du=function(a){function e(e,t,n,r){var i=a.call(this,e)||this;return i.model=t,i.name=n,i.data=r,t.facet.column&&(i.columnFields=[t.vgField(Je)],i.columnName=t.getName("column_domain"),t.fieldDef(Je).bin&&i.columnFields.push(t.vgField(Je,{binSuffix:"end"}))),t.facet.row&&(i.rowFields=[t.vgField(Ke)],i.rowName=t.getName("row_domain"),t.fieldDef(Ke).bin&&i.rowFields.push(t.vgField(Ke,{binSuffix:"end"}))),i.childModel=t.child,i}return Ce(e,a),Object.defineProperty(e.prototype,"fields",{get:function(){var e=[];return this.columnFields&&(e=e.concat(this.columnFields)),this.rowFields&&(e=e.concat(this.rowFields)),e},enumerable:!0,configurable:!0}),e.prototype.getSource=function(){return this.name},e.prototype.getChildIndependentFieldsWithStep=function(){for(var e={},t=0,n=["x","y"];t<n.length;t++){var r=n[t],i=this.childModel.component.scales[r];if(i&&!i.merged){var a=i.get("type"),o=i.get("range");if(bi(a)&&Ya(o)){var u=Cu(Au(this.childModel,r));u?e[r]=u:vn("Unknown field for ${channel}.  Cannot calculate view size.")}}}return e},e.prototype.assembleRowColumnData=function(e,t,n){var r={},i="row"===e?"y":"x";return n[i]&&(r=t?{fields:["distinct_"+n[i]],ops:["max"],as:["distinct_"+n[i]]}:{fields:[n[i]],ops:["distinct"]}),{name:"row"===e?this.rowName:this.columnName,source:t||this.data,transform:[Ae({type:"aggregate",groupby:"row"===e?this.rowFields:this.columnFields},r)]}},e.prototype.assemble=function(){var e=[],t=null,n=this.getChildIndependentFieldsWithStep();if(this.columnName&&this.rowName&&(n.x||n.y)){t="cross_"+this.columnName+"_"+this.rowName;var r=[].concat(n.x?[n.x]:[],n.y?[n.y]:[]),i=r.map(function(){return"distinct"});e.push({name:t,source:this.data,transform:[{type:"aggregate",groupby:this.columnFields.concat(this.rowFields),fields:r,ops:i}]})}return this.columnName&&e.push(this.assembleRowColumnData("column",t,n)),this.rowName&&e.push(this.assembleRowColumnData("row",t,n)),e},e}(uu),pu=function(r){function o(e,t){var n=r.call(this,e)||this;return n.fieldDefs=t,n}return Ce(o,r),o.prototype.clone=function(){return new o(null,Ae({},this.fieldDefs))},o.make=function(e,i){var t=i.config,a=i.mark;if("filter"!==t.invalidValues)return null;var n=i.reduceFieldDef(function(e,t,n){var r=_t(n)&&i.getScaleComponent(n);r&&(!Si(r.get("type"))||t.aggregate||Jt(a)||(e[t.field]=t));return e},{});return ie(n).length?new o(e,n):null},Object.defineProperty(o.prototype,"filter",{get:function(){return this.fieldDefs},enumerable:!0,configurable:!0}),o.prototype.assemble=function(){var i=this,e=ie(this.filter).reduce(function(e,t){var n=i.fieldDefs[t],r=pr(n,{expr:"datum"});return null!==n&&(e.push(r+" !== null"),e.push("!isNaN("+r+")")),e},[]);return 0<e.length?{type:"filter",expr:e.join(" && ")}:null},o}(uu);var hu=function(r){function u(e,t){var n=r.call(this,e)||this;return n._parse={},n._parse=t,n}return Ce(u,r),u.prototype.clone=function(){return new u(null,ue(this.parse))},u.make=function(e,t){var n={},r={};(t.transforms||[]).forEach(function(e){Ma(e)?r[e.as]=!0:Fa(e)&&function e(t,n){if(G(t))e(t.not,n);else if(W(t))for(var r=0,i=t.and;r<i.length;r++)e(i[r],n);else if(q(t))for(var a=0,o=t.or;a<o.length;a++)e(o[a],n);else n(t)}(e.filter,function(e){Rc(e)&&e.timeUnit&&(n[e.field]="date")})},{}),(Wu(t)||Gu(t))&&t.forEachFieldDef(function(e){if(zr(e))n[e.field]="date";else if(Dr(e)){if(r[e.field]||we(e.aggregate))return;n[e.field]="number"}else 1<ve(e.field)&&(n[e.field]="flatten")});var i=t.data;if(i&&i.format&&i.format.parse){var a=i.format.parse;ie(a).forEach(function(e){n[e]=a[e]})}var o=t.component.data.ancestorParse;return ie(o).forEach(function(e){n[e]!==o[e]?vn(rn.differentParse(e,n[e],o[e])):delete n[e]}),0===ie(n).length?null:new u(e,n)},Object.defineProperty(u.prototype,"parse",{get:function(){return this._parse},enumerable:!0,configurable:!0}),u.prototype.merge=function(e){this._parse=Ae({},this._parse,e.parse),e.remove()},u.prototype.assembleFormatParse=function(){for(var e={},t=0,n=ie(this._parse);t<n.length;t++){var r=n[t];1===ve(r)&&(e[r]=this._parse[r])}return e},u.prototype.producedFields=function(){return g(ie(this.parse))},u.prototype.dependentFields=function(){return g(ie(this.parse))},u.prototype.assembleTransforms=function(t){var a=this;return void 0===t&&(t=!1),ie(this._parse).filter(function(e){return!t||1<ve(e)}).map(function(e){var t,n,r,i=(t=e,n=a._parse[e],r=pe(t),"number"===n?"toNumber("+r+")":"boolean"===n?"toBoolean("+r+")":"string"===n?"toString("+r+")":"date"===n?"toDate("+r+")":"flatten"===n?r:0===n.indexOf("date:")?"timeParse("+r+","+n.slice(5,n.length)+")":0===n.indexOf("utc:")?"utcParse("+r+","+n.slice(4,n.length)+")":(vn(rn.unrecognizedParse(n)),null));return i?{type:"formula",expr:i,as:ge(e)}:null}).filter(function(e){return null!==e})},u}(uu),mu=function(a){function e(e){var t=a.call(this,null)||this;if(ha(e=e||{name:"source"}))t._data={values:e.values};else if(pa(e)){if(t._data={url:e.url},e.format||(e.format={}),!e.format||!e.format.type){var n=/(?:\.([^.]+))?$/.exec(e.url)[1];X(["json","csv","tsv","topojson"],n)||(n="json"),e.format.type=n}}else ma(e)&&(t._name=e.name,t._data={});if(!ma(e)&&e.format){var r=e.format,i=(r.parse,De(r,["parse"]));t._data.format=i}return t}return Ce(e,a),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),e.prototype.hasName=function(){return!!this._name},Object.defineProperty(e.prototype,"dataName",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{set:function(e){throw new Error("Source nodes have to be roots.")},enumerable:!0,configurable:!0}),e.prototype.remove=function(){throw new Error("Source nodes are roots and cannot be removed.")},e.prototype.hash=function(){return ha(this._data)?(this._hash||(this._hash=V(this._data)),this._hash):pa(this._data)?V([this._data.url,this._data.format]):this._name},e.prototype.assemble=function(){return Ae({name:this._name},this._data,{transform:[]})},e}(uu),gu=function(r){function i(e,t){var n=r.call(this,e)||this;return n.formula=t,n}return Ce(i,r),i.prototype.clone=function(){return new i(null,ue(this.formula))},i.makeFromEncoding=function(e,t){var n=t.reduceFieldDef(function(e,t){if(t.timeUnit){var n=pr(t);e[n]={as:n,timeUnit:t.timeUnit,field:t.field}}return e},{});return 0===ie(n).length?null:new i(e,n)},i.makeFromTransform=function(e,t){return new i(e,((n={})[t.field]={as:t.as,timeUnit:t.timeUnit,field:t.field},n));var n},i.prototype.merge=function(e){this.formula=Ae({},this.formula,e.formula),e.remove()},i.prototype.producedFields=function(){var t={};return ae(this.formula).forEach(function(e){t[e.as]=!0}),t},i.prototype.dependentFields=function(){var t={};return ae(this.formula).forEach(function(e){t[e.field]=!0}),t},i.prototype.assemble=function(){return ae(this.formula).map(function(e){return{type:"formula",as:e.as,expr:Wn(e.timeUnit,e.field)}})},i}(uu);function vu(r){return function e(t){if(!(t instanceof mu)){var n=t.parent;r(t)&&e(n)}}}function yu(e){var t=e.parent;if(e instanceof hu){if(t instanceof mu)return!1;if(1<t.numChildren())return!0;if(t instanceof hu)t.merge(e);else{if(re(t.producedFields(),e.dependentFields()))return!0;e.swapWithParent()}}return!0}function bu(e){return!(e instanceof cu||0<e.numChildren()||e instanceof du)&&(e.remove(),!0)}function xu(e){var n={};return vu(function(e){if(e instanceof gu){var t=e.producedFields();ie(t).every(function(e){return!!n[e]})?e.remove():n=Ae({},n,t)}return!0})(e)}var Su=function(r){function u(e,t){var n=r.call(this,e)||this;return n._stack=t,n}return Ce(u,r),u.prototype.clone=function(){return new u(null,ue(this._stack))},u.make=function(e,t){var n,r=t.stack;if(!r)return null;r.groupbyChannel&&(n=t.fieldDef(r.groupbyChannel));var i,a=t.stack.stackBy.reduce(function(e,t){var n=pr(t.fieldDef);return n&&e.push(n),e},[]),o=t.encoding.order;return i=v(o)||sr(o)?ao(o):a.reduce(function(e,t){return e.field.push(t),e.order.push("descending"),e},{field:[],order:[]}),new u(e,{dimensionFieldDef:n,field:t.vgField(r.fieldChannel),facetby:[],stackby:a,sort:i,offset:r.offset,impute:r.impute})},Object.defineProperty(u.prototype,"stack",{get:function(){return this._stack},enumerable:!0,configurable:!0}),u.prototype.addDimensions=function(e){this._stack.facetby=this._stack.facetby.concat(e)},u.prototype.dependentFields=function(){var t={};t[this._stack.field]=!0,this.getGroupbyFields().forEach(function(e){return t[e]=!0}),this._stack.facetby.forEach(function(e){return t[e]=!0});var e=this._stack.sort.field;return v(e)?e.forEach(function(e){return t[e]=!0}):t[e]=!0,t},u.prototype.producedFields=function(){var e={};return e[this._stack.field+"_start"]=!0,e[this._stack.field+"_end"]=!0,e},u.prototype.getGroupbyFields=function(){var e=this._stack,t=e.dimensionFieldDef,n=e.impute;return t?t.bin?n?[pr(t,{binSuffix:"mid"})]:[pr(t,{}),pr(t,{binSuffix:"end"})]:[pr(t)]:[]},u.prototype.assemble=function(){var e=[],t=this._stack,n=t.facetby,r=t.field,i=t.dimensionFieldDef,a=t.impute,o=t.offset,u=t.sort,c=t.stackby;if(a&&i){var s=i?pr(i,{binSuffix:"mid"}):void 0;i.bin&&e.push({type:"formula",expr:"("+pr(i,{expr:"datum"})+"+"+pr(i,{expr:"datum",binSuffix:"end"})+")/2",as:s}),e.push({type:"impute",field:r,groupby:c,key:s,method:"value",value:0})}return e.push({type:"stack",groupby:this.getGroupbyFields().concat(n),field:r,sort:u,as:[r+"_start",r+"_end"],offset:o}),e},u}(uu),Eu="scale_";function wu(t){if(t instanceof du)if(1!==t.numChildren()||t.children[0]instanceof cu){!function e(t){if(t instanceof cu&&t.type===ga&&1===t.numChildren()){var n=t.children[0];n instanceof du||(n.swapWithParent(),e(t))}}(t.model.component.data.main),Z(t.children.map((i=t,function e(t){if(!(t instanceof du)){var n=t.clone();if(n instanceof cu){var r=Eu+n.getSource();n.setSource(r),i.model.component.data.outputNodes[r]=n}else(n instanceof fu||n instanceof Su)&&n.addDimensions(i.fields);return Z(t.children.map(e)).forEach(function(e){return e.parent=n}),[n]}return Z(t.children.map(e))}))).forEach(function(e){return e.parent=t.model.component.data.main})}else{var e=t.children[0];(e instanceof fu||e instanceof Su)&&e.addDimensions(t.fields),e.swapWithParent(),wu(t)}else t.children.forEach(wu);var i}function Nu(e){e instanceof pu&&J(ae(e.filter),function(e){return null===e})&&e.remove(),e instanceof cu&&!e.isRequired()&&e.remove(),e.children.forEach(Nu)}function ku(e){var n=[];return e.forEach(function e(t){0===t.numChildren()?n.push(t):t.children.forEach(e)}),n}function Ou(e){var h,m,g;Wu(e)?(m=(h=e).specifiedScales,g=h.component.scales,ie(g).forEach(function(e){var t,n,r,i,a=m[e],o=a?a.domain:void 0,u=(n=e,r=(t=h).getScaleComponent(n).get("type"),(i=function(e,t,n,r){if("unaggregated"===e){var i=Tu(t,n),a=i.valid,o=i.reason;if(!a)return void vn(o)}else if(void 0===e&&r.useUnaggregatedDomain){var a=Tu(t,n).valid;if(a)return"unaggregated"}return e}(t.scaleDomain(n),t.fieldDef(n),r,t.config.scale))!==t.scaleDomain(n)&&(t.specifiedScales[n]=Ae({},t.specifiedScales[n],{domain:i})),"x"===n&&t.channelHasField("x2")?t.channelHasField("x")?_u(r,i,t,"x").concat(_u(r,i,t,"x2")):_u(r,i,t,"x2"):"y"===n&&t.channelHasField("y2")?t.channelHasField("y")?_u(r,i,t,"y").concat(_u(r,i,t,"y2")):_u(r,i,t,"y2"):_u(r,i,t,n)),c=g[e];if(c.domains=u,ki(o)&&c.set("domainRaw",{signal:Sc+V(o)},!0),h.component.data.isFaceted){for(var s=h;!Gu(s)&&s.parent;)s=s.parent;var l=s.component.resolve.scale[e];if("shared"===l)for(var f=0,d=u;f<d.length;f++){var p=d[f];Va(p)&&(p.data=Eu+p.data.replace(Eu,""))}}})):function(c){for(var e=0,t=c.children;e<t.length;e++){var n=t[e];Ou(n)}var s=c.component.scales;ie(s).forEach(function(e){for(var t,n=null,r=0,i=c.children;r<i.length;r++){var a=i[r],o=a.component.scales[e];if(o){t=void 0===t?o.domains:t.concat(o.domains);var u=o.get("domainRaw");n&&u&&n.signal!==u.signal&&vn("The same selection must be used to override scale domains in a layered view."),n=u}}s[e].domains=t,n&&s[e].set("domainRaw",n,!0)})}(e)}function _u(e,t,n,r){var i=n.fieldDef(r);if(t&&"unaggregated"!==t&&!ki(t))return bn(t[0])?t.map(function(e){return{signal:"{data: "+Nn(e,!0)+"}"}}):[t];var a=n.stack;if(a&&r===a.fieldChannel)return"normalize"===a.offset?[[0,1]]:[{data:o=n.requestDataName(ga),field:n.vgField(r,{suffix:"start"})},{data:o,field:n.vgField(r,{suffix:"end"})}];var o,u=_t(r)?function(e,t,n){if(!bi(n))return;var r=e.sort(t);if(au(r))return{op:"min",field:lu(e,t),order:"ascending"};if(iu(r))return r;if("descending"===r)return{op:"min",field:e.vgField(t),order:"descending"};if(X(["ascending",void 0],r))return!0;return}(n,r,e):void 0;if("unaggregated"===t)return[{data:o=n.requestDataName(ga),field:n.vgField(r,{aggregate:"min"})},{data:o,field:n.vgField(r,{aggregate:"max"})}];if(!i.bin)return u?[{data:ce(u)?n.requestDataName(ga):n.requestDataName(va),field:n.vgField(r),sort:u}]:[{data:n.requestDataName(ga),field:n.vgField(r)}];if(xi(e)){var c=n.getName(zt(i.bin)+"_"+i.field+"_bins");return[{signal:"sequence("+c+".start, "+c+".stop + "+c+".step, "+c+".step)"}]}return bi(e)?[{data:ce(u)?n.requestDataName(ga):n.requestDataName(va),field:n.vgField(r,co(i,r)?{binSuffix:"range"}:{}),sort:!0!==u&&iu(u)?u:{field:n.vgField(r,{}),op:"min"}}]:"x"!==r&&"y"!==r?[{data:n.requestDataName(ga),field:n.vgField(r,{})}]:It(i.bin)&&i.bin.extent?[i.bin.extent]:[{data:o=n.requestDataName(ga),field:n.vgField(r,{})},{data:o,field:n.vgField(r,{binSuffix:"end"})}]}function Tu(e,t){return e.aggregate?Oe[e.aggregate]?"quantitative"===e.type&&"log"===t?{valid:!1,reason:rn.unaggregatedDomainWithLogScale(e)}:{valid:!0}:{valid:!1,reason:rn.unaggregateDomainWithNonSharedDomainOp(e.aggregate)}:{valid:!1,reason:rn.unaggregateDomainHasNoEffectForRawField(e)}}function Cu(e){if(Va(e)&&y(e.field))return e.field;if(!v(o=e)&&"fields"in o&&!("data"in o)){for(var t=void 0,n=0,r=e.fields;n<r.length;n++){var i=r[n];if(Va(i)&&y(i.field))if(t){if(t!==i.field)return vn("Detected faceted independent scales that union domain of multiple fields from different data sources.  We will use the first field.  The result view size may be incorrect."),t}else t=i.field}return vn("Detected faceted independent scales that union domain of identical fields from different source detected.  We will assume that this is the same field from a different fork of the same data source.  However, if this is not case, the result view size maybe incorrect."),t}var a,o;return!v(a=e)&&"fields"in a&&"data"in a?(vn("Detected faceted independent scales that union domain of multiple fields from the same data source.  We will use the first field.  The result view size may be incorrect."),y(t=e.fields[0])?t:void 0):void 0}function Au(t,e){return function(e){var t=te(e.map(function(e){return Va(e)?(e.sort,De(e,["sort"])):e}),V),n=te(e.map(function(e){if(Va(e)){var t=e.sort;return void 0===t||ce(t)||("count"===t.op&&delete t.field,"ascending"===t.order&&delete t.order),t}}).filter(function(e){return void 0!==e}),V);if(1===t.length){if(Va(o=e[0])&&0<n.length){var r=n[0];return 1<n.length&&(vn(rn.MORE_THAN_ONE_SORT),r=!0),Ae({},o,{sort:r})}return o}var i=te(n.map(function(e){return!0===e?e:"count"===e.op?e:(vn(rn.domainSortDropped(e)),!0)}),V),a=void 0;1===i.length?a=i[0]:1<i.length&&(vn(rn.MORE_THAN_ONE_SORT),a=!0);var o,u=te(e.map(function(e){return Va(e)?e.data:null}),function(e){return e});return 1===u.length&&null!==u[0]?o=Ae({data:u[0],fields:t.map(function(e){return e.field})},a?{sort:a}:{}):Ae({fields:t},a?{sort:a}:{})}(t.component.scales[e].domains.map(function(e){return Va(e)&&(e.data=t.lookupDataSource(e.data)),e}))}function Du(s){return ie(s.component.scales).reduce(function(e,t){var n=s.component.scales[t];if(n.merged)return e;var r=n.combine(),i=r.domainRaw,a=r.range,o=r.name,u=r.type,c=(r.domainRaw,r.range,De(r,["name","type","domainRaw","range"]));return a=function(e,t,n,r){if("x"===r||"y"===r){if(Ya(e))return{step:{signal:t+"_step"}};if(v(e)&&2===e.length){var i=e[0],a=e[1];if(0===i&&Ba(a))return[0,{signal:n.getSizeName(a.signal)}];if(Ba(i)&&0===a)return[{signal:n.getSizeName(i.signal)},0]}}return e}(a,o,s,t),i&&0<=i.signal.indexOf(Sc)&&(i=function(e,t){var n=JSON.parse(t.signal.replace(Sc,"")),r=se(n.selection),i=e.component.selection&&e.component.selection[r];{if(!i)return i=e.getSelectionComponent(r,n.selection),n.encoding||n.field||(n.field=i.project[0].field,1<i.project.length&&vn('A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": '+k(n.field)+".")),{signal:kc(i.type).scaleDomain+"("+k(r+yc)+", "+k(n.encoding||null)+", "+k(n.field||null)+("global"===i.resolve?")":", "+k(i.resolve)+")")};vn('Use "bind": "scales" to setup a binding for scales and selections within the same view.')}return{signal:"null"}}(s,i)),e.push(Ae({name:o,type:u,domain:Au(s,t)},i?{domainRaw:i}:{},{range:a},c)),e},[])}var zu=function(r){function e(e,t){var n=r.call(this,{},{name:e})||this;return n.merged=!1,n.domains=[],n.setWithExplicit("type",t),n}return Ce(e,r),e}(bo),Iu=["range","rangeStep","scheme"];function Ru(e){var f,d;Wu(e)?(d=(f=e).component.scales,Ot.forEach(function(e){var t=d[e];if(t){var n=f.getScaleComponent(e),r=f.specifiedScales[e],i=f.fieldDef(e),a="x"===e?"width":"y"===e?"height":void 0,o=a?!!f.component.layoutSize.get(a):void 0,u=n.get("type"),c=X(["point","band"],u)||!!r.rangeStep;a&&f.fit&&!o&&c&&(vn(rn.CANNOT_FIX_RANGE_STEP_WITH_FIT),o=!0);var s=function(e){var t=[],n=e.getScaleComponent("x"),r=n&&n.get("range");r&&Ya(r)&&x(r.step)&&t.push(r.step);var i=e.getScaleComponent("y"),a=i&&i.get("range");return a&&Ya(a)&&x(a.step)&&t.push(a.step),t}(f),l=function(e,t,n,r,i,a,o,u,c,s){for(var l=u||null===r.rangeStep,f=0,d=Iu;f<d.length;f++){var p=d[f];if(void 0!==r[p]){var h=Ci(t,p),m=Ai(e,p);if(h)if(m)vn(m);else switch(p){case"range":return xo(r[p]);case"scheme":return xo(Lu(r[p]));case"rangeStep":var g=r[p];if(null!==g){if(!u)return xo({step:g});vn(rn.rangeStepDropped(e))}}else vn(rn.scalePropertyNotWorkWithScaleType(t,p,e))}}return So(function(e,t,n,r,i,a,o,u,c){switch(e){case qe:case We:if(X(["point","band"],t)&&!c)if(e===qe&&"text"===a){if(r.scale.textXRangeStep)return{step:r.scale.textXRangeStep}}else if(r.scale.rangeStep)return{step:r.scale.rangeStep};return e===We&&Si(t)?[{signal:o},0]:[0,{signal:o}];case $e:var s=function(e,t,n){if(t)return 0;switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(rn.incompatibleChannel("size",e))}(a,i,r),l=function(e,t,n){var r=n.scale;switch(e){case"bar":case"tick":return void 0!==n.scale.maxBandSize?n.scale.maxBandSize:Fu(t,n.scale)-1;case"line":case"trail":case"rule":return n.scale.maxStrokeWidth;case"text":return n.scale.maxFontSize;case"point":case"square":case"circle":if(n.scale.maxSize)return n.scale.maxSize;var i=Fu(t,r);return(i-2)*(i-2)}throw new Error(rn.incompatibleChannel("size",e))}(a,u,r);return[s,l];case Ze:return"symbol";case et:case tt:case nt:return"ordinal"===t?"nominal"===n?"category":"ordinal":"rect"===a||"geoshape"===a?"heatmap":"ramp";case ut:return[r.scale.minOpacity,r.scale.maxOpacity]}throw new Error("Scale range undefined for channel "+e)}(e,t,n,i,a,o,c,s,l))}(e,u,i.type,r,f.config,t.get("zero"),f.mark,o,f.getName(a),s);t.setWithExplicit("range",l)}})):Uu(e,"range")}function Lu(e){if(Ni(e)){var t={scheme:e.name};return e.count&&(t.count=e.count),e.extent&&(t.extent=e.extent),t}return{scheme:e}}function Fu(e,t){return 0<e.length?Math.min.apply(null,e):t.rangeStep?t.rangeStep:21}function ju(e,t){var d,p,h;Wu(e)?(p=t,h=(d=e).component.scales,ie(h).forEach(function(e){var t=d.specifiedScales[e],n=h[e],r=d.getScaleComponent(e),i=d.fieldDef(e),a=d.sort(e),o=d.config,u=t[p],c=r.get("type"),s=Ci(c,p),l=Ai(e,p);if(void 0!==u&&(s?l&&vn(l):vn(rn.scalePropertyNotWorkWithScaleType(c,p,e))),s&&void 0===l)if(void 0!==u)n.copyKeyFromObject(p,t);else{var f=function(e,t,n,r,i,a,o,u,c,s){var l=s.scale;switch(e){case"nice":return function(e,t,n){if(!n.bin&&!X([Jr.TIME,Jr.UTC],e))return X([qe,We],t)}(i,t,n);case"padding":return function(e,t,n,r,i,a){if(X([qe,We],e)){if(Ei(t)){if(void 0!==n.continuousPadding)return n.continuousPadding;var o=i.type,u=i.orient;if("bar"===o&&!r.bin&&("vertical"===u&&"x"===e||"horizontal"===u&&"y"===e))return a.continuousBandSize}if(t===Jr.POINT)return n.pointPadding}}(t,i,l,n,c,s.bar);case"paddingInner":return function(e,t,n){if(void 0===e)return X([qe,We],t)?n.bandPaddingInner:void 0}(a,t,l);case"paddingOuter":return function(e,t,n,r,i){if(void 0===e)return X([qe,We],t)&&n===Jr.BAND?void 0!==i.bandPaddingOuter?i.bandPaddingOuter:r/2:void 0}(a,t,i,o,l);case"reverse":return function(e,t){if(Si(e)&&"descending"===t)return!0}(i,r);case"zero":return function(e,t,n,r){if(n&&"unaggregated"!==n)return!1;if("size"===e&&"quantitative"===t.type)return!0;if(!t.bin&&X([qe,We],e)){var i=r.orient,a=r.type;return!X(["bar","area","line","trail"],a)||!("horizontal"===i&&"y"===e||"vertical"===i&&"x"===e)}return!1}(t,n,u,c)}return l[e]}(p,e,i,a,r.get("type"),r.get("padding"),r.get("paddingInner"),t.domain,d.markDef,o);void 0!==f&&n.set(p,f,!1)}})):Uu(e,t)}function Uu(a,o){for(var u=a.component.scales,e=0,t=a.children;e<t.length;e++){var n=t[e];"range"===o?Ru(n):ju(n,o)}ie(u).forEach(function(e){for(var t,n=0,r=a.children;n<r.length;n++){var i=r[n].component.scales[e];if(i)t=No(t,i.getWithExplicit(o),o,"scale",Eo(function(e,t){switch(o){case"range":return e.step&&t.step?e.step-t.step:0}return 0}))}u[e].setWithExplicit(o,t)})}function Mu(e,t,n,r,i){var a=function(e,t,n,r){switch(t.type){case"nominal":case"ordinal":if(pt(e)||"discrete"===At(e))return"shape"===e&&"ordinal"===t.type&&vn(rn.discreteChannelCannotEncode(e,"ordinal")),"ordinal";if(X(["x","y"],e)){if(X(["rect","bar","rule"],n))return"band";if("bar"===n)return"band"}return"point";case"temporal":return pt(e)?"sequential":"discrete"===At(e)?(vn(rn.discreteChannelCannotEncode(e,"temporal")),"ordinal"):"time";case"quantitative":return pt(e)?t.bin?"bin-ordinal":"sequential":"discrete"===At(e)?(vn(rn.discreteChannelCannotEncode(e,"quantitative")),"ordinal"):t.bin&&"x"!==e&&"y"!==e?"bin-linear":"linear";case"latitude":case"longitude":case"geojson":return}throw new Error(rn.invalidFieldType(t.type))}(t,n,r);return _t(t)?void 0!==e?Di(t,e)?function(e,t){var n=t.type;{if(X([Yn.ORDINAL,Yn.NOMINAL],n))return void 0===e||bi(e);if(n===Yn.TEMPORAL)return X([Jr.TIME,Jr.UTC,Jr.SEQUENTIAL,void 0],e);if(n===Yn.QUANTITATIVE)return t.bin?X([Jr.BIN_LINEAR,Jr.BIN_ORDINAL,Jr.LINEAR],e):X([Jr.LOG,Jr.POW,Jr.SQRT,Jr.QUANTILE,Jr.QUANTIZE,Jr.LINEAR,Jr.SEQUENTIAL,void 0],e)}return!0}(e,n)?e:(vn(rn.scaleTypeNotWorkWithFieldDef(e,a)),a):(vn(rn.scaleTypeNotWorkWithChannel(t,e,a)),a):a:null}function Pu(e){var u,c,s,l;Wu(e)?e.component.scales=(c=(u=e).encoding,s=u.config,l=u.mark,Ot.reduce(function(e,t){var n,r=void 0,i=c[t];if(sr(i)&&l===Vt&&t===Ze&&i.type===er)return e;if(sr(i)?r=(n=i).scale:ur(i)?(n=i.condition,r=i.condition.scale):t===qe?n=kr(c.x2):t===We&&(n=kr(c.y2)),n&&null!==r&&!1!==r){var a=(r=r||{}).type,o=Mu(r.type,t,n,l,s.scale);e[t]=new zu(u.scaleName(t+"",!0),{value:o,explicit:a===o})}return e},{})):e.component.scales=function(u){for(var c=u.component.scales={},s={},i=u.component.resolve,e=function(r){Pu(r),ie(r.component.scales).forEach(function(e){if(i.scale[e]=i.scale[e]||function(e,t){if(Vu(t)||Gu(t))return"shared";if(Yu(t)||Bu(t))return X(Et,e)?"independent":"shared";throw new Error("invalid model type for resolve")}(e,u),"shared"===i.scale[e]){var t=s[e],n=r.component.scales[e].getWithExplicit("type");t?si(t.value,n.value)?s[e]=No(t,n,"type","scale",Hu):(i.scale[e]="independent",delete s[e]):s[e]=n}})},t=0,n=u.children;t<n.length;t++){var r=n[t];e(r)}return ie(s).forEach(function(e){var t=u.scaleName(e,!0),n=s[e];c[e]=new zu(t,n);for(var r=0,i=u.children;r<i.length;r++){var a=i[r],o=a.component.scales[e];o&&(a.renameScale(o.get("name"),t),o.merged=!0)}}),c}(e)}var Hu=Eo(function(e,t){return fi(e)-fi(t)});var qu=function(){function e(){this.nameMap={}}return e.prototype.rename=function(e,t){this.nameMap[e]=t},e.prototype.has=function(e){return void 0!==this.nameMap[e]},e.prototype.get=function(e){for(;this.nameMap[e]&&e!==this.nameMap[e];)e=this.nameMap[e];return e},e}();function Wu(e){return e&&"unit"===e.type}function Gu(e){return e&&"facet"===e.type}function Bu(e){return e&&"repeat"===e.type}function Yu(e){return e&&"concat"===e.type}function Vu(e){return e&&"layer"===e.type}var Xu=function(){function e(e,t,n,r,i,a){var o=this;this.children=[],this.correctDataNames=function(e){return e.from&&e.from.data&&(e.from.data=o.lookupDataSource(e.from.data)),e.from&&e.from.facet&&e.from.facet.data&&(e.from.facet.data=o.lookupDataSource(e.from.facet.data)),e},this.parent=t,this.config=r,this.repeater=i,this.name=e.name||n,this.title=y(e.title)?{text:e.title}:e.title,this.scaleNameMap=t?t.scaleNameMap:new qu,this.projectionNameMap=t?t.projectionNameMap:new qu,this.layoutSizeNameMap=t?t.layoutSizeNameMap:new qu,this.data=e.data,this.description=e.description,this.transforms=Wa(e.transform||[]),this.component={data:{sources:t?t.component.data.sources:{},outputNodes:t?t.component.data.outputNodes:{},outputNodeRefCounts:t?t.component.data.outputNodeRefCounts:{},ancestorParse:t?Ae({},t.component.data.ancestorParse):{},isFaceted:Ki(e)||t&&t.component.data.isFaceted&&!e.data},layoutSize:new bo,layoutHeaders:{row:{},column:{}},mark:null,resolve:Ae({scale:{},axis:{},legend:{}},a||{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}return Object.defineProperty(e.prototype,"width",{get:function(){return this.getSizeSignalRef("width")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.getSizeSignalRef("height")},enumerable:!0,configurable:!0}),e.prototype.initSize=function(e){var t=e.width,n=e.height;t&&this.component.layoutSize.set("width",t,!0),n&&this.component.layoutSize.set("height",n,!0)},e.prototype.parse=function(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSize(),this.parseSelection(),this.parseProjection(),this.parseData(),this.parseAxisAndHeader(),this.parseLegend(),this.parseMarkGroup()},e.prototype.parseScale=function(){!function(e){Pu(e),Ou(e);for(var t=0,n=Ti;t<n.length;t++)ju(e,n[t]);Ru(e)}(this)},e.prototype.parseProjection=function(){ru(this)},e.prototype.renameTopLevelLayoutSize=function(){"width"!==this.getName("width")&&this.renameLayoutSize(this.getName("width"),"width"),"height"!==this.getName("height")&&this.renameLayoutSize(this.getName("height"),"height")},e.prototype.parseLegend=function(){Ko(this)},e.prototype.assembleGroupStyle=function(){if("unit"===this.type||"layer"===this.type)return"cell"},e.prototype.assembleLayoutSize=function(){if("unit"===this.type||"layer"===this.type)return{width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")}},e.prototype.assembleHeaderMarks=function(){for(var e,t,n,r,i=this.component.layoutHeaders,a=[],o=0,u=so;o<u.length;o++){i[l=u[o]].title&&a.push((t=l,void 0,n=(e=this).component.layoutHeaders[t].title,r=Ae({align:{value:"center"},text:{value:n}},"vertical"===("row"===t?"vertical":void 0)?{angle:{value:270}}:{}),{name:e.getName(t+"_title"),role:t+"-title",type:"group",marks:[Ae({type:"text",role:t+"-title-text",style:"guide-title"},0<ie(r).length?{encode:{update:r}}:{})]}))}for(var c=0,s=so;c<s.length;c++){var l=s[c];a=a.concat(fo(this,l))}return a},e.prototype.assembleAxes=function(){return e=this.component.axes,t=this.config,n=e.x,r=void 0===n?[]:n,i=e.y,a=void 0===i?[]:i,r.map(function(e){return Qa(e,"main",t)}).concat(r.map(function(e){return Qa(e,"grid",t)}),a.map(function(e){return Qa(e,"main",t)}),a.map(function(e){return Qa(e,"grid",t)})).filter(function(e){return e});var e,t,n,r,i,a},e.prototype.assembleLegends=function(){return Zo(this)},e.prototype.assembleProjections=function(){return $o(this)},e.prototype.assembleTitle=function(){var e=Ae({},Ri(this.config.title).nonMark,this.title);if(e.text)return X(["unit","layer"],this.type)||(e.anchor&&"start"!==e.anchor&&vn(rn.cannotSetTitleAnchor(this.type)),e.anchor="start"),0<ie(e).length?e:void 0},e.prototype.assembleGroup=function(e){void 0===e&&(e=[]);var t={};0<(e=e.concat(this.assembleSelectionSignals())).length&&(t.signals=e);var n=this.assembleLayout();n&&(t.layout=n),t.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());var r=!this.parent||Gu(this.parent)?function n(e){return Vu(e)||Yu(e)||Bu(e)?e.children.reduce(function(e,t){return e.concat(n(t))},Du(e)):Du(e)}(this):[];0<r.length&&(t.scales=r);var i=this.assembleAxes();0<i.length&&(t.axes=i);var a=this.assembleLegends();return 0<a.length&&(t.legends=a),t},e.prototype.hasDescendantWithFieldOnChannel=function(e){for(var t=0,n=this.children;t<n.length;t++){var r=n[t];if(Wu(r)){if(r.channelHasField(e))return!0}else if(r.hasDescendantWithFieldOnChannel(e))return!0}return!1},e.prototype.getName=function(e){return se((this.name?this.name+"_":"")+e)},e.prototype.requestDataName=function(e){var t=this.getName(e),n=this.component.data.outputNodeRefCounts;return n[t]=(n[t]||0)+1,t},e.prototype.getSizeSignalRef=function(e){if(Gu(this.parent)){var t="width"===e?"x":"y",n=this.component.scales[t];if(n&&!n.merged){var r=n.get("type"),i=n.get("range");if(bi(r)&&Ya(i)){var a=n.get("name"),o=Cu(Au(this,t));return o?{signal:vo(a,n,pr({aggregate:"distinct",field:o},{expr:"datum"}))}:(vn("Unknown field for ${channel}.  Cannot calculate view size."),null)}}}return{signal:this.layoutSizeNameMap.get(this.getName(e))}},e.prototype.lookupDataSource=function(e){var t=this.component.data.outputNodes[e];return t?t.getSource():e},e.prototype.getSizeName=function(e){return this.layoutSizeNameMap.get(e)},e.prototype.renameLayoutSize=function(e,t){this.layoutSizeNameMap.rename(e,t)},e.prototype.renameScale=function(e,t){this.scaleNameMap.rename(e,t)},e.prototype.renameProjection=function(e,t){this.projectionNameMap.rename(e,t)},e.prototype.scaleName=function(e,t){return t?this.getName(e):vt(e)&&_t(e)&&this.component.scales[e]||this.scaleNameMap.has(this.getName(e))?this.scaleNameMap.get(this.getName(e)):void 0},e.prototype.projectionName=function(e){return e?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0},e.prototype.getScaleComponent=function(e){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale().  Make sure you have called parseScale or use parseUnitModelWithScale().");var t=this.component.scales[e];return t&&!t.merged?t:this.parent?this.parent.getScaleComponent(e):void 0},e.prototype.getSelectionComponent=function(e,t){var n=this.component.selection[e];if(!n&&this.parent&&(n=this.parent.getSelectionComponent(e,t)),!n)throw new Error(rn.selectionNotFound(t));return n},e}(),Qu=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ce(t,e),t.prototype.vgField=function(e,t){void 0===t&&(t={});var n=this.fieldDef(e);if(n)return pr(n,t)},t.prototype.reduceFieldDef=function(i,e,t){return Pr(this.getMapping(),function(e,t,n){var r=kr(t);return r?i(e,r,n):e},e,t)},t.prototype.forEachFieldDef=function(r,e){Mr(this.getMapping(),function(e,t){var n=kr(e);n&&r(n,t)},e)},t}(Xu),Ku={has:function(e){return"interval"===e.type&&"global"===e.resolve&&e.bind&&"scales"===e.bind},parse:function(i,e,a){var o=a.scales=[];a.project.forEach(function(e){var t=e.channel,n=i.getScaleComponent(t),r=n?n.get("type"):void 0;n&&Si(r)&&!xi(r)?(n.set("domainRaw",{signal:Cc(a,t,"data")},!0),o.push(t),i.repeater&&i.repeater.row===i.repeater.column&&i.getScaleComponent(t===qe?We:qe).set("domainRaw",{signal:Cc(a,t,"data")},!0)):vn(rn.SCALE_BINDINGS_CONTINUOUS)})},topLevelSignals:function(e,n,r){if(!e.parent)return r;var t=n.scales.filter(function(t){return!r.filter(function(e){return e.name===Cc(n,t,"data")}).length});return r.concat(t.map(function(e){return{name:Cc(n,e,"data")}}))},signals:function(e,n,r){return e.parent&&n.scales.forEach(function(t){var e=r.filter(function(e){return e.name===Cc(n,t,"data")})[0];e.push="outer",delete e.value,delete e.update}),r}};function Ju(e,t){return"domain("+k(e.scaleName(t))+")"}var Zu="_brush",$u="_scale_trigger",ec={predicate:"vlInterval",scaleDomain:"vlIntervalDomain",signals:function(b,x){var e=x.name,t=Ku.has(x),S=[],E=[],w=[],N=[];if(x.translate&&!t){var r="!event.item || event.item.mark.name !== "+k(e+Zu);tc(x,function(e,t){var n=t.between[0].filter||(t.between[0].filter=[]);n.indexOf(r)<0&&n.push(r)})}return x.project.forEach(function(e){var t=e.channel;if(t===qe||t===We){var n,r,i,a,o,u,c,s,l,f,d,p,h=(n=b,a=Cc(r=x,i=t,"visual"),o=Cc(r,i,"data"),u=Ku.has(r),c=k(n.scaleName(i)),s=n.getScaleComponent(i),l=s?s.get("type"):void 0,f=n.getSizeSignalRef(i===qe?"width":"height").signal,d=i+"(unit)",(p=tc(r,function(e,t){return e.concat({events:t.between[0],update:"["+d+", "+d+"]"},{events:t,update:"["+a+"[0], clamp("+d+", 0, "+f+")]"})})).push({events:{signal:r.name+$u},update:Si(l)&&!xi(l)?"[scale("+c+", "+o+"[0]), scale("+c+", "+o+"[1])]":"[0, 0]"}),u?[{name:o,on:[]}]:[{name:a,value:[],on:p},{name:o,on:[{events:{signal:a},update:a+"[0] === "+a+"[1] ? null : invert("+c+", "+a+")"}]}]),m=Cc(x,t,"data"),g=Cc(x,t,"visual"),v=k(b.scaleName(t)),y=Si(b.getScaleComponent(t).get("type"))?"+":"";S.push.apply(S,h),w.push(m),E.push("{encoding: "+k(t)+", field: "+k(e.field)+", extent: "+m+"}"),N.push({scaleName:b.scaleName(t),expr:"(!isArray("+m+") || ("+y+"invert("+v+", "+g+")[0] === "+y+m+"[0] && "+y+"invert("+v+", "+g+")[1] === "+y+m+"[1]))"})}else vn("Interval selections only support x and y encoding channels.")}),t||S.push({name:e+$u,update:N.map(function(e){return e.expr}).join(" && ")+" ? "+(e+$u)+" : {}"}),S.concat({name:e+bc,on:[{events:w.map(function(e){return{signal:e}}),update:w.join(" && ")+" ? {unit: "+_c(b)+", intervals: ["+E.join(", ")+"]} : null"}]})},modifyExpr:function(e,t){return t.name+bc+", "+("global"===t.resolve?"true":"{unit: "+_c(e)+"}")},marks:function(e,t,n){var r=t.name,i=Ac(t),a=i.xi,o=i.yi,u="data("+k(t.name+yc)+")";if(Ku.has(t))return n;var c={x:null!==a?{signal:r+"_x[0]"}:{value:0},y:null!==o?{signal:r+"_y[0]"}:{value:0},x2:null!==a?{signal:r+"_x[1]"}:{field:{group:"width"}},y2:null!==o?{signal:r+"_y[1]"}:{field:{group:"height"}}};if("global"===t.resolve)for(var s=0,l=ie(c);s<l.length;s++){var f=l[s];c[f]=[Ae({test:u+".length && "+u+"[0].unit === "+_c(e)},c[f]),{value:0}]}var d=t.mark,p=d.fill,h=d.fillOpacity,m=De(d,["fill","fillOpacity"]),g=ie(m).reduce(function(e,t){return e[t]=[{test:[null!==a&&r+"_x[0] !== "+r+"_x[1]",null!=o&&r+"_y[0] !== "+r+"_y[1]"].filter(function(e){return e}).join(" && "),value:m[t]},{value:null}],e},{});return[{name:r+Zu+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:p},fillOpacity:{value:h}},update:c}}].concat(n,{name:r+Zu,type:"rect",clip:!0,encode:{enter:{fill:{value:"transparent"}},update:Ae({},c,g)}})}};function tc(e,n){return e.events.reduce(function(e,t){return t.between?n(e,t):(vn(t+" is not an ordered event stream for interval selections"),e)},[])}var nc="voronoi",rc={has:function(e){return"interval"!==e.type&&e.nearest},marks:function(r,e,t){var n=Ac(e),i=n.x,a=n.y,o=r.mark;if(Jt(o))return vn(rn.nearestNotSupportForContinuous(o)),t;var u={name:r.getName(nc),type:"path",from:{data:r.getName("marks")},encode:{enter:{fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}}},transform:[{type:"voronoi",x:{expr:i||!i&&!a?"datum.datum.x || 0":"0"},y:{expr:a||!i&&!a?"datum.datum.y || 0":"0"},size:[r.getSizeSignalRef("width"),r.getSizeSignalRef("height")]}]},c=0,s=!1;return t.forEach(function(e,t){var n=e.name||"";n===r.component.mark[0].name?c=t:0<=n.indexOf(nc)&&(s=!0)}),s||t.splice(c+1,0,u),t}};function ic(r,e){var t=e.project,i=rc.has(e)?"(item().isVoronoi ? datum.datum : datum)":"datum",a=[],n=t.map(function(e){return k(e.channel)}).filter(function(e){return e}).join(", "),o=t.map(function(e){return k(e.field)}).join(", "),u=t.map(function(e){var t=e.channel,n=r.fieldDef(t);return n&&n.bin?(a.push(e.field),"["+pe(r.vgField(t,{}),i)+", "+pe(r.vgField(t,{binSuffix:"end"}),i)+"]"):""+pe(e.field,i)}).join(", ");return[{name:e.name+bc,value:{},on:[{events:e.events,update:"datum && item().mark.marktype !== 'group' ? {unit: "+_c(r)+", encodings: ["+n+"], fields: ["+o+"], values: ["+u+"]"+(a.length?", "+a.map(function(e){return k("bin_"+e)+": 1"}).join(", "):"")+"} : null",force:!0}]}]}var ac={predicate:"vlMulti",scaleDomain:"vlMultiDomain",signals:ic,modifyExpr:function(e,t){return t.name+bc+", "+("global"===t.resolve?"null":"{unit: "+_c(e)+"}")}},oc={predicate:"vlSingle",scaleDomain:"vlSingleDomain",signals:ic,topLevelSignals:function(e,t,n){var r=n.filter(function(e){return e.name===t.name}),i="data("+k(t.name+yc)+")",a=i+"[0].values";return r.length?n:n.concat({name:t.name,update:i+".length && {"+t.project.map(function(e,t){return e.field+": "+a+"["+t+"]"}).join(", ")+"}"})},modifyExpr:function(e,t){return t.name+bc+", "+("global"===t.resolve?"true":"{unit: "+_c(e)+"}")}},uc="_toggle",cc="_translate_anchor",sc="_translate_delta",lc={has:function(e){return"interval"===e.type&&e.translate},signals:function(e,t,n){var r=t.name,i=Ku.has(t),a=r+cc,o=Ac(t),u=o.x,c=o.y,s=ba(t.translate,"scope");return i||(s=s.map(function(e){return e.between[0].markname=r+Zu,e})),n.push({name:a,value:{},on:[{events:s.map(function(e){return e.between[0]}),update:"{x: x(unit), y: y(unit)"+(null!==u?", extent_x: "+(i?Ju(e,qe):"slice("+Cc(t,"x","visual")+")"):"")+(null!==c?", extent_y: "+(i?Ju(e,We):"slice("+Cc(t,"y","visual")+")"):"")+"}"}]},{name:r+sc,value:{},on:[{events:s,update:"{x: "+a+".x - x(unit), y: "+a+".y - y(unit)}"}]}),null!==u&&fc(e,t,qe,"width",n),null!==c&&fc(e,t,We,"height",n),n}};function fc(e,t,n,r,i){var a=t.name,o=Ku.has(t),u=i.filter(function(e){return e.name===Cc(t,n,o?"data":"visual")})[0],c=a+cc,s=a+sc,l=e.getSizeSignalRef(r).signal,f=e.getScaleComponent(n),d=f.get("type"),p=c+".extent_"+n,h=(o?"log"===d?"panLog":"pow"===d?"panPow":"panLinear":"panLinear")+"("+p+", "+(""+(o&&n===qe?"-":"")+s+"."+n+" / "+(o?""+l:"span("+p+")"))+(o&&"pow"===d?", "+(f.get("exponent")||1):"")+")";u.on.push({events:{signal:s},update:o?h:"clampRange("+h+", 0, "+l+")"})}var dc="_zoom_anchor",pc="_zoom_delta",hc={has:function(e){return"interval"===e.type&&e.zoom},signals:function(e,t,n){var r=t.name,i=Ku.has(t),a=r+pc,o=Ac(t),u=o.x,c=o.y,s=k(e.scaleName(qe)),l=k(e.scaleName(We)),f=ba(t.zoom,"scope");return i||(f=f.map(function(e){return e.markname=r+Zu,e})),n.push({name:r+dc,on:[{events:f,update:i?"{"+[s?"x: invert("+s+", x(unit))":"",l?"y: invert("+l+", y(unit))":""].filter(function(e){return!!e}).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:a,on:[{events:f,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),null!==u&&mc(e,t,"x","width",n),null!==c&&mc(e,t,"y","height",n),n}};function mc(e,t,n,r,i){var a=t.name,o=Ku.has(t),u=i.filter(function(e){return e.name===Cc(t,n,o?"data":"visual")})[0],c=e.getSizeSignalRef(r).signal,s=e.getScaleComponent(n),l=s.get("type"),f=o?Ju(e,n):u.name,d=a+pc,p=(o?"log"===l?"zoomLog":"pow"===l?"zoomPow":"zoomLinear":"zoomLinear")+"("+f+", "+(""+a+dc+"."+n)+", "+d+(o&&"pow"===l?", "+(s.get("exponent")||1):"")+")";u.on.push({events:{signal:d},update:o?p:"clampRange("+p+", 0, "+c+")"})}var gc={project:{has:function(e){var t=e;return void 0!==t.fields||void 0!==t.encodings},parse:function(r,e,t){var i={},a={};(e.fields||[]).forEach(function(e){return i[e]=null}),(e.encodings||[]).forEach(function(e){var t=r.fieldDef(e);if(t)if(t.timeUnit){var n=r.vgField(e);i[n]=e,a[n]={as:n,field:t.field,timeUnit:t.timeUnit}}else i[t.field]=e;else vn(rn.cannotProjectOnChannelWithoutField(e))});var n=t.project||(t.project=[]);for(var o in i)i.hasOwnProperty(o)&&n.push({field:o,channel:i[o]});var u=t.fields||(t.fields={});n.filter(function(e){return e.channel}).forEach(function(e){return u[e.channel]=e.field}),ie(a).length&&(t.timeUnit=new gu(null,a))}},toggle:{has:function(e){return"multi"===e.type&&e.toggle},signals:function(e,t,n){return n.concat({name:t.name+uc,value:!1,on:[{events:t.events,update:t.toggle}]})},modifyExpr:function(e,t,n){var r=t.name+bc,i=t.name+uc;return i+" ? null : "+r+", "+("global"===t.resolve?i+" ? null : true, ":i+" ? null : {unit: "+_c(e)+"}, ")+i+" ? "+r+" : null"}},scales:Ku,translate:lc,zoom:hc,inputs:{has:function(e){return"single"===e.type&&"global"===e.resolve&&e.bind&&"scales"!==e.bind},topLevelSignals:function(e,n,r){var i=n.name,t=n.project,a=n.bind,o=rc.has(n)?"(item().isVoronoi ? datum.datum : datum)":"datum";return t.forEach(function(e){var t=se(i+"_"+e.field);r.filter(function(e){return e.name===t}).length||r.unshift({name:t,value:"",on:[{events:n.events,update:"datum && item().mark.marktype !== 'group' ? "+pe(e.field,o)+" : null"}],bind:a[e.field]||a[e.channel]||a})}),r},signals:function(e,t,n){var r=t.name,i=t.project,a=n.filter(function(e){return e.name===r+bc})[0],o=i.map(function(e){return k(e.field)}).join(", "),u=i.map(function(e){return se(r+"_"+e.field)});return u.length&&(a.update=u.join(" && ")+" ? {fields: ["+o+"], values: ["+u.join(", ")+"]} : null"),delete a.value,delete a.on,n}},nearest:rc};function vc(e,t){for(var n in gc)gc[n].has(e)&&t(gc[n])}var yc="_store",bc="_tuple",xc="_modify",Sc="_selection_domain_";function Ec(n,r){return Nc(n,function(t,e){r=e.marks?e.marks(n,t,r):r,vc(t,function(e){e.marks&&(r=e.marks(n,t,r))})}),r}function wc(o,e,u){var c=[];var t=le(e,function(e){var t=se(e),n=o.getSelectionComponent(t,e),r=k(t+yc);if(n.timeUnit){var i=u||o.component.data.raw,a=n.timeUnit.clone();i.parent?a.insertAsParentOf(i):i.parent=a}return"none"!==n.empty&&c.push(r),kc(n.type).predicate+"("+r+", datum"+("global"===n.resolve?")":", "+k(n.resolve)+")")});return(c.length?"!("+c.map(function(e){return"length(data("+e+"))"}).join(" || ")+") || ":"")+"("+t+")"}function Nc(e,t){var n=e.component.selection;for(var r in n)if(n.hasOwnProperty(r)){var i=n[r];t(i,kc(i.type))}}function kc(e){switch(e){case"single":return oc;case"multi":return ac;case"interval":return ec}return null}function Oc(e){for(var t=e.parent;t&&!Gu(t);)t=t.parent;return t}function _c(e){var t=k(e.name),n=Oc(e);return n&&(t+=(n.facet.row?" + '_' + ("+pe(n.vgField("row"),"facet")+")":"")+(n.facet.column?" + '_' + ("+pe(n.vgField("column"),"facet")+")":"")),t}function Tc(e){var t=!1;return Nc(e,function(e){t=t||e.project.some(function(e){return e.field===Ii})}),t}function Cc(e,t,n){var r=e._signalNames||(e._signalNames={});if(r[t]&&r[t][n])return r[t][n];r[t]=r[t]||{};for(var i=se(e.name+"_"+("visual"===n?t:e.fields[t])),a=i,o=1;r[a];)a=i+"_"+o++;return r[a]=r[t][n]=a}function Ac(e){var n=null,r=null,i=null,a=null;return e.project.forEach(function(e,t){e.channel===qe?(n=e,r=t):e.channel===We&&(i=e,a=t)}),{x:n,xi:r,y:i,yi:a}}function Dc(e){return e&&!!e.field&&void 0!==e.equal}function zc(e){return!!(e&&e.field&&v(e.range)&&2===e.range.length)}function Ic(e){return e&&!!e.field&&(v(e.oneOf)||v(e.in))}function Rc(e){return Ic(e)||Dc(e)||zc(e)}function Lc(n,e,r){return le(e,function(e){return y(e)?e:(t=e)&&t.selection?wc(n,e.selection,r):function(t,e){void 0===e&&(e=!0);var n=t.timeUnit?"time("+Wn(t.timeUnit,t.field)+")":pr(t,{expr:"datum"});{if(Dc(t))return n+"==="+Fc(t.equal,t.timeUnit);if(Ic(t)){var r=t.oneOf||t.in;return"indexof(["+r.map(function(e){return Fc(e,t.timeUnit)}).join(",")+"], "+n+") !== -1"}if(zc(t)){var i=t.range[0],a=t.range[1];if(null!==i&&null!==a&&e)return"inrange("+n+", ["+Fc(i,t.timeUnit)+", "+Fc(a,t.timeUnit)+"])";var o=[];return null!==i&&o.push(n+" >= "+Fc(i,t.timeUnit)),null!==a&&o.push(n+" <= "+Fc(a,t.timeUnit)),0<o.length?o.join(" && "):"true"}}throw new Error("Invalid field predicate: "+JSON.stringify(t))}(e);var t})}function Fc(e,t){if(bn(e))return"time("+Nn(e,!0)+")";if(An(t)){var n={};return n[t]=e,"time("+Nn(n,!0)+")"}return zn(t)?Fc(e,Fn(t)):JSON.stringify(e)}function jc(e){return Rc(e)&&e.timeUnit?Ae({},e,{timeUnit:Bn(e.timeUnit)}):e}function Uc(e,t){var n;n="as"in e?[e.as,e.as+"_end"]:[pr(e,{}),pr(e,{binSuffix:"end"})];var r,i,a,o,u=Tr(e.bin,void 0)||{},c=(r=u,i=e.field,zt(r)+"_"+i),s=(o=c,{signal:(a=t).getName(o+"_bins"),extentSignal:a.getName(o+"_extent")}),l=s.signal,f=s.extentSignal;return{key:c,binComponent:Ae({bin:u,field:e.field,as:n},l?{signal:l}:{},f?{extentSignal:f}:{})}}var Mc=function(r){function u(e,t){var n=r.call(this,e)||this;return n.bins=t,n}return Ce(u,r),u.prototype.clone=function(){return new u(null,ue(this.bins))},u.makeFromEncoding=function(e,o){var t=o.reduceFieldDef(function(e,t,n){if(t.bin){var r=Uc(t,o),i=r.key,a=r.binComponent;e[i]=Ae({},a,e[i],function(e,t,n,r){if(co(t,n)){var i=Wu(e)&&(e.axis(n)||e.legend(n))||{},a=pr(t,{expr:"datum"}),o=pr(t,{expr:"datum",binSuffix:"end"});return{formulaAs:pr(t,{binSuffix:"range"}),formula:ro(a,o,i.format,r)}}return{}}(o,t,n,o.config))}return e},{});return 0===ie(t).length?null:new u(e,t)},u.makeFromTransform=function(e,t,n){var r,i=Uc(t,n),a=i.key,o=i.binComponent;return new u(e,((r={})[a]=o,r))},u.prototype.merge=function(e){this.bins=Ae({},this.bins,e.bins),e.remove()},u.prototype.producedFields=function(){var t={};return ae(this.bins).forEach(function(e){e.as.forEach(function(e){return t[e]=!0})}),t},u.prototype.dependentFields=function(){var t={};return ae(this.bins).forEach(function(e){t[e.field]=!0}),t},u.prototype.assemble=function(){return Z(ae(this.bins).map(function(e){var t=[],n=Ae({type:"bin",field:e.field,as:e.as,signal:e.signal},e.bin);return!e.bin.extent&&e.extentSignal&&(t.push({type:"extent",field:e.field,signal:e.extentSignal}),n.extent={signal:e.extentSignal}),t.push(n),e.formula&&t.push({type:"formula",expr:e.formula,as:e.formulaAs}),t}))},u}(uu),Pc=function(i){function e(e,t,n){var r=i.call(this,e)||this;return r.model=t,r.filter=n,r.expr=Lc(r.model,r.filter,r),r}return Ce(e,i),e.prototype.clone=function(){return new e(null,this.model,ue(this.filter))},e.prototype.assemble=function(){return{type:"filter",expr:this.expr}},e}(uu),Hc=function(a){function o(e,t,n,r){var i=a.call(this,e)||this;return i.fields=t,i.geojson=n,i.signal=r,i}return Ce(o,a),o.prototype.clone=function(){return new o(null,ue(this.fields),this.geojson,this.signal)},o.parseAll=function(n,r){var i=0;if([[Xe,Ye],[Qe,Ve]].forEach(function(e){var t=e.map(function(e){return r.channelHasField(e)?r.fieldDef(e).field:void 0});(t[0]||t[1])&&(n=new o(n,t,null,r.getName("geojson_"+i++)))}),r.channelHasField(Ze)){var e=r.fieldDef(Ze);e.type===er&&(n=new o(n,null,e.field,r.getName("geojson_"+i++)))}return n},o.prototype.assemble=function(){return Ae({type:"geojson"},this.fields?{fields:this.fields}:{},this.geojson?{geojson:this.geojson}:{},{signal:this.signal})},o}(uu),qc=function(a){function o(e,t,n,r){var i=a.call(this,e)||this;return i.projection=t,i.fields=n,i.as=r,i}return Ce(o,a),o.prototype.clone=function(){return new o(null,this.projection,ue(this.fields),ue(this.as))},o.parseAll=function(r,i){return i.projectionName()&&[[Xe,Ye],[Qe,Ve]].forEach(function(e){var t=e.map(function(e){return i.channelHasField(e)?i.fieldDef(e).field:void 0}),n=e[0]===Qe?"2":"";(t[0]||t[1])&&(r=new o(r,i.projectionName(),t,[i.getName("x"+n),i.getName("y"+n)]))}),r},o.prototype.assemble=function(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}},o}(uu),Wc=function(t){function e(e){return t.call(this,e)||this}return Ce(e,t),e.prototype.clone=function(){return new e(null)},e.prototype.producedFields=function(){return(e={})[Ii]=!0,e;var e},e.prototype.assemble=function(){return{type:"identifier",as:Ii}},e}(uu),Gc=function(i){function s(e,t,n){var r=i.call(this,e)||this;return r.transform=t,r.secondary=n,r}return Ce(s,i),s.make=function(e,t,n,r){var i=t.component.data.sources,a=new mu(n.from.data),o=i[a.hash()];o||(o=i[a.hash()]=a);var u=t.getName("lookup_"+r),c=new cu(o,u,"lookup",t.component.data.outputNodeRefCounts);return new s(e,n,(t.component.data.outputNodes[u]=c).getSource())},s.prototype.producedFields=function(){return g(this.transform.from.fields||(this.transform.as instanceof Array?this.transform.as:[this.transform.as]))},s.prototype.assemble=function(){var e;if(this.transform.from.fields)e=Ae({values:this.transform.from.fields},this.transform.as?{as:this.transform.as instanceof Array?this.transform.as:[this.transform.as]}:{});else{var t=this.transform.as;y(t)||(vn(rn.NO_FIELDS_NEEDS_AS),t="_lookup"),e={as:[t]}}return Ae({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},e,this.transform.default?{default:this.transform.default}:{})},s}(uu),Bc=function(r){function e(e,t){var n=r.call(this,e)||this;return n.transform=t,n}return Ce(e,r),e.prototype.clone=function(){return new e(this.parent,ue(this.transform))},e.prototype.producedFields=function(){var t=this,n={};return this.transform.window.forEach(function(e){n[t.getDefaultName(e)]=!0}),n},e.prototype.getDefaultName=function(e){return void 0===e.as?String(e.op)+"_field":e.as},e.prototype.assemble=function(){for(var e=[],t=[],n=[],r=[],i=0,a=this.transform.window;i<a.length;i++){var o=a[i];t.push(o.op),n.push(this.getDefaultName(o)),r.push(void 0===o.param?null:o.param),e.push(void 0===o.field?null:o.field)}var u=this.transform.frame,c=this.transform.groupby,s=[],l=[];if(void 0!==this.transform.sort)for(var f=0,d=this.transform.sort;f<d.length;f++){var p=d[f];s.push(p.field),l.push(void 0===p.order?null:p.order)}var h={field:s,order:l},m=this.transform.ignorePeers,g={type:"window",params:r,as:n,ops:t,fields:e,sort:h};return void 0!==m&&(g.ignorePeers=m),void 0!==c&&(g.groupby=c),void 0!==u&&(g.frame=u),g},e}(uu);function Yc(e){var t=function(e,t){if(e.data||!e.parent){var n=new mu(e.data),r=n.hash();return r in t?t[r]:t[r]=n}return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}(e,e.component.data.sources),n=e.component.data.outputNodes,r=e.component.data.outputNodeRefCounts;Tc(e)&&(Wu(e)||Vu(e))&&(t=new Wc(t));var i,a,o,u=e.parent&&Vu(e.parent);(Wu(e)||Gu(e))&&u&&(t=Mc.makeFromEncoding(t,e)||t),0<e.transforms.length&&(i=t,o=0,(a=e).transforms.forEach(function(e){if(Ma(e))i=new su(i,e);else if(Fa(e)){var t={},n=e.filter,r=null;Dc(n)?r=n.equal:zc(n)?r=n.range[0]:Ic(n)&&(r=(n.oneOf||n.in)[0]),r&&(bn(r)?t[n.field]="date":x(r)?t[n.field]="number":y(r)&&(t[n.field]="string")),0<ie(t).length&&(i=new hu(i,t)),i=new Pc(i,a,e.filter)}else if(Pa(e))i=Mc.makeFromTransform(i,e,a);else if(Ha(e))i=gu.makeFromTransform(i,e);else if(qa(e))i=fu.makeFromTransform(i,e),Tc(a)&&(i=new Wc(i));else if(ja(e))i=Gc.make(i,a,e,o++);else{if(!Ua(e))return void vn(rn.invalidTransformIgnored(e));i=new Bc(i,e)}}),t=i);var c=hu.make(t,e);c&&(t=c),Wu(e)&&(t=Hc.parseAll(t,e),t=qc.parseAll(t,e)),(Wu(e)||Gu(e))&&(u||(t=Mc.makeFromEncoding(t,e)||t),t=gu.makeFromEncoding(t,e)||t,t=su.parseAllForSortIndex(t,e));var s=e.getName(va),l=new cu(t,s,va,r);if(t=n[s]=l,Wu(e)){var f=fu.makeFromEncoding(t,e);f&&(t=f,Tc(e)&&(t=new Wc(t))),t=Su.make(t,e)||t}Wu(e)&&(t=pu.make(t,e)||t);var d=e.getName(ga),p=new cu(t,d,ga,r);t=n[d]=p;var h=null;if(Gu(e)){var m=e.getName("facet");h=new du(t,e,m,p.getSource()),t=n[m]=h}var g=Ae({},e.component.data.ancestorParse,c?c.parse:{});return Ae({},e.component.data,{outputNodes:n,outputNodeRefCounts:r,raw:l,main:p,facetRoot:h,ancestorParse:g})}var Vc=function(o){function e(e,t,n,r,i,a){return o.call(this,e,t,n,r,i,a)||this}return Ce(e,o),e.prototype.parseData=function(){this.component.data=Yc(this),this.children.forEach(function(e){e.parseData()})},e.prototype.parseSelection=function(){var n=this;this.component.selection={};for(var e=function(t){t.parseSelection(),ie(t.component.selection).forEach(function(e){n.component.selection[e]=t.component.selection[e]})},t=0,r=this.children;t<r.length;t++){e(r[t])}},e.prototype.parseMarkGroup=function(){for(var e=0,t=this.children;e<t.length;e++){t[e].parseMarkGroup()}},e.prototype.parseAxisAndHeader=function(){for(var e=0,t=this.children;e<t.length;e++){t[e].parseAxisAndHeader()}},e.prototype.assembleSelectionTopLevelSignals=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionTopLevelSignals(e)},e)},e.prototype.assembleSelectionSignals=function(){return this.children.forEach(function(e){return e.assembleSelectionSignals()}),[]},e.prototype.assembleLayoutSignals=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleLayoutSignals())},ho(this))},e.prototype.assembleSelectionData=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionData(e)},e)},e.prototype.assembleMarks=function(){return this.children.map(function(e){var t=e.assembleTitle(),n=e.assembleGroupStyle(),r=e.assembleLayoutSize();return Ae({type:"group",name:e.getName("group")},t?{title:t}:{},n?{style:n}:{},r?{encode:{update:r}}:{},e.assembleGroup())})},e}(Xu);function Xc(e){Kc(e);var t=e.component.layoutSize;t.setWithExplicit("width",Jc(e,"width")),t.setWithExplicit("height",Jc(e,"height"))}var Qc=Xc;function Kc(e){for(var t=0,n=e.children;t<n.length;t++){n[t].parseLayoutSize()}}function Jc(e,t){for(var n,r="width"===t?"x":"y",i=e.component.resolve,a=0,o=e.children;a<o.length;a++){var u=(f=o[a]).component.layoutSize.getWithExplicit(t),c=i.scale[r];if("independent"===c&&"range-step"===u.value){n=void 0;break}if(n){if("independent"===c&&n.value!==u.value){n=void 0;break}n=No(n,u,t,"")}else n=u}if(n){for(var s=0,l=e.children;s<l.length;s++){var f=l[s];e.renameLayoutSize(f.getName(t),e.getName(t)),f.component.layoutSize.set(t,"merged",!1)}return n}return{explicit:!1,value:void 0}}function Zc(e,t){var n="width"===t?"x":"y",r=e.config,i=e.getScaleComponent(n);if(i){var a=i.get("type"),o=i.get("range");return bi(a)&&Ya(o)?"range-step":r.view[t]}return"width"===t&&"text"===e.mark?r.scale.textXRangeStep:r.scale.rangeStep||wi.rangeStep}var $c=function(o){function e(e,t,n,r,i){var a=o.call(this,e,t,n,i,r,e.resolve)||this;return a.type="concat",e.resolve&&e.resolve.axis&&("shared"===e.resolve.axis.x||"shared"===e.resolve.axis.y)&&vn(rn.CONCAT_CANNOT_SHARE_AXIS),a.isVConcat=ta(e),a.children=(ta(e)?e.vconcat:e.hconcat).map(function(e,t){return ws(e,a,a.getName("concat_"+t),void 0,r,i,!1)}),a}return Ce(e,o),e.prototype.parseLayoutSize=function(){!function(e){Kc(e);var t=e.component.layoutSize,n=e.isVConcat?"width":"height";t.setWithExplicit(n,Jc(e,n))}(this)},e.prototype.parseAxisGroup=function(){return null},e.prototype.assembleLayout=function(){return Ae({padding:{row:10,column:10},offset:10},this.isVConcat?{columns:1}:{},{bounds:"full",align:"each"})},e}(Vc);function es(i){var a=0;return function t(e,n){e instanceof mu&&(pa(e.data)||(i.push(n),n={name:null,source:n.name,transform:[]}));if(e instanceof hu&&(e.parent instanceof mu&&!n.source?(n.format=Ae({},n.format||{},{parse:e.assembleFormatParse()}),n.transform=n.transform.concat(e.assembleTransforms(!0))):n.transform=n.transform.concat(e.assembleTransforms())),e instanceof du)return n.name||(n.name="data_"+a++),!n.source||0<n.transform.length?(i.push(n),e.data=n.name):e.data=n.source,void e.assemble().forEach(function(e){return i.push(e)});(e instanceof Pc||e instanceof su||e instanceof qc||e instanceof Hc||e instanceof fu||e instanceof Gc||e instanceof Bc||e instanceof Wc)&&n.transform.push(e.assemble()),(e instanceof pu||e instanceof Mc||e instanceof gu||e instanceof Su)&&(n.transform=n.transform.concat(e.assemble())),e instanceof fu&&(n.name||(n.name="data_"+a++)),e instanceof cu&&(n.source&&0===n.transform.length?e.setSource(n.source):e.parent instanceof cu?e.setSource(n.name):(n.name||(n.name="data_"+a++),e.setSource(n.name),1===e.numChildren()&&(i.push(n),n={name:null,source:n.name,transform:[]})));switch(e.numChildren()){case 0:e instanceof cu&&(!n.source||0<n.transform.length)&&i.push(n);break;case 1:t(e.children[0],n);break;default:n.name||(n.name="data_"+a++);var r=n.name;!n.source||0<n.transform.length?i.push(n):r=n.source,e.children.forEach(function(e){t(e,{name:null,source:r,transform:[]})})}}}function ts(e,t){return ir(e.field)?e.field.repeat in t?Ae({},e,{field:t[e.field.repeat]}):void vn(rn.noSuchRepeatedValue(e.field.repeat)):e}function ns(e,t){if(void 0!==(e=ts(e,t))){if(e.sort&&iu(e.sort)){var n=ts(e.sort,t);e=Ae({},e,n?{sort:n}:{})}return e}}function rs(e,t){if(!sr(e)){if(ur(e)){if(n=ns(e.condition,t))return Ae({},e,{condition:n});e.condition;return De(e,["condition"])}return e}var n;return(n=ns(e,t))?n:or(e)?{condition:e.condition}:void 0}function is(e,t){var n={};for(var r in e)if(e.hasOwnProperty(r)){var i=e[r];if(v(i))n[r]=i.map(function(e){return rs(e,t)}).filter(function(e){return e});else{var a=rs(i,t);a&&(n[r]=a)}}return n}var as=function(u){function s(e,t,n,r,i){var a=u.call(this,e,t,n,i,r,e.resolve)||this;a.type="facet",a.child=ws(e.spec,a,a.getName("child"),void 0,r,i,!1),a.children=[a.child];var o=is(e.facet,r);return a.facet=a.initFacet(o),a}return Ce(s,u),s.prototype.initFacet=function(e){return Pr(e,function(e,t,n){return X([Ke,Je],n)?void 0===t.field?vn(rn.emptyFieldDef(t,n)):e[n]=Or(t,n):vn(rn.incompatibleChannel(n,"facet")),e},{})},s.prototype.channelHasField=function(e){return!!this.facet[e]},s.prototype.fieldDef=function(e){return this.facet[e]},s.prototype.parseData=function(){this.component.data=Yc(this),this.child.parseData()},s.prototype.parseLayoutSize=function(){Kc(this)},s.prototype.parseSelection=function(){this.child.parseSelection(),this.component.selection=this.child.component.selection},s.prototype.parseMarkGroup=function(){this.child.parseMarkGroup()},s.prototype.parseAxisAndHeader=function(){this.child.parseAxisAndHeader(),this.parseHeader("column"),this.parseHeader("row"),this.mergeChildAxis("x"),this.mergeChildAxis("y")},s.prototype.parseHeader=function(e){if(this.channelHasField(e)){var t=this.facet[e],n=t.header||{},r=void 0!==t.title?t.title:void 0!==n.title?n.title:wr(t,this.config);this.child.component.layoutHeaders[e].title&&(r+=" / "+this.child.component.layoutHeaders[e].title,this.child.component.layoutHeaders[e].title=null),this.component.layoutHeaders[e]={title:r,facetFieldDef:t,header:[this.makeHeaderComponent(e,!0)]}}},s.prototype.makeHeaderComponent=function(e,t){var n="row"===e?"height":"width";return{labels:t,sizeSignal:this.child.component.layoutSize.get(n)?this.child.getSizeSignalRef(n):void 0,axes:[]}},s.prototype.mergeChildAxis=function(e){var t,n=this.child;if(n.component.axes[e]){var r=this.component,i=r.layoutHeaders,a=r.resolve;if(a.axis[e]=yo(a,e),"shared"===a.axis[e])for(var o="x"===e?"column":"row",u=i[o],c=0,s=n.component.axes[e];c<s.length;c++){var l=s[c],f="top"===(t=l.get("orient"))||"left"===t?"header":"footer";u[f]=u[f]||[this.makeHeaderComponent(o,!1)];var d=Qa(l,"main",this.config,{header:!0});u[f][0].axes.push(d),l.mainExtracted=!0}}},s.prototype.assembleSelectionTopLevelSignals=function(e){return this.child.assembleSelectionTopLevelSignals(e)},s.prototype.assembleSelectionSignals=function(){return this.child.assembleSelectionSignals(),[]},s.prototype.assembleSelectionData=function(e){return this.child.assembleSelectionData(e)},s.prototype.getLayoutBandMixins=function(e){for(var t={},n="header"===e?"headerBand":"footerBand",r=0,i=["row","column"];r<i.length;r++){var a=i[r],o=this.component.layoutHeaders[a][e];if(o&&o[0]){var u="row"===a?"height":"width";this.child.component.layoutSize.get(u)||(t[n]=t[n]||{},t[n][a]=.5)}}return t},s.prototype.assembleLayout=function(){var e=this.channelHasField("column")?this.columnDistinctSignal():1;return Ae({padding:{row:10,column:10}},this.getLayoutBandMixins("header"),this.getLayoutBandMixins("footer"),{offset:10,columns:e,bounds:"full",align:"all"})},s.prototype.assembleLayoutSignals=function(){return this.child.assembleLayoutSignals()},s.prototype.columnDistinctSignal=function(){if(!(this.parent&&this.parent instanceof s))return{signal:"length(data('"+this.getName("column_domain")+"'))"}},s.prototype.assembleGroup=function(e){return this.parent&&this.parent instanceof s?Ae({},this.channelHasField("column")?{encode:{update:{columns:{field:pr(this.facet.column,{prefix:"distinct"})}}}}:{},u.prototype.assembleGroup.call(this,e)):u.prototype.assembleGroup.call(this,e)},s.prototype.getCardinalityAggregateForChild=function(){var e=[],t=[];if(this.child instanceof s)this.child.channelHasField("column")&&(e.push(pr(this.child.facet.column)),t.push("distinct"));else for(var n=0,r=["x","y"];n<r.length;n++){var i=r[n],a=this.child.component.scales[i];if(a&&!a.merged){var o=a.get("type"),u=a.get("range");if(bi(o)&&Ya(u)){var c=Cu(Au(this.child,i));c?(e.push(c),t.push("distinct")):vn("Unknown field for ${channel}.  Cannot calculate view size.")}}}return e.length?{fields:e,ops:t}:void 0},s.prototype.assembleMarks=function(){var t,e,n,r=this.child,i=this.facet,a=this.component.data.facetRoot,o=(t=a,n=es(e=[]),t.children.forEach(function(e){return n(e,{source:t.name,name:null,transform:[]})}),e),u=this.channelHasField(Ke),c=this.channelHasField(Je),s=r.assembleLayoutSize(),l={};u&&c&&(l.aggregate={cross:!0});var f=this.getCardinalityAggregateForChild();f&&(l.aggregate=Ae({},l.aggregate,f));var d=r.assembleTitle(),p=r.assembleGroupStyle();return[Ae({name:this.getName("cell"),type:"group"},d?{title:d}:{},p?{style:p}:{},{from:{facet:Ae({name:a.name,data:a.data,groupby:[].concat(u?[this.vgField(Ke)]:[],c?[this.vgField(Je)]:[])},l)},sort:{field:[].concat(u?[this.vgField(Ke,{expr:"datum"})]:[],c?[this.vgField(Je,{expr:"datum"})]:[]),order:[].concat(u?[i.row.sort||"ascending"]:[],c?[i.column.sort||"ascending"]:[])}},0<o.length?{data:o}:{},s?{encode:{update:s}}:{},r.assembleGroup())]},s.prototype.getMapping=function(){return this.facet},s}(Qu);var os=function(i){function e(e,t,n){void 0===e&&(e={}),void 0===t&&(t={}),void 0===n&&(n=!1);var r=i.call(this)||this;return r.explicit=e,r.implicit=t,r.mainExtracted=n,r}return Ce(e,i),e.prototype.clone=function(){return new e(ue(this.explicit),ue(this.implicit),this.mainExtracted)},e.prototype.hasAxisPart=function(e){return"axis"===e||("grid"===e||"title"===e?!!this.get(e):!(!1===(t=this.get(e))||null===t));var t},e}(bo);function us(e,t,n,r,i){void 0===r&&(r="");for(var a=0,o=("band"===i?["axisBand"]:[]).concat(["x"===n?"axisX":"axisY","axis"+r.substr(0,1).toUpperCase()+r.substr(1),"axis"]);a<o.length;a++){var u=o[a];if(t[u]&&void 0!==t[u][e])return t[u][e]}}function cs(e,t,n,r){var i=e.fieldDef(t)||("x"===t?e.fieldDef("x2"):"y"===t?e.fieldDef("y2"):void 0),a=e.axis(t),o=e.config,u={};if(zr(i)){var c=e.getScaleComponent(t).get("type")===Jr.UTC;u.text={signal:io("datum.value",i.timeUnit,a.format,o.axis.shortTimeLabels,o.timeFormat,c)}}var s,l,f,d,p=us("labelAngle",e.config,t,r,e.getScaleComponent(t).get("type"));if(void 0===p&&(p=function(e,t,n){{if(void 0!==e.labelAngle)return(e.labelAngle%360+360)%360;if(t===qe&&X([$n,Jn],n.type))return 270}return}(a,t,i))&&(u.angle={value:p}),void 0!==p){var h=(f=((f=p)%360+360)%360,"top"===(d=r)||"bottom"===d?f%180==0?"center":0<f&&f<180?"top"===d?"right":"left":"top"===d?"left":"right":(f+90)%180==0?"center":90<=f&&f<270?"left"===d?"left":"right":"left"===d?"right":"left");h&&(u.align={value:h}),u.baseline=(s=p,"top"===(l=r)||"bottom"===l?s<=45||315<=s?{value:"top"===l?"bottom":"top"}:135<=s&&s<=225?{value:"top"===l?"top":"bottom"}:{value:"middle"}:s<=45||315<=s||135<=s&&s<=225?{value:"middle"}:45<=s&&s<=135?{value:"left"===l?"top":"bottom"}:{value:"left"===l?"bottom":"top"})}return u=Ae({},u,n),0===ie(u).length?void 0:u}function ss(n){return Et.reduce(function(e,t){return n.component.scales[t]&&n.axis(t)&&(e[t]=[function(i,a){var o=a.axis(i),u=new os;Me.forEach(function(e){var t=function(e,t,n,r){var i=r.fieldDef(n);switch(e){case"scale":return r.scaleName(n);case"gridScale":return function(e,t){var n="x"===t?"y":"x";if(e.getScaleComponent(n))return e.scaleName(n)}(r,n);case"format":return eo(i,t.format,r.config);case"grid":var a=r.getScaleComponent(n).get("type");return $a(t.grid,(v=i,!bi(a)&&!v.bin));case"labelFlush":return h=i,m=n,void 0!==(g=t).labelFlush?g.labelFlush:!("x"!==m||!X(["quantitative","temporal"],h.type))||void 0;case"labelOverlap":var a=r.getScaleComponent(n).get("type");return f=i,p=a,void 0!==(d=t).labelOverlap?d.labelOverlap:"nominal"!==f.type?"log"!==p||"greedy":void 0;case"orient":return $a(t.orient,function(e){switch(e){case qe:return"bottom";case We:return"left"}throw new Error(rn.INVALID_CHANNEL_FOR_AXIS)}(n));case"tickCount":var a=r.getScaleComponent(n).get("type"),o="x"===n?"width":"y"===n?"height":void 0,u=o?r.getSizeSignalRef(o):void 0;return $a(t.tickCount,function(e,t,n,r){if(!bi(n)&&"log"!==n&&!X(["month","hours","day","quarter"],t.timeUnit))return t.bin?{signal:"ceil("+r.signal+"/20)"}:{signal:"ceil("+r.signal+"/40)"}}(0,i,a,u));case"title":var c="x"===n?"x2":"y2",s=r.fieldDef(c),l=void 0!==i.title?i.title:void 0===t.title?void 0:t.title;return $a(l,oo([ar(i)],s?[ar(s)]:[]));case"values":return function(e,t,n,r){var i=e.values;if(e.values&&bn(i[0]))return i.map(function(e){return{signal:Nn(e,!0)}});if(!i&&n.bin&&n.type===Kn){var a=t.scaleDomain(r);if(a&&"unaggregated"!==a&&!ki(a))return i;var o=t.getName(zt(n.bin)+"_"+n.field+"_bins");return{signal:"sequence("+o+".start, "+o+".stop + "+o+".step, "+o+".step)"}}return i}(t,r,i,n)}var f,d,p;var h,m,g;var v;return Fe(e)?t[e]:void 0}(e,o,i,a);if(void 0!==t){var n="values"===e?!!o.values:"encode"===e?!!o.encoding||!!o.labelAngle:t===o[e],r=us(e,a.config,i,u.get("orient"),a.getScaleComponent(i).get("type"));(n||void 0===r)&&u.set(e,t,n)}});var r=o.encoding||{},e=ze.reduce(function(e,t){if(!u.hasAxisPart(t))return e;var n="labels"===t?cs(a,i,r.labels||{},u.get("orient")):r[t]||{};return void 0!==n&&0<ie(n).length&&(e[t]={update:n}),e},{});0<ie(e).length&&u.set("encode",e,!!o.encoding||void 0!==o.labelAngle);return u}(t,n)]),e},{})}var ls={bottom:"top",top:"bottom",left:"right",right:"left"};function fs(e,t){if(!e)return t.map(function(e){return e.clone()});if(e.length===t.length){for(var n=e.length,r=0;r<n;r++){var i=e[r],a=t[r];if(!!i!=!!a)return;if(i&&a){var o=i.getWithExplicit("orient"),u=a.getWithExplicit("orient");if(o.explicit&&u.explicit&&o.value!==u.value)return;e[r]=ds(i,a)}}return e}}function ds(t,r){for(var e=function(n){var e=No(t.getWithExplicit(n),r.getWithExplicit(n),n,"axis",function(e,t){switch(n){case"title":return uo(e,t);case"gridScale":return{explicit:e.explicit,value:e.value||t.value}}return wo(e,t,n,"axis")});t.setWithExplicit(n,e)},n=0,i=Me;n<i.length;n++){e(i[n])}return t}function ps(e,t,n){var r,i,a,o=$t(e)?Ae({},e):{type:e},u=o.orient||Ja("orient",o,n);return o.orient=function(e,t,n){switch(e){case Ht:case Xt:case Qt:case qt:case Bt:return}var r=t.y2,i=t.x2;switch(e){case Yt:if(i&&r)return;case Mt:case Ut:if(r)return"vertical";if(i)return"horizontal";if(e===Yt){if(t.x&&!t.y)return"vertical";if(t.y&&!t.x)return"horizontal"}case Pt:case Wt:var a=sr(t.x)&&mr(t.x),o=sr(t.y)&&mr(t.y);if(a&&!o)return"tick"!==e?"horizontal":"vertical";if(!a&&o)return"tick"!==e?"vertical":"horizontal";if(a&&o){var u=t.x,c=t.y,s=u.type===Zn,l=c.type===Zn;return s&&!l?"tick"!==e?"vertical":"horizontal":!s&&l?"tick"!==e?"horizontal":"vertical":!u.aggregate&&c.aggregate?"tick"!==e?"vertical":"horizontal":u.aggregate&&!c.aggregate?"tick"!==e?"horizontal":"vertical":n||(e===Pt&&t.order||vn(rn.unclearOrientContinuous(e)),"vertical")}return void vn(rn.unclearOrientDiscreteOrEmpty(e))}return"vertical"}(o.type,t,u),void 0!==u&&u!==o.orient&&vn(rn.orientOverridden(o.orient,u)),void 0===(void 0!==o.opacity?o.opacity:Ja("opacity",o,n))&&(o.opacity=function(e,t){if(X([Ht,Wt,Xt,Qt],e)&&!Lr(t))return.7;return}(o.type,t)),void 0===o.filled&&(o.filled=(i=Ja("filled",r=o,n),a=r.type,void 0!==i?i:a!==Ht&&a!==Pt&&a!==Yt)),o}function hs(e,t,n,r){if(void 0!==e.size)return{value:e.size};if(r.bar.discreteBandSize)return{value:r.bar.discreteBandSize};if(n){var i=n.get("type");if(i!==Jr.POINT)return i===Jr.BAND?To(t):{value:r.bar.continuousBandSize};var a=n.get("range");if(Ya(a)&&x(a.step))return{value:a.step-1};vn(rn.BAR_WITH_POINT_SCALE_AND_RANGESTEP_NULL)}else if(r.scale.rangeStep&&null!==r.scale.rangeStep)return{value:r.scale.rangeStep-1};return{value:20}}function ms(e,t){var n=e.config,r=e.width,i=e.height;return Ae({},Ro(e,{size:"include",orient:"ignore"}),Go("x",e,Do(r)),Go("y",e,Do(i)),jo("size",e),function(e,t,n){if(n)return{shape:{value:n}};return jo("shape",e,{defaultValue:Ja("shape",e.markDef,t)})}(e,n,t))}var gs={area:{vgMark:"area",encodeEntry:function(e){return Ae({},Ro(e,{size:"ignore",orient:"include"}),Go("x",e,"zeroOrMin"),Go("y",e,"zeroOrMin"),Bo(e,"zeroOrMin"),Fo(e))}},bar:{vgMark:"rect",encodeEntry:function(e){return Ae({},Ro(e,{size:"ignore",orient:"ignore"}),function(e){var t=e.config,n=e.encoding,r=e.markDef,i=e.width,a=r.orient,o=n.size,u=n.x,c=e.scaleName(qe),s=e.getScaleComponent(qe);{if("horizontal"===a)return Ae({},Go("x",e,"zeroOrMin"),Bo(e,"zeroOrMin"));if(sr(u)){var l=s.get("type");if(u.bin&&!o&&!bi(l))return Wo(u,"x",e.scaleName("x"),void 0===r.binSpacing?t.bar.binSpacing:r.binSpacing,s.get("reverse"));if(l===Jr.BAND)return Ho(u,"x",e)}return qo("x",e,Ae({},Do(i)),hs(r,c,s,t))}}(e),function(e){var t=e.config,n=e.encoding,r=e.height,i=e.markDef,a=i.orient,o=n.size,u=n.y,c=e.scaleName(We),s=e.getScaleComponent(We);{if("vertical"===a)return Ae({},Go("y",e,"zeroOrMin"),Bo(e,"zeroOrMin"));if(sr(u)){var l=s.get("type");if(u.bin&&!o&&!bi(l))return Wo(u,"y",e.scaleName("y"),void 0===i.binSpacing?t.bar.binSpacing:i.binSpacing,s.get("reverse"));if(l===Jr.BAND)return Ho(u,"y",e)}return qo("y",e,Do(r),hs(i,c,s,t))}}(e))}},circle:{vgMark:"symbol",encodeEntry:function(e){return ms(e,"circle")}},geoshape:{vgMark:"shape",encodeEntry:function(e){return Ae({},Ro(e,{size:"ignore",orient:"ignore"}))},postEncodingTransform:function(e){var t=e.encoding.shape;return[Ae({type:"geoshape",projection:e.projectionName()},t&&sr(t)&&t.type===er?{field:pr(t,{expr:"datum"})}:{})]}},line:{vgMark:"line",encodeEntry:function(e){var t=e.width,n=e.height;return Ae({},Ro(e,{size:"ignore",orient:"ignore"}),Go("x",e,Do(t)),Go("y",e,Do(n)),jo("size",e,{vgChannel:"strokeWidth"}),Fo(e))}},point:{vgMark:"symbol",encodeEntry:function(e){return ms(e)}},rect:{vgMark:"rect",encodeEntry:function(e){return Ae({},Ro(e,{size:"ignore",orient:"ignore"}),function(e){var t=e.encoding.x,n=e.encoding.x2,r=e.getScaleComponent(qe),i=r?r.get("type"):void 0;{if(sr(t)&&t.bin&&!n)return Wo(t,"x",e.scaleName("x"),0,r.get("reverse"));if(sr(t)&&r&&bi(i)){if(i===Jr.BAND)return Ho(t,"x",e);throw new Error(rn.scaleTypeNotWorkWithMark(Bt,i))}return Ae({},Go("x",e,"zeroOrMax"),Bo(e,"zeroOrMin","x2"))}}(e),function(e){var t=e.encoding.y,n=e.encoding.y2,r=e.getScaleComponent(We),i=r?r.get("type"):void 0;{if(sr(t)&&t.bin&&!n)return Wo(t,"y",e.scaleName("y"),0,r.get("reverse"));if(sr(t)&&r&&bi(i)){if(i===Jr.BAND)return Ho(t,"y",e);throw new Error(rn.scaleTypeNotWorkWithMark(Bt,i))}return Ae({},Go("y",e,"zeroOrMax"),Bo(e,"zeroOrMin","y2"))}}(e))}},rule:{vgMark:"rule",encodeEntry:function(e){e.config;var t=e.markDef,n=e.width,r=e.height,i=t.orient;return e.encoding.x||e.encoding.y||e.encoding.latitude||e.encoding.longitude?Ae({},Ro(e,{size:"ignore",orient:"ignore"}),Go("x",e,"horizontal"===i?"zeroOrMin":Do(n)),Go("y",e,"vertical"===i?"zeroOrMin":Do(r)),"vertical"!==i?Bo(e,"zeroOrMax","x2"):{},"horizontal"!==i?Bo(e,"zeroOrMax","y2"):{},jo("size",e,{vgChannel:"strokeWidth",defaultValue:t.size})):{}}},square:{vgMark:"symbol",encodeEntry:function(e){return ms(e,"square")}},text:{vgMark:"text",encodeEntry:function(e){var t=e.config,n=e.encoding,r=e.height,i=e.markDef,a=n.text;return Ae({},Ro(e,{size:"ignore",orient:"ignore"}),Go("x",e,function(e,t){if(sr(t)&&t.type===Kn)return{field:{group:"width"},offset:-5};return{value:e.scale.textXRangeStep/2}}(t,a)),Go("y",e,Do(r)),Mo(e),jo("size",e,Ae({},i.size?{defaultValue:i.size}:{},{vgChannel:"fontSize"})),function(e,t){if(void 0!==t)return(n={})[e]={value:t},n;var n}("align",function(e,t,n){if(void 0===(e.align||Ja("align",e,n)))return Rr(t,qe)||Rr(t,Xe)?"center":"right";return}(e.markDef,n,t)))}},tick:{vgMark:"rect",encodeEntry:function(e){var t,n=e.config,r=e.markDef,i=e.width,a=e.height,o=r.orient,u="horizontal"===o?"width":"height",c="horizontal"===o?"height":"width";return Ae({},Ro(e,{size:"ignore",orient:"ignore"}),Go("x",e,Do(i),"xc"),Go("y",e,Do(a),"yc"),jo("size",e,{defaultValue:function(e){var t=e.config,n=e.markDef,r=n.orient,i=e.getScaleComponent("horizontal"===r?"x":"y");{if(void 0!==n.size)return n.size;if(void 0!==t.tick.bandSize)return t.tick.bandSize;var a=i?i.get("range"):void 0,o=a&&Ya(a)?a.step:t.scale.rangeStep;if("number"!=typeof o)throw new Error("Function does not handle non-numeric rangeStep");return o/1.5}}(e),vgChannel:u}),((t={})[c]={value:n.tick.thickness},t))}},trail:{vgMark:"trail",encodeEntry:function(e){var t=e.width,n=e.height;return Ae({},Ro(e,{size:"include",orient:"ignore"}),Go("x",e,Do(t)),Go("y",e,Do(n)),jo("size",e),Fo(e))}}};function vs(e){return X([Pt,Ut,Gt],e.mark)?(i=(t=e).mark,a=t.encoding,n=ie(a).reduce(function(t,e){switch(e){case"x":case"y":case"order":case"tooltip":case"href":case"x2":case"y2":case"latitude":case"longitude":case"latitude2":case"longitude2":case"text":case"shape":return t;case"detail":case"key":var n=a[e];return n&&(v(n)?n:[n]).forEach(function(e){e.aggregate||t.push(pr(e,{}))}),t;case"size":if("trail"===i)return t;case"color":case"fill":case"stroke":case"opacity":var r=kr(a[e]);return r&&!r.aggregate&&t.push(pr(r,{})),t;default:throw new Error("Bug: Channel "+e+" unimplemented for line mark")}},[]),r=bs(t,{fromPrefix:0<n.length?ys:""}),0<n.length?[{name:t.getName("pathgroup"),type:"group",from:{facet:{name:ys+t.requestDataName(ga),data:t.requestDataName(ga),groupby:n}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:r}]:r):bs(e);var t,n,r,i,a}var ys="faceted_path_";function bs(e,t){void 0===t&&(t={fromPrefix:""});var n,r,i,a=e.mark,o=void 0!==e.markDef.clip?!!e.markDef.clip:(r=(n=e).getScaleComponent("x"),i=n.getScaleComponent("y"),!!(r&&r.get("domainRaw")||i&&i.get("domainRaw"))),u=Ka(e.markDef),c=e.encoding.key,s=function(e){var t=e.encoding.order;if(v(t)||!fr(t)){if((v(t)||sr(t))&&!e.stack)return ao(t,{expr:"datum"});if(Jt(e.mark)){var n="horizontal"===e.markDef.orient?"y":"x",r=e.sort(n),i=iu(r)?pr({aggregate:Lr(e.encoding)?r.op:void 0,field:r.field},{expr:"datum"}):e.vgField(n,{binSuffix:e.stack&&e.stack.impute?"mid":void 0,expr:"datum"});return i?{field:i,order:"descending"}:void 0}}}(e),l=gs[a].postEncodingTransform?gs[a].postEncodingTransform(e):null;return[Ae({name:e.getName("marks"),type:gs[a].vgMark},o?{clip:!0}:{},u?{style:u}:{},c?{key:{field:c.field}}:{},s?{sort:s}:{},{from:{data:t.fromPrefix+e.requestDataName(ga)},encode:{update:gs[a].encodeEntry(e)}},l?{transform:l}:{})]}var xs=function(l){function e(e,t,n,r,i,a,o){void 0===r&&(r={});var u=l.call(this,e,t,n,a,i,void 0)||this;u.fit=o,u.type="unit",u.specifiedScales={},u.specifiedAxes={},u.specifiedLegends={},u.specifiedProjection={},u.selection={},u.children=[],u.initSize(Ae({},r,e.width?{width:e.width}:{},e.height?{height:e.height}:{}));var c=$t(e.mark)?e.mark.type:e.mark,s=u.encoding=Fr(is(e.encoding||{},i),c);return u.markDef=ps(e.mark,s,a),u.stack=Xi(c,s,u.config.stack),u.specifiedScales=u.initScales(c,s),u.specifiedAxes=u.initAxes(s),u.specifiedLegends=u.initLegend(s),u.specifiedProjection=e.projection,u.selection=e.selection,u}return Ce(e,l),e.prototype.scaleDomain=function(e){var t=this.specifiedScales[e];return t?t.domain:void 0},e.prototype.sort=function(e){return(this.getMapping()[e]||{}).sort},e.prototype.axis=function(e){return this.specifiedAxes[e]},e.prototype.legend=function(e){return this.specifiedLegends[e]},e.prototype.initScales=function(e,a){return Ot.reduce(function(e,t){var n,r,i=a[t];return sr(i)?r=(n=i).scale:ur(i)?(n=i.condition,r=i.condition.scale):"x"===t?n=kr(a.x2):"y"===t&&(n=kr(a.y2)),n&&(e[t]=r||{}),e},{})},e.prototype.initAxes=function(i){return[qe,We].reduce(function(e,t){var n=i[t];if(sr(n)||t===qe&&sr(i.x2)||t===We&&sr(i.y2)){var r=sr(n)?n.axis:null;null!==r&&!1!==r&&(e[t]=Ae({},r))}return e},{})},e.prototype.initLegend=function(i){return Nt.reduce(function(e,t){var n=i[t];if(n){var r=sr(n)?n.legend:ur(n)?n.condition.legend:null;null!==r&&!1!==r&&(e[t]=Ae({},r))}return e},{})},e.prototype.parseData=function(){this.component.data=Yc(this)},e.prototype.parseLayoutSize=function(){!function(e){var t=e.component.layoutSize;if(!t.explicit.width){var n=Zc(e,"width");t.set("width",n,!1)}if(!t.explicit.height){var r=Zc(e,"height");t.set("height",r,!1)}}(this)},e.prototype.parseSelection=function(){this.component.selection=function(a,o){var u={},c=a.config.selection,e=function(e){if(!o.hasOwnProperty(e))return"continue";var t=o[e],n=c[t.type];for(var r in n)"encodings"===r&&t.fields||"fields"===r&&t.encodings||("mark"===r&&(t[r]=Ae({},n[r],t[r])),void 0!==t[r]&&!0!==t[r]||(t[r]=n[r]||t[r]));e=se(e);var i=u[e]=Ae({},t,{name:e,events:y(t.on)?ba(t.on,"scope"):t.on});vc(i,function(e){e.parse&&e.parse(a,t,i)})};for(var t in o)e(t);return u}(this,this.selection)},e.prototype.parseMarkGroup=function(){this.component.mark=vs(this)},e.prototype.parseAxisAndHeader=function(){this.component.axes=ss(this)},e.prototype.assembleSelectionTopLevelSignals=function(e){return r=e,i=!1,Nc(n=this,function(t,e){e.topLevelSignals&&(r=e.topLevelSignals(n,t,r)),vc(t,function(e){e.topLevelSignals&&(r=e.topLevelSignals(n,t,r))}),i=!0}),i&&(r.filter(function(e){return"unit"===e.name}).length||r.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]})),r;var n,r,i},e.prototype.assembleSelectionSignals=function(){return function(i,a){Nc(i,function(t,e){var n=t.name,r=e.modifyExpr(i,t);a.push.apply(a,e.signals(i,t)),vc(t,function(e){e.signals&&(a=e.signals(i,t,a)),e.modifyExpr&&(r=e.modifyExpr(i,t,r))}),a.push({name:n+xc,on:[{events:{signal:n+bc},update:"modify("+k(t.name+yc)+", "+r+")"}]})});var e=Oc(i);if(a.length&&e){var t=k(e.getName("cell"));a.unshift({name:"facet",value:{},on:[{events:ba("mousemove","scope"),update:"isTuple(facet) ? facet : group("+t+").datum"}]})}return a}(this,[])},e.prototype.assembleSelectionData=function(e){return n=e,Nc(this,function(t){n.filter(function(e){return e.name===t.name+yc}).length||n.push({name:t.name+yc})}),n;var n},e.prototype.assembleLayout=function(){return null},e.prototype.assembleLayoutSignals=function(){return ho(this)},e.prototype.assembleMarks=function(){var e=this.component.mark||[];return this.parent&&Vu(this.parent)||(e=Ec(this,e)),e.map(this.correctDataNames)},e.prototype.assembleLayoutSize=function(){return{width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")}},e.prototype.getMapping=function(){return this.encoding},e.prototype.toSpec=function(e,t){var n,r=ue(this.encoding);return n={mark:this.markDef,encoding:r},e||(n.config=ue(this.config)),t||(n.data=ue(this.data)),n},Object.defineProperty(e.prototype,"mark",{get:function(){return this.markDef.type},enumerable:!0,configurable:!0}),e.prototype.channelHasField=function(e){return Rr(this.encoding,e)},e.prototype.fieldDef=function(e){return kr(this.encoding[e])},e}(Qu),Ss=function(s){function l(e,t,n,r,i,a,o){var u=s.call(this,e,t,n,a,i,e.resolve)||this;u.type="layer";var c=Ae({},r,e.width?{width:e.width}:{},e.height?{height:e.height}:{});return u.initSize(c),u.children=e.layer.map(function(e,t){if(Zi(e))return new l(e,u,u.getName("layer_"+t),c,i,a,o);if(Ji(e))return new xs(e,u,u.getName("layer_"+t),c,i,a,o);throw new Error(rn.INVALID_SPEC)}),u}return Ce(l,s),l.prototype.parseData=function(){this.component.data=Yc(this);for(var e=0,t=this.children;e<t.length;e++){t[e].parseData()}},l.prototype.parseLayoutSize=function(){Xc(this)},l.prototype.parseSelection=function(){var n=this;this.component.selection={};for(var e=function(t){t.parseSelection(),ie(t.component.selection).forEach(function(e){n.component.selection[e]=t.component.selection[e]})},t=0,r=this.children;t<r.length;t++){e(r[t])}},l.prototype.parseMarkGroup=function(){for(var e=0,t=this.children;e<t.length;e++){t[e].parseMarkGroup()}},l.prototype.parseAxisAndHeader=function(){!function(e){for(var t=e.component,n=t.axes,r=t.resolve,i={top:0,bottom:0,right:0,left:0},a=0,o=e.children;a<o.length;a++){(h=o[a]).parseAxisAndHeader();for(var u=0,c=ie(h.component.axes);u<c.length;u++){var s=c[u];r.axis[s]=yo(e.component.resolve,s),"shared"===r.axis[s]&&(n[s]=fs(n[s],h.component.axes[s]),n[s]||(r.axis[s]="independent",delete n[s]))}}for(var l=0,f=[qe,We];l<f.length;l++){s=f[l];for(var d=0,p=e.children;d<p.length;d++){var h;if((h=p[d]).component.axes[s]){if("independent"===r.axis[s]){n[s]=(n[s]||[]).concat(h.component.axes[s]);for(var m=0,g=h.component.axes[s];m<g.length;m++){var v=g[m],y=v.getWithExplicit("orient"),b=y.value,x=y.explicit;if(0<i[b]&&!x){var S=ls[b];i[b]>i[S]&&v.set("orient",S,!1)}i[b]++}}delete h.component.axes[s]}}}}(this)},l.prototype.assembleSelectionTopLevelSignals=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionTopLevelSignals(e)},e)},l.prototype.assembleSelectionSignals=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleSelectionSignals())},[])},l.prototype.assembleLayoutSignals=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleLayoutSignals())},ho(this))},l.prototype.assembleSelectionData=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionData(e)},e)},l.prototype.assembleTitle=function(){var e=s.prototype.assembleTitle.call(this);if(e)return e;for(var t=0,n=this.children;t<n.length;t++){if(e=n[t].assembleTitle())return e}},l.prototype.assembleLayout=function(){return null},l.prototype.assembleMarks=function(){return t=Z((e=this).children.map(function(e){return e.assembleMarks()})),e.children.forEach(function(e){Wu(e)&&(t=Ec(e,t))}),t;var e,t},l.prototype.assembleLegends=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleLegends())},Zo(this))},l}(Xu),Es=function(o){function e(e,t,n,r,i){var a=o.call(this,e,t,n,i,r,e.resolve)||this;return a.type="repeat",e.resolve&&e.resolve.axis&&("shared"===e.resolve.axis.x||"shared"===e.resolve.axis.y)&&vn(rn.REPEAT_CANNOT_SHARE_AXIS),a.repeat=e.repeat,a.children=a._initChildren(e,a.repeat,r,i),a}return Ce(e,o),e.prototype._initChildren=function(e,t,n,r){for(var i=[],a=t.row||[n?n.row:null],o=t.column||[n?n.column:null],u=0,c=a;u<c.length;u++)for(var s=c[u],l=0,f=o;l<f.length;l++){var d=f[l],p=(s?"_"+s:"")+(d?"_"+d:""),h={row:s,column:d};i.push(ws(e.spec,this,this.getName("child"+p),void 0,h,r,!1))}return i},e.prototype.parseLayoutSize=function(){Qc(this)},e.prototype.assembleLayout=function(){return{padding:{row:10,column:10},offset:10,columns:this.repeat&&this.repeat.column?this.repeat.column.length:1,bounds:"full",align:"all"}},e}(Vc);function ws(e,t,n,r,i,a,o){if(Ki(e))return new as(e,t,n,i,a);if(Zi(e))return new Ss(e,t,n,r,i,a,o);if(Ji(e))return new xs(e,t,n,r,i,a,o);if($i(e))return new Es(e,t,n,i,a);if(ea(e))return new $c(e,t,n,i,a);throw new Error(rn.INVALID_SPEC)}var Ns=Object.freeze({}),ks={text:["text"],line:["x","y"],trail:["x","y"],area:["x","y"]},Os={bar:g(["row","column","x","y","size","color","fill","stroke","detail"]),line:g(["row","column","x","y","color","fill","stroke","color","detail"]),trail:g(["row","column","x","y","color","fill","stroke","color","detail","size"]),area:g(["row","column","x","y","color","fill","stroke","detail"]),tick:g(["row","column","x","y","color","fill","stroke","detail"]),circle:g(["row","column","x","y","color","fill","stroke","size","detail"]),square:g(["row","column","x","y","color","fill","stroke","size","detail"]),point:g(["row","column","x","y","color","fill","stroke","size","detail","shape"]),geoshape:g(["row","column","color","fill","stroke","detail","shape"]),text:g(["row","column","size","color","fill","stroke","text"])};var _s=Object.freeze({DEFAULT_REQUIRED_CHANNEL_MAP:ks,DEFAULT_SUPPORTED_CHANNEL_TYPE:Os,getEncodingMappingError:function(e,t,n){void 0===t&&(t=ks),void 0===n&&(n=Os);var r=$t(e.mark)?e.mark.type:e.mark,i=e.encoding,a=t[r],o=n[r];for(var u in a)if(!(a[u]in i))return'Missing encoding channel "'+a[u]+'" for mark "'+r+'"';for(var c in i)if(!o[c])return'Encoding channel "'+c+'" is not supported by mark type "'+r+'"';return r!==Mt||i.x||i.y?null:"Missing both x and y for bar"}});e.aggregate=_e,e.axis=He,e.bin=jt,e.channel=Dt,e.compositeMark=$r,e.config=Wi,e.data=ya,e.datetime=_n,e.encoding=Hr,e.facet=Ns,e.fieldDef=Ir,e.legend=oi,e.mark=hn,e.scale=zi,e.sort=ou,e.spec=sa,e.stack=Qi,e.timeUnit=Xn,e.transform=Ga,e.type=nr,e.util=ye,e.validate=_s,e.compile=function(e,t){var n,r,i,a,o,u;void 0===t&&(t={}),t.logger&&(n=t.logger,gn=n),t.fieldTitle&&Sr(t.fieldTitle);try{var c=ji($({},t.config,e.config)),s=ra(e,c),l=function(e,t,n){void 0===n&&(n=!0);var r=Ae({type:"pad"},la(t),la(e));return"fit"===r.type&&(n||(vn(rn.FIT_NON_SINGLE),r.type="pad")),r}(e.autosize,c.autosize,Zi(s)||Ji(s)),f=ws(s,null,"",void 0,void 0,c,"fit"===l.type);return f.parse(),o=f.component.data,(u=ae(o.sources)).forEach(Nu),ku(u=u.filter(function(e){return 0<e.numChildren()})).forEach(vu(bu)),ku(u=u.filter(function(e){return 0<e.numChildren()})).forEach(vu(yu)),ku(u).forEach(xu),u.forEach(wu),ie(o.sources).forEach(function(e){0===o.sources[e].numChildren()&&delete o.sources[e]}),function(e,t){var n=e.config?Hi(e.config):void 0,r=[].concat(e.assembleSelectionData([]),function(e,t){var n=ae(e.sources),r=[],i=es(r),a=0;n.forEach(function(e){e.hasName()||(e.dataName="source_"+a++);var t=e.assemble();i(e,t)}),r.forEach(function(e){0===e.transform.length&&delete e.transform});for(var o=0,u=0;u<r.length;u++)0!==((m=r[u]).transform||[]).length||m.source||r.splice(o++,0,r.splice(u,1)[0]);for(var c=0,s=r;c<s.length;c++)for(var l=0,f=(m=s[c]).transform||[];l<f.length;l++){var d=f[l];"lookup"===d.type&&(d.from=e.outputNodes[d.from].getSource())}for(var p=0,h=r;p<h.length;p++){var m;(m=h[p]).name in t&&(m.values=t[m.name])}return r}(e.component.data,t.datasets||{}));delete t.datasets;var i=e.assembleProjections(),a=e.assembleTitle(),o=e.assembleGroupStyle(),u=e.assembleLayoutSignals();return u=u.filter(function(e){return"width"!==e.name&&"height"!==e.name||void 0===e.value||(t[e.name]=+e.value,!1)}),{spec:Ae({$schema:"https://vega.github.io/schema/vega/v3.0.json"},e.description?{description:e.description}:{},t,a?{title:a}:{},o?{style:o}:{},{data:r},0<i.length?{projections:i}:{},e.assembleGroup(u.concat(e.assembleSelectionTopLevelSignals([]))),n?{config:n}:{})}}(f,(r=e,i=c,Ae({autosize:1===ie(a=l).length&&a.type?a.type:a},da(i),da(r))))}finally{t.logger&&(gn=mn),t.fieldTitle&&Er()}},e.version="2.4.3",Object.defineProperty(e,"__esModule",{value:!0})});